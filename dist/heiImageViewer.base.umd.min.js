(function(ve,xe){typeof exports=="object"&&typeof module<"u"?xe(exports):typeof define=="function"&&define.amd?define(["exports"],xe):(ve=typeof globalThis<"u"?globalThis:ve||self,xe(ve.heiImageViewer=ve.heiImageViewer||{}))})(this,function(ve){"use strict";var Up=Object.defineProperty;var Xu=ve=>{throw TypeError(ve)};var Hp=(ve,xe,Et)=>xe in ve?Up(ve,xe,{enumerable:!0,configurable:!0,writable:!0,value:Et}):ve[xe]=Et;var Js=(ve,xe,Et)=>Hp(ve,typeof xe!="symbol"?xe+"":xe,Et),Zp=(ve,xe,Et)=>xe.has(ve)||Xu("Cannot "+Et);var xl=(ve,xe,Et)=>xe.has(ve)?Xu("Cannot add the same private member more than once"):xe instanceof WeakSet?xe.add(ve):xe.set(ve,Et);var Vi=(ve,xe,Et)=>(Zp(ve,xe,"access private method"),Et);var It,Yu,Uu,wl,Tl,Qr,Hu;var xe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Et(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}(function(){var s;function e(c){var d=0;return function(){return d<c.length?{done:!1,value:c[d++]}:{done:!0}}}function t(c){var d=typeof Symbol<"u"&&Symbol.iterator&&c[Symbol.iterator];return d?d.call(c):{next:e(c)}}function i(c){if(!(c instanceof Array)){c=t(c);for(var d,m=[];!(d=c.next()).done;)m.push(d.value);c=m}return c}function n(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof xe=="object"&&xe];for(var d=0;d<c.length;++d){var m=c[d];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=n(this);function o(){}o.prototype.toJSON=function(){return{}};function a(c){return c.__shady||(c.__shady=new o),c.__shady}function l(c){return c&&c.__shady}var h=window.ShadyDOM||{};h.da=!(!Element.prototype.attachShadow||!Node.prototype.getRootNode);var u=Object.getOwnPropertyDescriptor(Node.prototype,"firstChild");h.i=!!(u&&u.configurable&&u.get),h.N=h.force||!h.da,h.l=h.noPatch||!1,h.C=h.preferPerformance,h.O=h.l==="on-demand";var f,g=h.querySelectorImplementation;f=-1<["native","selectorEngine"].indexOf(g)?g:void 0,h.ga=f,h.V=navigator.userAgent.match("Trident");function _(){return Document.prototype.msElementsFromPoint?"msElementsFromPoint":"elementsFromPoint"}function p(c){return(c=l(c))&&c.firstChild!==void 0}function y(c){return c instanceof ShadowRoot}function E(c){return(c=(c=l(c))&&c.root)&&Gu(c)}var x=Element.prototype,C=x.matches||x.matchesSelector||x.mozMatchesSelector||x.msMatchesSelector||x.oMatchesSelector||x.webkitMatchesSelector,T=document.createTextNode(""),S=0,R=[];new MutationObserver(function(){for(;R.length;)try{R.shift()()}catch(c){throw T.textContent=S++,c}}).observe(T,{characterData:!0});function b(c){R.push(c),T.textContent=S++}var P=document.contains?function(c,d){return c.__shady_native_contains(d)}:function(c,d){return c===d||c.documentElement&&c.documentElement.__shady_native_contains(d)};function F(c,d){for(;d;){if(d==c)return!0;d=d.__shady_parentNode}return!1}function I(c){for(var d=c.length-1;0<=d;d--){var m=c[d],v=m.getAttribute("id")||m.getAttribute("name");v&&v!=="length"&&isNaN(v)&&(c[v]=m)}return c.item=function(w){return c[w]},c.namedItem=function(w){if(w!=="length"&&isNaN(w)&&c[w])return c[w];for(var L=t(c),M=L.next();!M.done;M=L.next())if(M=M.value,(M.getAttribute("id")||M.getAttribute("name"))==w)return M;return null},c}function O(c){var d=[];for(c=c.__shady_native_firstChild;c;c=c.__shady_native_nextSibling)d.push(c);return d}function X(c){var d=[];for(c=c.__shady_firstChild;c;c=c.__shady_nextSibling)d.push(c);return d}function Z(c,d,m){if(m.configurable=!0,m.value)c[d]=m.value;else try{Object.defineProperty(c,d,m)}catch{}}function G(c,d,m,v){m=m===void 0?"":m;for(var w in d)v&&0<=v.indexOf(w)||Z(c,m+w,d[w])}function Y(c,d){for(var m in d)m in c&&Z(c,m,d[m])}function z(c){var d={};return Object.getOwnPropertyNames(c).forEach(function(m){d[m]=Object.getOwnPropertyDescriptor(c,m)}),d}function k(c,d){for(var m=Object.getOwnPropertyNames(d),v=0,w;v<m.length;v++)w=m[v],c[w]=d[w]}function B(c){return c instanceof Node?c:document.createTextNode(""+c)}function U(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];if(d.length===1)return B(d[0]);m=document.createDocumentFragment(),d=t(d);for(var v=d.next();!v.done;v=d.next())m.appendChild(B(v.value));return m}function ie(c){var d;for(d=d===void 0?1:d;0<d;d--)c=c.reduce(function(m,v){return Array.isArray(v)?m.push.apply(m,i(v)):m.push(v),m},[]);return c}function ee(c){var d=[],m=new Set;c=t(c);for(var v=c.next();!v.done;v=c.next())v=v.value,m.has(v)||(d.push(v),m.add(v));return d}var ne=[],Q;function ae(c){Q||(Q=!0,b(D)),ne.push(c)}function D(){Q=!1;for(var c=!!ne.length;ne.length;)ne.shift()();return c}D.list=ne;function ye(){this.g=!1,this.addedNodes=[],this.removedNodes=[],this.H=new Set}function Ye(c){c.g||(c.g=!0,b(function(){c.flush()}))}ye.prototype.flush=function(){if(this.g){this.g=!1;var c=this.takeRecords();c.length&&this.H.forEach(function(d){d(c)})}},ye.prototype.takeRecords=function(){if(this.addedNodes.length||this.removedNodes.length){var c=[{addedNodes:this.addedNodes,removedNodes:this.removedNodes}];return this.addedNodes=[],this.removedNodes=[],c}return[]};function Ie(c,d){var m=a(c);m.B||(m.B=new ye),m.B.H.add(d);var v=m.B;return{Z:d,ba:v,aa:c,takeRecords:function(){return v.takeRecords()}}}function $e(c){var d=c&&c.ba;d&&(d.H.delete(c.Z),d.H.size||(a(c.aa).B=null))}function vt(c,d){var m=d.getRootNode();return c.map(function(v){var w=m===v.target.getRootNode();if(w&&v.addedNodes){if(w=[].slice.call(v.addedNodes).filter(function(L){return m===L.getRootNode()}),w.length)return v=Object.create(v),Object.defineProperty(v,"addedNodes",{value:w,configurable:!0}),v}else if(w)return v}).filter(function(v){return v})}var Je=/[&\u00A0"]/g,on=/[&\u00A0<>]/g;function Jt(c){switch(c){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"Â ":return"&nbsp;"}}function Zn(c){for(var d={},m=0;m<c.length;m++)d[c[m]]=!0;return d}var Kn=Zn("area base br col command embed hr img input keygen link meta param source track wbr".split(" ")),qn=Zn("style script xmp iframe noembed noframes plaintext noscript".split(" "));function Qe(c,d){c.localName==="template"&&(c=c.content);for(var m="",v=d?d(c):c.childNodes,w=0,L=v.length,M=void 0;w<L&&(M=v[w]);w++){e:{var N=M,V=c,W=d;switch(N.nodeType){case Node.ELEMENT_NODE:V=N.localName;for(var j="<"+V,Le=N.attributes,yi=0,$s;$s=Le[yi];yi++)j+=" "+$s.name+'="'+$s.value.replace(Je,Jt)+'"';j+=">",N=Kn[V]?j:j+Qe(N,W)+"</"+V+">";break e;case Node.TEXT_NODE:N=N.data,N=V&&qn[V.localName]?N:N.replace(on,Jt);break e;case Node.COMMENT_NODE:N="<!--"+N.data+"-->";break e;default:throw window.console.error(N),Error("not implemented")}}m+=N}return m}var zt=h.i,Ni={querySelector:function(c){return this.__shady_native_querySelector(c)},querySelectorAll:function(c){return this.__shady_native_querySelectorAll(c)}},$n={};function an(c){$n[c]=function(d){return d["__shady_native_"+c]}}function Qt(c,d){G(c,d,"__shady_native_");for(var m in d)an(m)}function ce(c,d){d=d===void 0?[]:d;for(var m=0;m<d.length;m++){var v=d[m],w=Object.getOwnPropertyDescriptor(c,v);w&&(Object.defineProperty(c,"__shady_native_"+v,w),w.value?Ni[v]||(Ni[v]=w.value):an(v))}}var Ee=document.createTreeWalker(document,NodeFilter.SHOW_ALL,null,!1),Se=document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT,null,!1),nt=document.implementation.createHTMLDocument("inert");function _i(c){for(var d;d=c.__shady_native_firstChild;)c.__shady_native_removeChild(d)}var ei=["firstElementChild","lastElementChild","children","childElementCount"],Lt=["querySelector","querySelectorAll","append","prepend","replaceChildren"];function Vt(){var c=["dispatchEvent","addEventListener","removeEventListener"];window.EventTarget?(ce(window.EventTarget.prototype,c),window.__shady_native_addEventListener===void 0&&ce(Window.prototype,c)):(ce(Node.prototype,c),ce(Window.prototype,c),ce(XMLHttpRequest.prototype,c)),zt?ce(Node.prototype,"parentNode firstChild lastChild previousSibling nextSibling childNodes parentElement textContent".split(" ")):Qt(Node.prototype,{parentNode:{get:function(){return Ee.currentNode=this,Ee.parentNode()}},firstChild:{get:function(){return Ee.currentNode=this,Ee.firstChild()}},lastChild:{get:function(){return Ee.currentNode=this,Ee.lastChild()}},previousSibling:{get:function(){return Ee.currentNode=this,Ee.previousSibling()}},nextSibling:{get:function(){return Ee.currentNode=this,Ee.nextSibling()}},childNodes:{get:function(){var d=[];Ee.currentNode=this;for(var m=Ee.firstChild();m;)d.push(m),m=Ee.nextSibling();return d}},parentElement:{get:function(){return Se.currentNode=this,Se.parentNode()}},textContent:{get:function(){switch(this.nodeType){case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:for(var d=document.createTreeWalker(this,NodeFilter.SHOW_TEXT,null,!1),m="",v;v=d.nextNode();)m+=v.nodeValue;return m;default:return this.nodeValue}},set:function(d){switch((typeof d>"u"||d===null)&&(d=""),this.nodeType){case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:_i(this),(0<d.length||this.nodeType===Node.ELEMENT_NODE)&&this.__shady_native_insertBefore(document.createTextNode(d),void 0);break;default:this.nodeValue=d}}}}),ce(Node.prototype,"appendChild insertBefore removeChild replaceChild cloneNode contains".split(" ")),ce(HTMLElement.prototype,["parentElement","contains"]),c={firstElementChild:{get:function(){return Se.currentNode=this,Se.firstChild()}},lastElementChild:{get:function(){return Se.currentNode=this,Se.lastChild()}},children:{get:function(){var d=[];Se.currentNode=this;for(var m=Se.firstChild();m;)d.push(m),m=Se.nextSibling();return I(d)}},childElementCount:{get:function(){return this.children?this.children.length:0}}},zt?(ce(Element.prototype,ei),ce(Element.prototype,["previousElementSibling","nextElementSibling","innerHTML","className"]),ce(HTMLElement.prototype,["children","innerHTML","className"])):(Qt(Element.prototype,c),Qt(Element.prototype,{previousElementSibling:{get:function(){return Se.currentNode=this,Se.previousSibling()}},nextElementSibling:{get:function(){return Se.currentNode=this,Se.nextSibling()}},innerHTML:{get:function(){return Qe(this,O)},set:function(d){var m=this.localName==="template"?this.content:this;_i(m);var v=this.localName||"div";for(v=this.namespaceURI&&this.namespaceURI!==nt.namespaceURI?nt.createElementNS(this.namespaceURI,v):nt.createElement(v),v.innerHTML=d,d=this.localName==="template"?v.content:v;v=d.__shady_native_firstChild;)m.__shady_native_insertBefore(v,void 0)}},className:{get:function(){return this.getAttribute("class")||""},set:function(d){this.setAttribute("class",d)}}})),ce(Element.prototype,"setAttribute getAttribute hasAttribute removeAttribute toggleAttribute focus blur".split(" ")),ce(Element.prototype,Lt),ce(HTMLElement.prototype,["focus","blur"]),window.HTMLTemplateElement&&ce(window.HTMLTemplateElement.prototype,["innerHTML"]),zt?ce(DocumentFragment.prototype,ei):Qt(DocumentFragment.prototype,c),ce(DocumentFragment.prototype,Lt),zt?(ce(Document.prototype,ei),ce(Document.prototype,["activeElement"])):Qt(Document.prototype,c),ce(Document.prototype,["importNode","getElementById","elementFromPoint",_()]),ce(Document.prototype,Lt)}var ln=z({get childNodes(){return this.__shady_childNodes},get firstChild(){return this.__shady_firstChild},get lastChild(){return this.__shady_lastChild},get childElementCount(){return this.__shady_childElementCount},get children(){return this.__shady_children},get firstElementChild(){return this.__shady_firstElementChild},get lastElementChild(){return this.__shady_lastElementChild},get shadowRoot(){return this.__shady_shadowRoot}}),De=z({get textContent(){return this.__shady_textContent},set textContent(c){this.__shady_textContent=c},get innerHTML(){return this.__shady_innerHTML},set innerHTML(c){this.__shady_innerHTML=c}}),Jn=z({get parentElement(){return this.__shady_parentElement},get parentNode(){return this.__shady_parentNode},get nextSibling(){return this.__shady_nextSibling},get previousSibling(){return this.__shady_previousSibling},get nextElementSibling(){return this.__shady_nextElementSibling},get previousElementSibling(){return this.__shady_previousElementSibling},get className(){return this.__shady_className},set className(c){this.__shady_className=c}});function hn(c){for(var d in c){var m=c[d];m&&(m.enumerable=!1)}}hn(ln),hn(De),hn(Jn);var eo=h.i||h.l===!0,to=eo?function(){}:function(c){var d=a(c);d.X||(d.X=!0,Y(c,Jn))},Zs=eo?function(){}:function(c){var d=a(c);d.W||(d.W=!0,Y(c,ln),window.customElements&&window.customElements.polyfillWrapFlushCallback&&!h.l||Y(c,De))},Di="__eventWrappers"+Date.now(),cn=function(){var c=Object.getOwnPropertyDescriptor(Event.prototype,"composed");return c?function(d){return c.get.call(d)}:null}(),io=function(){function c(){}var d=!1,m={get capture(){return d=!0,!1}};return window.addEventListener("test",c,m),window.removeEventListener("test",c,m),d}();function Qn(c){if(c===null||typeof c!="object"&&typeof c!="function")var d=!!c,m=!1;else{d=!!c.capture,m=!!c.once;var v=c.o}return{U:v,capture:d,once:m,T:io?c:d}}var un={blur:!0,focus:!0,focusin:!0,focusout:!0,click:!0,dblclick:!0,mousedown:!0,mouseenter:!0,mouseleave:!0,mousemove:!0,mouseout:!0,mouseover:!0,mouseup:!0,wheel:!0,beforeinput:!0,input:!0,keydown:!0,keyup:!0,compositionstart:!0,compositionupdate:!0,compositionend:!0,touchstart:!0,touchend:!0,touchmove:!0,touchcancel:!0,pointerover:!0,pointerenter:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointercancel:!0,pointerout:!0,pointerleave:!0,gotpointercapture:!0,lostpointercapture:!0,dragstart:!0,drag:!0,dragenter:!0,dragleave:!0,dragover:!0,drop:!0,dragend:!0,DOMActivate:!0,DOMFocusIn:!0,DOMFocusOut:!0,keypress:!0},ki={DOMAttrModified:!0,DOMAttributeNameChanged:!0,DOMCharacterDataModified:!0,DOMElementNameChanged:!0,DOMNodeInserted:!0,DOMNodeInsertedIntoDocument:!0,DOMNodeRemoved:!0,DOMNodeRemovedFromDocument:!0,DOMSubtreeModified:!0};function Gi(c){return c instanceof Node?c.__shady_getRootNode():c}function dn(c,d){var m=[],v=c;for(c=Gi(c);v;)m.push(v),v=v.__shady_assignedSlot?v.__shady_assignedSlot:v.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&v.host&&(d||v!==c)?v.host:v.__shady_parentNode;return m[m.length-1]===document&&m.push(window),m}function no(c){return c.__composedPath||(c.__composedPath=dn(c.target,!0)),c.__composedPath}function et(c,d){if(!y)return c;c=dn(c,!0);for(var m=0,v,w=void 0,L,M=void 0;m<d.length;m++)if(v=d[m],L=Gi(v),L!==w&&(M=c.indexOf(L),w=L),!y(L)||-1<M)return v}var Wt={get composed(){return this.__composed===void 0&&(cn?this.__composed=this.type==="focusin"||this.type==="focusout"||cn(this):this.isTrusted!==!1&&(this.__composed=un[this.type])),this.__composed||!1},composedPath:function(){return this.__composedPath||(this.__composedPath=dn(this.__target,this.composed)),this.__composedPath},get target(){return et(this.currentTarget||this.__previousCurrentTarget,this.composedPath())},get relatedTarget(){return this.__relatedTarget?(this.__relatedTargetComposedPath||(this.__relatedTargetComposedPath=dn(this.__relatedTarget,!0)),et(this.currentTarget||this.__previousCurrentTarget,this.__relatedTargetComposedPath)):null},stopPropagation:function(){Event.prototype.stopPropagation.call(this),this.K=!0},stopImmediatePropagation:function(){Event.prototype.stopImmediatePropagation.call(this),this.K=this.__immediatePropagationStopped=!0}},st=h.i&&Object.getOwnPropertyDescriptor(Event.prototype,"eventPhase");st&&(Object.defineProperty(Wt,"eventPhase",{get:function(){return this.currentTarget===this.target?Event.AT_TARGET:this.__shady_native_eventPhase},enumerable:!0,configurable:!0}),Object.defineProperty(Wt,"__shady_native_eventPhase",st));function ft(c){function d(m,v){return m=new c(m,v),m.__composed=v&&!!v.composed,m}return d.__proto__=c,d.prototype=c.prototype,d}var rt={focus:!0,blur:!0};function bt(c){return c.__target!==c.target||c.__relatedTarget!==c.relatedTarget}function Mt(c,d,m){if(m=d.__handlers&&d.__handlers[c.type]&&d.__handlers[c.type][m])for(var v=0,w;(w=m[v])&&(!bt(c)||c.target!==c.relatedTarget)&&(w.call(d,c),!c.__immediatePropagationStopped);v++);}var Ce=new Event("e").hasOwnProperty("currentTarget");function je(c){c=Ce?Object.create(c):c;var d=c.composedPath(),m=d.map(function(j){return et(j,d)}),v=c.bubbles,w=Object.getOwnPropertyDescriptor(c,"currentTarget");Object.defineProperty(c,"currentTarget",{configurable:!0,enumerable:!0,get:function(){return V}});var L=Event.CAPTURING_PHASE,M=Object.getOwnPropertyDescriptor(c,"eventPhase");Object.defineProperty(c,"eventPhase",{configurable:!0,enumerable:!0,get:function(){return L}});try{for(var N=d.length-1;0<=N;N--){var V=d[N];if(L=V===m[N]?Event.AT_TARGET:Event.CAPTURING_PHASE,Mt(c,V,"capture"),c.K)return}for(N=0;N<d.length;N++){V=d[N];var W=V===m[N];if((W||v)&&(L=W?Event.AT_TARGET:Event.BUBBLING_PHASE,Mt(c,V,"bubble"),c.K))break}}finally{Ce||(w?Object.defineProperty(c,"currentTarget",w):delete c.currentTarget,M?Object.defineProperty(c,"eventPhase",M):delete c.eventPhase)}}function Pt(c,d,m,v){for(var w=0;w<c.length;w++){var L=c[w],M=L.type,N=L.capture;if(d===L.node&&m===M&&v===N)return w}return-1}function so(c){return D(),!h.C&&this instanceof Node&&!P(document,this)?(c.__target||al(c,this),je(c)):this.__shady_native_dispatchEvent(c)}function rl(c,d,m){var v=this,w=Qn(m),L=w.capture,M=w.once,N=w.U;if(w=w.T,d){var V=typeof d;if((V==="function"||V==="object")&&(V!=="object"||d.handleEvent&&typeof d.handleEvent=="function")){if(ki[c])return this.__shady_native_addEventListener(c,d,w);var W=N||this;if(N=d[Di]){if(-1<Pt(N,W,c,L))return}else d[Di]=[];N=function(j){if(M&&v.__shady_removeEventListener(c,d,m),j.__target||al(j),W!==v){var Le=Object.getOwnPropertyDescriptor(j,"currentTarget");Object.defineProperty(j,"currentTarget",{get:function(){return W},configurable:!0});var yi=Object.getOwnPropertyDescriptor(j,"eventPhase");Object.defineProperty(j,"eventPhase",{configurable:!0,enumerable:!0,get:function(){return L?Event.CAPTURING_PHASE:Event.BUBBLING_PHASE}})}if(j.__previousCurrentTarget=j.currentTarget,(!y(W)&&W.localName!=="slot"||j.composedPath().indexOf(W)!=-1)&&(j.composed||-1<j.composedPath().indexOf(W))){if(bt(j)&&j.target===j.relatedTarget)j.eventPhase===Event.BUBBLING_PHASE&&j.stopImmediatePropagation();else if(j.eventPhase===Event.CAPTURING_PHASE||j.bubbles||j.target===W||W instanceof Window){var $s=V==="function"?d.call(W,j):d.handleEvent&&d.handleEvent(j);return W!==v&&(Le?(Object.defineProperty(j,"currentTarget",Le),Le=null):delete j.currentTarget,yi?(Object.defineProperty(j,"eventPhase",yi),yi=null):delete j.eventPhase),$s}}},d[Di].push({node:W,type:c,capture:L,fa:N}),this.__handlers=this.__handlers||{},this.__handlers[c]=this.__handlers[c]||{capture:[],bubble:[]},this.__handlers[c][L?"capture":"bubble"].push(N),rt[c]||this.__shady_native_addEventListener(c,N,w)}}}function ol(c,d,m){if(d){var v=Qn(m);m=v.capture;var w=v.U;if(v=v.T,ki[c])return this.__shady_native_removeEventListener(c,d,v);var L=w||this;w=void 0;var M=null;try{M=d[Di]}catch{}M&&(L=Pt(M,L,c,m),-1<L&&(w=M.splice(L,1)[0].fa,M.length||(d[Di]=void 0))),this.__shady_native_removeEventListener(c,w||d,v),w&&this.__handlers&&this.__handlers[c]&&(c=this.__handlers[c][m?"capture":"bubble"],d=c.indexOf(w),-1<d&&c.splice(d,1))}}function wp(){for(var c in rt)window.__shady_native_addEventListener(c,function(d){d.__target||(al(d),je(d))},!0)}var ru=z(Wt);function al(c,d){if(d=d===void 0?c.target:d,c.__target=d,c.__relatedTarget=c.relatedTarget,h.i){if(d=Object.getPrototypeOf(c),!d.hasOwnProperty("__shady_patchedProto")){var m=Object.create(d);m.__shady_sourceProto=d,G(m,ru),d.__shady_patchedProto=m}c.__proto__=d.__shady_patchedProto}else G(c,ru)}var Tp=ft(Event),Sp=ft(CustomEvent),Rp=ft(MouseEvent);function Ip(){if(!cn&&Object.getOwnPropertyDescriptor(Event.prototype,"isTrusted")){var c=function(){var d=new MouseEvent("click",{bubbles:!0,cancelable:!0,composed:!0});this.__shady_dispatchEvent(d)};Element.prototype.click?Element.prototype.click=c:HTMLElement.prototype.click&&(HTMLElement.prototype.click=c)}}var ou=Object.getOwnPropertyNames(Element.prototype).filter(function(c){return c.substring(0,2)==="on"}),au=Object.getOwnPropertyNames(HTMLElement.prototype).filter(function(c){return c.substring(0,2)==="on"});function lu(c){return{set:function(d){var m=a(this),v=c.substring(2);m.m||(m.m={}),m.m[c]&&this.removeEventListener(v,m.m[c]),this.__shady_addEventListener(v,d),m.m[c]=d},get:function(){var d=l(this);return d&&d.m&&d.m[c]},configurable:!0}}function Ks(c,d){return{index:c,D:[],G:d}}function Lp(c,d,m,v){var w=0,L=0,M=0,N=0,V=Math.min(d-w,v-L);if(w==0&&L==0)e:{for(M=0;M<V;M++)if(c[M]!==m[M])break e;M=V}if(d==c.length&&v==m.length){N=c.length;for(var W=m.length,j=0;j<V-M&&bp(c[--N],m[--W]);)j++;N=j}if(w+=M,L+=M,d-=N,v-=N,d-w==0&&v-L==0)return[];if(w==d){for(d=Ks(w,0);L<v;)d.D.push(m[L++]);return[d]}if(L==v)return[Ks(w,d-w)];for(V=w,M=L,v=v-M+1,N=d-V+1,d=Array(v),W=0;W<v;W++)d[W]=Array(N),d[W][0]=W;for(W=0;W<N;W++)d[0][W]=W;for(W=1;W<v;W++)for(j=1;j<N;j++)if(c[V+j-1]===m[M+W-1])d[W][j]=d[W-1][j-1];else{var Le=d[W-1][j]+1,yi=d[W][j-1]+1;d[W][j]=Le<yi?Le:yi}for(V=d.length-1,M=d[0].length-1,v=d[V][M],c=[];0<V||0<M;)V==0?(c.push(2),M--):M==0?(c.push(3),V--):(N=d[V-1][M-1],W=d[V-1][M],j=d[V][M-1],Le=W<j?W<N?W:N:j<N?j:N,Le==N?(N==v?c.push(0):(c.push(1),v=N),V--,M--):Le==W?(c.push(3),V--,v=W):(c.push(2),M--,v=j));for(c.reverse(),d=void 0,V=[],M=0;M<c.length;M++)switch(c[M]){case 0:d&&(V.push(d),d=void 0),w++,L++;break;case 1:d||(d=Ks(w,0)),d.G++,w++,d.D.push(m[L]),L++;break;case 2:d||(d=Ks(w,0)),d.G++,w++;break;case 3:d||(d=Ks(w,0)),d.D.push(m[L]),L++}return d&&V.push(d),V}function bp(c,d){return c===d}var ll=z({dispatchEvent:so,addEventListener:rl,removeEventListener:ol}),hl=null;function fn(){return hl||(hl=window.ShadyCSS&&window.ShadyCSS.ScopingShim),hl||null}function cl(c,d,m){var v=fn();return v&&d==="class"?(v.setElementClass(c,m),!0):!1}function hu(c,d){var m=fn();m&&m.unscopeNode(c,d)}function cu(c,d){var m=fn();if(!m)return!0;if(c.nodeType===Node.DOCUMENT_FRAGMENT_NODE){for(m=!0,c=c.__shady_firstChild;c;c=c.__shady_nextSibling)m=m&&cu(c,d);return m}return c.nodeType!==Node.ELEMENT_NODE?!0:m.currentScopeForNode(c)===d}function ro(c){if(c.nodeType!==Node.ELEMENT_NODE)return"";var d=fn();return d?d.currentScopeForNode(c):""}function ul(c,d){if(c)for(c.nodeType===Node.ELEMENT_NODE&&d(c),c=c.__shady_firstChild;c;c=c.__shady_nextSibling)c.nodeType===Node.ELEMENT_NODE&&ul(c,d)}var dl=window.document,fl=h.C,uu=Object.getOwnPropertyDescriptor(Node.prototype,"isConnected"),du=uu&&uu.get;function gl(c){for(var d;d=c.__shady_firstChild;)c.__shady_removeChild(d)}function fu(c){var d=l(c);if(d&&d.J!==void 0)for(d=c.__shady_firstChild;d;d=d.__shady_nextSibling)fu(d);(c=l(c))&&(c.J=void 0)}function gu(c){var d=c;if(c&&c.localName==="slot"){var m=l(c);(m=m&&m.u)&&(d=m.length?m[0]:gu(c.__shady_nextSibling))}return d}function _u(c,d,m){if(c=(c=l(c))&&c.B){if(d)if(d.nodeType===Node.DOCUMENT_FRAGMENT_NODE)for(var v=0,w=d.childNodes.length;v<w;v++)c.addedNodes.push(d.childNodes[v]);else c.addedNodes.push(d);m&&c.removedNodes.push(m),Ye(c)}}var oo=z({get parentNode(){var c=l(this);return c=c&&c.parentNode,c!==void 0?c:this.__shady_native_parentNode},get firstChild(){var c=l(this);return c=c&&c.firstChild,c!==void 0?c:this.__shady_native_firstChild},get lastChild(){var c=l(this);return c=c&&c.lastChild,c!==void 0?c:this.__shady_native_lastChild},get nextSibling(){var c=l(this);return c=c&&c.nextSibling,c!==void 0?c:this.__shady_native_nextSibling},get previousSibling(){var c=l(this);return c=c&&c.previousSibling,c!==void 0?c:this.__shady_native_previousSibling},get childNodes(){if(p(this)){var c=l(this);if(!c.childNodes){c.childNodes=[];for(var d=this.__shady_firstChild;d;d=d.__shady_nextSibling)c.childNodes.push(d)}var m=c.childNodes}else m=this.__shady_native_childNodes;return m.item=function(v){return m[v]},m},get parentElement(){var c=l(this);return(c=c&&c.parentNode)&&c.nodeType!==Node.ELEMENT_NODE&&(c=null),c!==void 0?c:this.__shady_native_parentElement},get isConnected(){if(du&&du.call(this))return!0;if(this.nodeType==Node.DOCUMENT_FRAGMENT_NODE)return!1;var c=this.ownerDocument;if(c===null||P(c,this))return!0;for(c=this;c&&!(c instanceof Document);)c=c.__shady_parentNode||(y(c)?c.host:void 0);return!!(c&&c instanceof Document)},get textContent(){if(p(this)){for(var c=[],d=this.__shady_firstChild;d;d=d.__shady_nextSibling)d.nodeType!==Node.COMMENT_NODE&&c.push(d.__shady_textContent);return c.join("")}return this.__shady_native_textContent},set textContent(c){switch((typeof c>"u"||c===null)&&(c=""),this.nodeType){case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:if(!p(this)&&h.i){var d=this.__shady_firstChild;(d!=this.__shady_lastChild||d&&d.nodeType!=Node.TEXT_NODE)&&gl(this),this.__shady_native_textContent=c}else gl(this),(0<c.length||this.nodeType===Node.ELEMENT_NODE)&&this.__shady_insertBefore(document.createTextNode(c));break;default:this.nodeValue=c}},insertBefore:function(c,d){if(this.ownerDocument!==dl&&c.ownerDocument!==dl)return this.__shady_native_insertBefore(c,d),c;if(c===this)throw Error("Failed to execute 'appendChild' on 'Node': The new child element contains the parent.");if(d){var m=l(d);if(m=m&&m.parentNode,m!==void 0&&m!==this||m===void 0&&d.__shady_native_parentNode!==this)throw Error("Failed to execute 'insertBefore' on 'Node': The node before which the new node is to be inserted is not a child of this node.")}if(d===c)return c;_u(this,c);var v=[],w=(m=is(this))?m.host.localName:ro(this),L=c.__shady_parentNode;if(L){var M=ro(c),N=!!m||!is(c)||fl&&this.__noInsertionPoint!==void 0;L.__shady_removeChild(c,N)}L=!0;var V=(!fl||c.__noInsertionPoint===void 0&&this.__noInsertionPoint===void 0)&&!cu(c,w),W=m&&!c.__noInsertionPoint&&(!fl||c.nodeType===Node.DOCUMENT_FRAGMENT_NODE);return(W||V)&&(V&&(M=M||ro(c)),ul(c,function(j){if(W&&j.localName==="slot"&&v.push(j),V){var Le=M;fn()&&(Le&&hu(j,Le),(Le=fn())&&Le.scopeNode(j,w))}})),v.length&&(Nu(m),m.j.push.apply(m.j,i(v)),pi(m)),p(this)&&(Vp(c,this,d),N=l(this),N.root?(L=!1,E(this)&&pi(N.root)):m&&this.localName==="slot"&&(L=!1,pi(m))),L?(m=y(this)?this.host:this,d?(d=gu(d),m.__shady_native_insertBefore(c,d)):m.__shady_native_appendChild(c)):c.ownerDocument!==this.ownerDocument&&this.ownerDocument.adoptNode(c),c},appendChild:function(c){if(this!=c||!y(c))return this.__shady_insertBefore(c)},removeChild:function(c,d){if(d=d===void 0?!1:d,this.ownerDocument!==dl)return this.__shady_native_removeChild(c);if(c.__shady_parentNode!==this)throw Error("The node to be removed is not a child of this node: "+c);_u(this,null,c);var m=is(c),v=m&&jp(m,c),w=l(this);if(p(this)&&(Wp(c,this),E(this))){pi(w.root);var L=!0}if(fn()&&!d&&m&&c.nodeType!==Node.TEXT_NODE){var M=ro(c);ul(c,function(N){hu(N,M)})}return fu(c),m&&((d=this.localName==="slot")&&(L=!0),(v||d)&&pi(m)),L||(L=y(this)?this.host:this,(!w.root&&c.localName!=="slot"||L===c.__shady_native_parentNode)&&L.__shady_native_removeChild(c)),c},replaceChild:function(c,d){return this.__shady_insertBefore(c,d),this.__shady_removeChild(d),c},cloneNode:function(c){if(this.localName=="template")return this.__shady_native_cloneNode(c);var d=this.__shady_native_cloneNode(!1);if(c&&d.nodeType!==Node.ATTRIBUTE_NODE){c=this.__shady_firstChild;for(var m;c;c=c.__shady_nextSibling)m=c.__shady_cloneNode(!0),d.__shady_appendChild(m)}return d},getRootNode:function(c){if(this&&this.nodeType){var d=a(this),m=d.J;return m===void 0&&(y(this)?(m=this,d.J=m):(m=(m=this.__shady_parentNode)?m.__shady_getRootNode(c):this,document.documentElement.__shady_native_contains(this)&&(d.J=m))),m}},contains:function(c){return F(this,c)}}),qs=z({get assignedSlot(){var c=this.__shady_parentNode;return(c=c&&c.__shady_shadowRoot)&&_o(c),(c=l(this))&&c.assignedSlot||null}}),_l=new Map;[["(",{end:")",I:!0}],["[",{end:"]",I:!0}],['"',{end:'"',I:!1}],["'",{end:"'",I:!1}]].forEach(function(c){var d=t(c);c=d.next().value,d=d.next().value,_l.set(c,d)});function mu(c,d,m,v){for(v=v===void 0?!0:v;d<c.length;d++)if(c[d]==="\\"&&d<c.length-1&&c[d+1]!==`
`)d++;else{if(m.indexOf(c[d])!==-1)return d;if(v&&_l.has(c[d])){var w=_l.get(c[d]);d=mu(c,d+1,[w.end],w.I)}}return c.length}function Mp(c){function d(){if(0<v.length){for(;v[v.length-1]===" ";)v.pop();m.push({S:v.filter(function(V,W){return W%2===0}),ca:v.filter(function(V,W){return W%2===1})}),v.length=0}}for(var m=[],v=[],w=0;w<c.length;){var L=v[v.length-1],M=mu(c,w,[","," ",">","+","~"]),N=M===w?c[w]:c.substring(w,M);N===","?d():([void 0," ",">","+","~"].indexOf(L)===-1||N!==" ")&&(L===" "&&[">","+","~"].indexOf(N)!==-1?v[v.length-1]=N:v.push(N)),w=M+(M===w?1:0)}return d(),m}function ao(c,d,m){var v=[];return pu(c,d,m,v),v}function pu(c,d,m,v){for(c=c.__shady_firstChild;c;c=c.__shady_nextSibling){var w;if(w=c.nodeType===Node.ELEMENT_NODE){w=c;var L=d,M=m,N=v,V=L(w);V&&N.push(w),M&&M(V)?w=V:(pu(w,L,M,N),w=void 0)}if(w)break}}var lo={get firstElementChild(){var c=l(this);if(c&&c.firstChild!==void 0){for(c=this.__shady_firstChild;c&&c.nodeType!==Node.ELEMENT_NODE;)c=c.__shady_nextSibling;return c}return this.__shady_native_firstElementChild},get lastElementChild(){var c=l(this);if(c&&c.lastChild!==void 0){for(c=this.__shady_lastChild;c&&c.nodeType!==Node.ELEMENT_NODE;)c=c.__shady_previousSibling;return c}return this.__shady_native_lastElementChild},get children(){return p(this)?I(Array.prototype.filter.call(X(this),function(c){return c.nodeType===Node.ELEMENT_NODE})):this.__shady_native_children},get childElementCount(){var c=this.__shady_children;return c?c.length:0}},es=z((lo.append=function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];this.__shady_insertBefore(U.apply(null,i(d)),null)},lo.prepend=function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];this.__shady_insertBefore(U.apply(null,i(d)),this.__shady_firstChild)},lo.replaceChildren=function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];for(;(m=this.__shady_firstChild)!==null;)this.__shady_removeChild(m);this.__shady_insertBefore(U.apply(null,i(d)),null)},lo));function yu(c,d){function m(w,L){return(w===c||L.indexOf(":scope")===-1)&&C.call(w,L)}var v=Mp(d);if(1>v.length)return[];for(d=ie(ao(c,function(){return!0}).map(function(w){return ie(v.map(function(L){var M=L.S,N=M.length-1;return m(w,M[N])?{target:w,v:L,A:w,index:N}:[]}))}));d.some(function(w){return 0<w.index});)d=ie(d.map(function(w){if(0>=w.index)return w;var L=w.target,M=w.A,N=w.v;w=w.index-1;var V=N.ca[w],W=N.S[w];if(V===" "){for(V=[],M=M.__shady_parentElement;M;M=M.__shady_parentElement)m(M,W)&&V.push({target:L,v:N,A:M,index:w});return V}if(V===">")return M=M.__shady_parentElement,m(M,W)?{target:L,v:N,A:M,index:w}:[];if(V==="+")return(M=M.__shady_previousElementSibling)&&m(M,W)?{target:L,v:N,A:M,index:w}:[];if(V==="~"){for(V=[],M=M.__shady_previousElementSibling;M;M=M.__shady_previousElementSibling)m(M,W)&&V.push({target:L,v:N,A:M,index:w});return V}throw Error("Unrecognized combinator: '"+V+"'.")}));return ee(d.map(function(w){return w.target}))}var zi=h.querySelectorImplementation,Pp=z({querySelector:function(c){if(zi==="native"){var d=Array.prototype.slice.call((this instanceof ShadowRoot?this.host:this).__shady_native_querySelectorAll(c)),m=this.__shady_getRootNode();d=t(d);for(var v=d.next();!v.done;v=d.next())if(v=v.value,v.__shady_getRootNode()==m)return v;return null}if(zi==="selectorEngine")return yu(this,c)[0]||null;if(zi===void 0)return ao(this,function(w){return C.call(w,c)},function(w){return!!w})[0]||null;throw Error("Unrecognized value of ShadyDOM.querySelectorImplementation: '"+(zi+"'"))},querySelectorAll:function(c,d){if(d||zi==="native"){d=Array.prototype.slice.call((this instanceof ShadowRoot?this.host:this).__shady_native_querySelectorAll(c));var m=this.__shady_getRootNode();return I(d.filter(function(v){return v.__shady_getRootNode()==m}))}if(zi==="selectorEngine")return I(yu(this,c));if(zi===void 0)return I(ao(this,function(v){return C.call(v,c)}));throw Error("Unrecognized value of ShadyDOM.querySelectorImplementation: '"+(zi+"'"))}}),vu=h.C&&!h.l?k({},es):es;k(es,Pp);var Eu=z({after:function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];if(m=this.__shady_parentNode,m!==null){var v=this.__shady_nextSibling;m.__shady_insertBefore(U.apply(null,i(d)),v)}},before:function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];m=this.__shady_parentNode,m!==null&&m.__shady_insertBefore(U.apply(null,i(d)),this)},remove:function(){var c=this.__shady_parentNode;c!==null&&c.__shady_removeChild(this)},replaceWith:function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];if(m=this.__shady_parentNode,m!==null){var v=this.__shady_nextSibling;m.__shady_removeChild(this),m.__shady_insertBefore(U.apply(null,i(d)),v)}}}),ml=window.document;function pl(c,d){if(d==="slot")c=c.__shady_parentNode,E(c)&&pi(l(c).root);else if(c.localName==="slot"&&d==="name"&&(d=is(c))){if(d.g){mo(d);var m=c.Y,v=Du(c);if(v!==m){m=d.h[m];var w=m.indexOf(c);0<=w&&m.splice(w,1),m=d.h[v]||(d.h[v]=[]),m.push(c),1<m.length&&(d.h[v]=ku(m))}}pi(d)}}var ho=z({get previousElementSibling(){var c=l(this);if(c&&c.previousSibling!==void 0){for(c=this.__shady_previousSibling;c&&c.nodeType!==Node.ELEMENT_NODE;)c=c.__shady_previousSibling;return c}return this.__shady_native_previousElementSibling},get nextElementSibling(){var c=l(this);if(c&&c.nextSibling!==void 0){for(c=this.__shady_nextSibling;c&&c.nodeType!==Node.ELEMENT_NODE;)c=c.__shady_nextSibling;return c}return this.__shady_native_nextElementSibling},get slot(){return this.getAttribute("slot")},set slot(c){this.__shady_setAttribute("slot",c)},get className(){return this.getAttribute("class")||""},set className(c){this.__shady_setAttribute("class",c)},setAttribute:function(c,d){this.ownerDocument!==ml?this.__shady_native_setAttribute(c,d):cl(this,c,d)||(this.__shady_native_setAttribute(c,d),pl(this,c))},removeAttribute:function(c){this.ownerDocument!==ml?this.__shady_native_removeAttribute(c):cl(this,c,"")?this.getAttribute(c)===""&&this.__shady_native_removeAttribute(c):(this.__shady_native_removeAttribute(c),pl(this,c))},toggleAttribute:function(c,d){if(this.ownerDocument!==ml)return this.__shady_native_toggleAttribute(c,d);if(!cl(this,c,""))return d=this.__shady_native_toggleAttribute(c,d),pl(this,c),d;if(this.getAttribute(c)===""&&!d)return this.__shady_native_toggleAttribute(c,d)}});h.C||ou.forEach(function(c){ho[c]=lu(c)});var Cu=z({attachShadow:function(c){if(!this)throw Error("Must provide a host.");if(!c)throw Error("Not enough arguments.");if(c.shadyUpgradeFragment&&!h.V){var d=c.shadyUpgradeFragment;if(d.__proto__=ShadowRoot.prototype,Pu(d,this,c),uo(d,d),c=d.__noInsertionPoint?null:d.querySelectorAll("slot"),d.__noInsertionPoint=void 0,c&&c.length){var m=d;Nu(m),m.j.push.apply(m.j,i(c)),pi(d)}d.host.__shady_native_appendChild(d)}else d=new go(bu,this,c);return this.__CE_shadowRoot=d},get shadowRoot(){var c=l(this);return c&&c.ea||null}});k(ho,Cu);var yl=document.implementation.createHTMLDocument("inert"),vl=z({get innerHTML(){return p(this)?Qe(this.localName==="template"?this.content:this,X):this.__shady_native_innerHTML},set innerHTML(c){if(this.localName==="template")this.__shady_native_innerHTML=c;else{gl(this);var d=this.localName||"div";for(d=this.namespaceURI&&this.namespaceURI!==yl.namespaceURI?yl.createElementNS(this.namespaceURI,d):yl.createElement(d),h.i?d.__shady_native_innerHTML=c:d.innerHTML=c;c=d.__shady_firstChild;)this.__shady_insertBefore(c)}}}),xu=z({blur:function(){var c=l(this);(c=(c=c&&c.root)&&c.activeElement)?c.__shady_blur():this.__shady_native_blur()}});h.C||au.forEach(function(c){xu[c]=lu(c)});var wu=z({assignedNodes:function(c){if(this.localName==="slot"){var d=this.__shady_getRootNode();return d&&y(d)&&_o(d),(d=l(this))?(c&&c.flatten?d.u:d.assignedNodes)||[]:[]}},addEventListener:function(c,d,m){if(this.localName!=="slot"||c==="slotchange")rl.call(this,c,d,m);else{typeof m!="object"&&(m={capture:!!m});var v=this.__shady_parentNode;if(!v)throw Error("ShadyDOM cannot attach event to slot unless it has a `parentNode`");m.o=this,v.__shady_addEventListener(c,d,m)}},removeEventListener:function(c,d,m){if(this.localName!=="slot"||c==="slotchange")ol.call(this,c,d,m);else{typeof m!="object"&&(m={capture:!!m});var v=this.__shady_parentNode;if(!v)throw Error("ShadyDOM cannot attach event to slot unless it has a `parentNode`");m.o=this,v.__shady_removeEventListener(c,d,m)}}}),El=z({getElementById:function(c){return c===""?null:ao(this,function(d){return d.id==c},function(d){return!!d})[0]||null}});function Ap(c,d){for(var m;d&&!c.has(m=d.__shady_getRootNode());)d=m.host;return d}function Fp(c){var d=new Set;for(d.add(c);y(c)&&c.host;)c=c.host.__shady_getRootNode(),d.add(c);return d}var Op="__shady_native_"+_(),Cl=z({get activeElement(){var c=h.i?document.__shady_native_activeElement:document.activeElement;if(!c||!c.nodeType)return null;var d=!!y(this);if(!(this===document||d&&this.host!==c&&this.host.__shady_native_contains(c)))return null;for(d=is(c);d&&d!==this;)c=d.host,d=is(c);return this===document?d?null:c:d===this?c:null},elementsFromPoint:function(c,d){if(c=document[Op](c,d),this===document&&h.useNativeDocumentEFP)return c;c=[].slice.call(c),d=Fp(this);for(var m=new Set,v=0;v<c.length;v++)m.add(Ap(d,c[v]));var w=[];return m.forEach(function(L){return w.push(L)}),w},elementFromPoint:function(c,d){return this===document&&h.useNativeDocumentEFP?this.__shady_native_elementFromPoint(c,d):this.__shady_elementsFromPoint(c,d)[0]||null}}),Np=window.document,Dp=z({importNode:function(c,d){if(c.ownerDocument!==Np||c.localName==="template")return this.__shady_native_importNode(c,d);var m=this.__shady_native_importNode(c,!1);if(d)for(c=c.__shady_firstChild;c;c=c.__shady_nextSibling)d=this.__shady_importNode(c,!0),m.__shady_appendChild(d);return m}}),Tu=z({dispatchEvent:so,addEventListener:rl.bind(window),removeEventListener:ol.bind(window)}),ts={};Object.getOwnPropertyDescriptor(HTMLElement.prototype,"parentElement")&&(ts.parentElement=oo.parentElement),Object.getOwnPropertyDescriptor(HTMLElement.prototype,"contains")&&(ts.contains=oo.contains),Object.getOwnPropertyDescriptor(HTMLElement.prototype,"children")&&(ts.children=es.children),Object.getOwnPropertyDescriptor(HTMLElement.prototype,"innerHTML")&&(ts.innerHTML=vl.innerHTML),Object.getOwnPropertyDescriptor(HTMLElement.prototype,"className")&&(ts.className=ho.className);var Bt={EventTarget:[ll],Node:[oo,window.EventTarget?null:ll],Text:[qs],Comment:[qs],CDATASection:[qs],ProcessingInstruction:[qs],Element:[ho,es,Eu,qs,!h.i||"innerHTML"in Element.prototype?vl:null,window.HTMLSlotElement?null:wu],HTMLElement:[xu,ts],HTMLSlotElement:[wu],DocumentFragment:[vu,El],Document:[Dp,vu,El,Cl],Window:[Tu],CharacterData:[Eu],XMLHttpRequest:[window.EventTarget?null:ll]},kp=h.i?null:["innerHTML","textContent"];function mi(c,d,m,v){d.forEach(function(w){return c&&w&&G(c,w,m,v)})}function Su(c){var d=c?null:kp,m;for(m in Bt)mi(window[m]&&window[m].prototype,Bt[m],c,d)}["Text","Comment","CDATASection","ProcessingInstruction"].forEach(function(c){var d=window[c],m=Object.create(d.prototype);m.__shady_protoIsPatched=!0,mi(m,Bt.EventTarget),mi(m,Bt.Node),Bt[c]&&mi(m,Bt[c]),d.prototype.__shady_patchedProto=m});function Ru(c){return c.__shady_protoIsPatched=!0,mi(c,Bt.EventTarget),mi(c,Bt.Node),mi(c,Bt.Element),mi(c,Bt.HTMLElement),mi(c,Bt.HTMLSlotElement),c}var Gp=h.O,zp=h.i;function co(c,d){if(Gp&&!c.__shady_protoIsPatched&&!y(c)){var m=Object.getPrototypeOf(c),v=m.hasOwnProperty("__shady_patchedProto")&&m.__shady_patchedProto;v||(v=Object.create(m),Ru(v),m.__shady_patchedProto=v),Object.setPrototypeOf(c,v)}zp||(d===1?to(c):d===2&&Zs(c))}function Iu(c,d,m,v){co(c,1),v=v||null;var w=a(c),L=v?a(v):null;w.previousSibling=v?L.previousSibling:d.__shady_lastChild,(L=l(w.previousSibling))&&(L.nextSibling=c),(L=l(w.nextSibling=v))&&(L.previousSibling=c),w.parentNode=d,v?v===m.firstChild&&(m.firstChild=c):(m.lastChild=c,m.firstChild||(m.firstChild=c)),m.childNodes=null}function Vp(c,d,m){co(d,2);var v=a(d);if(v.firstChild!==void 0&&(v.childNodes=null),c.nodeType===Node.DOCUMENT_FRAGMENT_NODE)for(c=c.__shady_native_firstChild;c;c=c.__shady_native_nextSibling)Iu(c,d,v,m);else Iu(c,d,v,m)}function Wp(c,d){var m=a(c);d=a(d),c===d.firstChild&&(d.firstChild=m.nextSibling),c===d.lastChild&&(d.lastChild=m.previousSibling),c=m.previousSibling;var v=m.nextSibling;c&&(a(c).nextSibling=v),v&&(a(v).previousSibling=c),m.parentNode=m.previousSibling=m.nextSibling=void 0,d.childNodes!==void 0&&(d.childNodes=null)}function uo(c,d){var m=a(c);if(d||m.firstChild===void 0){m.childNodes=null;var v=m.firstChild=c.__shady_native_firstChild;for(m.lastChild=c.__shady_native_lastChild,co(c,2),m=v,v=void 0;m;m=m.__shady_native_nextSibling){var w=a(m);w.parentNode=d||c,w.nextSibling=m.__shady_native_nextSibling,w.previousSibling=v||null,v=m,co(m,1)}}}var Bp=z({addEventListener:function(c,d,m){typeof m!="object"&&(m={capture:!!m}),m.o=m.o||this,this.host.__shady_addEventListener(c,d,m)},removeEventListener:function(c,d,m){typeof m!="object"&&(m={capture:!!m}),m.o=m.o||this,this.host.__shady_removeEventListener(c,d,m)}});function Lu(c,d){G(c,Bp,d),G(c,Cl,d),G(c,vl,d),G(c,es,d),h.l&&!d?(G(c,oo,d),G(c,El,d)):h.i||(G(c,Jn),G(c,ln),G(c,De))}var bu={},gn=h.deferConnectionCallbacks&&document.readyState==="loading",fo;function Mu(c){var d=[];do d.unshift(c);while(c=c.__shady_parentNode);return d}function go(c,d,m){if(c!==bu)throw new TypeError("Illegal constructor");this.g=null,Pu(this,d,m)}function Pu(c,d,m){if(c.host=d,c.mode=m&&m.mode,uo(c.host),d=a(c.host),d.root=c,d.ea=c.mode!=="closed"?c:null,d=a(c),d.firstChild=d.lastChild=d.parentNode=d.nextSibling=d.previousSibling=null,h.preferPerformance)for(;d=c.host.__shady_native_firstChild;)c.host.__shady_native_removeChild(d);else pi(c)}function pi(c){c.s||(c.s=!0,ae(function(){return _o(c)}))}function _o(c){var d;if(d=c.s){for(var m;c;)e:{if(c.s&&(m=c),d=c,c=d.host.__shady_getRootNode(),y(c)&&(d=l(d.host))&&0<d.F)break e;c=void 0}d=m}(m=d)&&m._renderSelf()}go.prototype._renderSelf=function(){var c=gn;if(gn=!0,this.s=!1,this.g){mo(this);for(var d=0,m;d<this.g.length;d++){m=this.g[d];var v=l(m),w=v.assignedNodes;if(v.assignedNodes=[],v.u=[],v.R=w)for(v=0;v<w.length;v++){var L=l(w[v]);L.L=L.assignedSlot,L.assignedSlot===m&&(L.assignedSlot=null)}}for(d=this.host.__shady_firstChild;d;d=d.__shady_nextSibling)Au(this,d);for(d=0;d<this.g.length;d++){if(m=this.g[d],w=l(m),!w.assignedNodes.length)for(v=m.__shady_firstChild;v;v=v.__shady_nextSibling)Au(this,v,m);if((v=(v=l(m.__shady_parentNode))&&v.root)&&(Gu(v)||v.s)&&v._renderSelf(),Fu(this,w.u,w.assignedNodes),v=w.R){for(L=0;L<v.length;L++)l(v[L]).L=null;w.R=null,v.length>w.assignedNodes.length&&(w.M=!0)}w.M&&(w.M=!1,Ou(this,m))}for(m=this.g,d=[],w=0;w<m.length;w++)v=m[w].__shady_parentNode,(L=l(v))&&L.root||!(0>d.indexOf(v))||d.push(v);for(m=0;m<d.length;m++){for(L=d[m],w=L===this?this.host:L,v=[],L=L.__shady_firstChild;L;L=L.__shady_nextSibling)if(L.localName=="slot")for(var M=l(L).u,N=0;N<M.length;N++)v.push(M[N]);else v.push(L);L=O(w),M=Lp(v,v.length,L,L.length);for(var V=N=0,W=void 0;N<M.length&&(W=M[N]);N++){for(var j=0,Le=void 0;j<W.D.length&&(Le=W.D[j]);j++)Le.__shady_native_parentNode===w&&w.__shady_native_removeChild(Le),L.splice(W.index+V,1);V-=W.G}for(V=0,W=void 0;V<M.length&&(W=M[V]);V++)for(N=L[W.index],j=W.index;j<W.index+W.G;j++)Le=v[j],w.__shady_native_insertBefore(Le,N),L.splice(j,0,Le)}}if(!h.preferPerformance&&!this.P)for(d=this.host.__shady_firstChild;d;d=d.__shady_nextSibling)m=l(d),d.__shady_native_parentNode!==this.host||d.localName!=="slot"&&m.assignedSlot||this.host.__shady_native_removeChild(d);this.P=!0,gn=c,fo&&fo()};function Au(c,d,m){var v=a(d),w=v.L;v.L=null,m||(m=(c=c.h[d.__shady_slot||"__catchall"])&&c[0]),m?(a(m).assignedNodes.push(d),v.assignedSlot=m):v.assignedSlot=void 0,w!==v.assignedSlot&&v.assignedSlot&&(a(v.assignedSlot).M=!0)}function Fu(c,d,m){for(var v=0,w=void 0;v<m.length&&(w=m[v]);v++)if(w.localName=="slot"){var L=l(w).assignedNodes;L&&L.length&&Fu(c,d,L)}else d.push(m[v])}function Ou(c,d){d.__shady_native_dispatchEvent(new Event("slotchange")),d=l(d),d.assignedSlot&&Ou(c,d.assignedSlot)}function Nu(c){c.j=c.j||[],c.g=c.g||[],c.h=c.h||{}}function mo(c){if(c.j&&c.j.length){for(var d=c.j,m,v=0;v<d.length;v++){var w=d[v];uo(w);var L=w.__shady_parentNode;uo(L),L=l(L),L.F=(L.F||0)+1,L=Du(w),c.h[L]?(m=m||{},m[L]=!0,c.h[L].push(w)):c.h[L]=[w],c.g.push(w)}if(m)for(var M in m)c.h[M]=ku(c.h[M]);c.j=[]}}function Du(c){var d=c.name||c.getAttribute("name")||"__catchall";return c.Y=d}function ku(c){return c.sort(function(d,m){d=Mu(d);for(var v=Mu(m),w=0;w<d.length;w++){m=d[w];var L=v[w];if(m!==L)return d=X(m.__shady_parentNode),d.indexOf(m)-d.indexOf(L)}})}function jp(c,d){if(c.g){mo(c);var m=c.h,v;for(v in m)for(var w=m[v],L=0;L<w.length;L++){var M=w[L];if(F(d,M)){w.splice(L,1);var N=c.g.indexOf(M);if(0<=N&&(c.g.splice(N,1),(N=l(M.__shady_parentNode))&&N.F&&N.F--),L--,M=l(M),N=M.u)for(var V=0;V<N.length;V++){var W=N[V],j=W.__shady_native_parentNode;j&&j.__shady_native_removeChild(W)}M.u=[],M.assignedNodes=[],N=!0}}return N}}function Gu(c){return mo(c),!(!c.g||!c.g.length)}if(function(c){c.__proto__=DocumentFragment.prototype,Lu(c,"__shady_"),Lu(c),Object.defineProperties(c,{nodeType:{value:Node.DOCUMENT_FRAGMENT_NODE,configurable:!0},nodeName:{value:"#document-fragment",configurable:!0},nodeValue:{value:null,configurable:!0}}),["localName","namespaceURI","prefix"].forEach(function(d){Object.defineProperty(c,d,{value:void 0,configurable:!0})}),["ownerDocument","baseURI","isConnected"].forEach(function(d){Object.defineProperty(c,d,{get:function(){return this.host[d]},configurable:!0})})}(go.prototype),window.customElements&&window.customElements.define&&h.N&&!h.preferPerformance){var po=new Map;fo=function(){var c=[];po.forEach(function(v,w){c.push([w,v])}),po.clear();for(var d=0;d<c.length;d++){var m=c[d][0];c[d][1]?m.__shadydom_connectedCallback():m.__shadydom_disconnectedCallback()}},gn&&document.addEventListener("readystatechange",function(){gn=!1,fo()},{once:!0});var Xp=function(c,d,m){var v=0,w="__isConnected"+v++;return(d||m)&&(c.prototype.connectedCallback=c.prototype.__shadydom_connectedCallback=function(){gn?po.set(this,!0):this[w]||(this[w]=!0,d&&d.call(this))},c.prototype.disconnectedCallback=c.prototype.__shadydom_disconnectedCallback=function(){gn?this.isConnected||po.set(this,!1):this[w]&&(this[w]=!1,m&&m.call(this))}),c},Yp=window.customElements.define,zu=function(c,d){var m=d.prototype.connectedCallback,v=d.prototype.disconnectedCallback;Yp.call(window.customElements,c,Xp(d,m,v)),d.prototype.connectedCallback=m,d.prototype.disconnectedCallback=v};window.customElements.define=zu,Object.defineProperty(window.CustomElementRegistry.prototype,"define",{value:zu,configurable:!0})}function is(c){if(c=c.__shady_getRootNode(),y(c))return c}function ns(c){this.node=c}s=ns.prototype,s.addEventListener=function(c,d,m){return this.node.__shady_addEventListener(c,d,m)},s.removeEventListener=function(c,d,m){return this.node.__shady_removeEventListener(c,d,m)},s.appendChild=function(c){return this.node.__shady_appendChild(c)},s.insertBefore=function(c,d){return this.node.__shady_insertBefore(c,d)},s.removeChild=function(c){return this.node.__shady_removeChild(c)},s.replaceChild=function(c,d){return this.node.__shady_replaceChild(c,d)},s.cloneNode=function(c){return this.node.__shady_cloneNode(c)},s.getRootNode=function(c){return this.node.__shady_getRootNode(c)},s.contains=function(c){return this.node.__shady_contains(c)},s.dispatchEvent=function(c){return this.node.__shady_dispatchEvent(c)},s.setAttribute=function(c,d){this.node.__shady_setAttribute(c,d)},s.getAttribute=function(c){return this.node.__shady_native_getAttribute(c)},s.removeAttribute=function(c){this.node.__shady_removeAttribute(c)},s.toggleAttribute=function(c,d){return this.node.__shady_toggleAttribute(c,d)},s.attachShadow=function(c){return this.node.__shady_attachShadow(c)},s.focus=function(){this.node.__shady_native_focus()},s.blur=function(){this.node.__shady_blur()},s.importNode=function(c,d){if(this.node.nodeType===Node.DOCUMENT_NODE)return this.node.__shady_importNode(c,d)},s.getElementById=function(c){if(this.node.nodeType===Node.DOCUMENT_NODE)return this.node.__shady_getElementById(c)},s.elementsFromPoint=function(c,d){return this.node.__shady_elementsFromPoint(c,d)},s.elementFromPoint=function(c,d){return this.node.__shady_elementFromPoint(c,d)},s.querySelector=function(c){return this.node.__shady_querySelector(c)},s.querySelectorAll=function(c,d){return this.node.__shady_querySelectorAll(c,d)},s.assignedNodes=function(c){if(this.node.localName==="slot")return this.node.__shady_assignedNodes(c)},s.append=function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];return this.node.__shady_append.apply(this.node,i(d))},s.prepend=function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];return this.node.__shady_prepend.apply(this.node,i(d))},s.after=function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];return this.node.__shady_after.apply(this.node,i(d))},s.before=function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];return this.node.__shady_before.apply(this.node,i(d))},s.remove=function(){return this.node.__shady_remove()},s.replaceWith=function(c){for(var d=[],m=0;m<arguments.length;++m)d[m]=arguments[m];return this.node.__shady_replaceWith.apply(this.node,i(d))},r.Object.defineProperties(ns.prototype,{activeElement:{configurable:!0,enumerable:!0,get:function(){if(y(this.node)||this.node.nodeType===Node.DOCUMENT_NODE)return this.node.__shady_activeElement}},_activeElement:{configurable:!0,enumerable:!0,get:function(){return this.activeElement}},host:{configurable:!0,enumerable:!0,get:function(){if(y(this.node))return this.node.host}},parentNode:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_parentNode}},firstChild:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_firstChild}},lastChild:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_lastChild}},nextSibling:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_nextSibling}},previousSibling:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_previousSibling}},childNodes:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_childNodes}},parentElement:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_parentElement}},firstElementChild:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_firstElementChild}},lastElementChild:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_lastElementChild}},nextElementSibling:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_nextElementSibling}},previousElementSibling:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_previousElementSibling}},children:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_children}},childElementCount:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_childElementCount}},shadowRoot:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_shadowRoot}},assignedSlot:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_assignedSlot}},isConnected:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_isConnected}},innerHTML:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_innerHTML},set:function(c){this.node.__shady_innerHTML=c}},textContent:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_textContent},set:function(c){this.node.__shady_textContent=c}},slot:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_slot},set:function(c){this.node.__shady_slot=c}},className:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_className},set:function(c){this.node.__shady_className=c}}});function Vu(c){Object.defineProperty(ns.prototype,c,{get:function(){return this.node["__shady_"+c]},set:function(d){this.node["__shady_"+c]=d},configurable:!0})}ou.forEach(function(c){return Vu(c)}),au.forEach(function(c){return Vu(c)});var Wu=new WeakMap;function Bu(c){if(y(c)||c instanceof ns)return c;var d=Wu.get(c);return d||(d=new ns(c),Wu.set(c,d)),d}if(h.N){var ju=h.i?function(c){return c}:function(c){return Zs(c),to(c),c};window.ShadyDOM={inUse:h.N,patch:ju,isShadyRoot:y,enqueue:ae,flush:D,flushInitial:function(c){!c.P&&c.s&&_o(c)},settings:h,filterMutations:vt,observeChildren:Ie,unobserveChildren:$e,deferConnectionCallbacks:h.deferConnectionCallbacks,preferPerformance:h.preferPerformance,handlesDynamicScoping:!0,wrap:h.l?Bu:ju,wrapIfNeeded:h.l===!0?Bu:function(c){return c},Wrapper:ns,composedPath:no,noPatch:h.l,patchOnDemand:h.O,nativeMethods:Ni,nativeTree:$n,patchElementProto:Ru,querySelectorImplementation:h.querySelectorImplementation},Vt(),Su("__shady_"),Object.defineProperty(document,"_activeElement",Cl.activeElement),G(Window.prototype,Tu,"__shady_"),h.l?h.O&&G(Element.prototype,Cu):(Su(),Ip()),wp(),window.Event=Tp,window.CustomEvent=Sp,window.MouseEvent=Rp,window.ShadowRoot=go}}).call(xe);var Zu=function(){return Object.prototype.hasOwnProperty.call(Node.prototype,"getRootNode")},yo={exports:{}},Sl;function Ku(){return Sl||(Sl=1,function(s){function e(r){var o=typeof r=="object"&&!!r.composed;return o?t(this):i(this)}function t(r){var o=i(r);return n(o)?t(o.host):o}function i(r){return r.parentNode!=null?i(r.parentNode):r}function n(r){return r.nodeName==="#document-fragment"&&r.constructor.name==="ShadowRoot"}s.exports&&(s.exports=e)}(yo)),yo.exports}var qu=Zu;qu()||Object.defineProperty(Node.prototype,"getRootNode",{enumerable:!1,configurable:!1,value:Ku()});const gt={centerInViewport:"&#x2BD0;",mouseWheelScrolls:"&#x1F5AF;&#x2195;",mouseWheelZooms:"&#x1F5AF;Â°",rotateFreely:"",rotateLeft:"&#x21B6;",rotateRight:"&#x21B7;",toggleFullScreen:"&#x1F5D6;",toggleOverviewMap:"&#x1F441;",zoomIn:"&#x1F50E;&#x031F;",zoomOut:"&#x1F50E;&#x0320;",deleteShape:"&#x1F5D1;",drawShape:"",editVertices:"&#x1F709;",moveScaleRotate:"&#x26F6;",selectShape:"&#x261D;",circle:"&#x25CB;",ellipse:"&#x2B2D;",line:"&#x2758;",polygon:"&#x23E2;",rect:"&#x25AD;"};class ot{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}function $u(s){s.stopPropagation()}const Wi={PROPERTYCHANGE:"propertychange"};class vo{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Ju(s,e,t){let i,n;t=t||Bi;let r=0,o=s.length,a=!1;for(;r<o;)i=r+(o-r>>1),n=+t(s[i],e),n<0?r=i+1:(o=i,a=!n);return a?r:~r}function Bi(s,e){return s>e?1:s<e?-1:0}function Qs(s,e,t){if(s[0]<=e)return 0;const i=s.length;if(e<=s[i-1])return i-1;if(typeof t=="function"){for(let n=1;n<i;++n){const r=s[n];if(r===e)return n;if(r<e)return t(e,s[n-1],r)>0?n-1:n}return i-1}if(t>0){for(let n=1;n<i;++n)if(s[n]<e)return n-1;return i-1}if(t<0){for(let n=1;n<i;++n)if(s[n]<=e)return n;return i-1}for(let n=1;n<i;++n){if(s[n]==e)return n;if(s[n]<e)return s[n-1]-e<e-s[n]?n-1:n}return i-1}function Qu(s,e,t){for(;e<t;){const i=s[e];s[e]=s[t],s[t]=i,++e,--t}}function Ct(s,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let n=0;n<i;n++)s[s.length]=t[n]}function ti(s,e){const t=s.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(s[i]!==e[i])return!1;return!0}function ed(s,e,t){const i=e;return s.every(function(n,r){if(r===0)return!0;const o=i(s[r-1],n);return!(o>0||o===0)})}function jt(){return!0}function _n(){return!1}function mn(){}function Rl(s){let e=!1,t,i,n;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==n||!ti(r,i))&&(e=!0,n=this,i=r,t=s.apply(this,arguments)),t}}function td(s){function e(){let t;try{t=s()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function pn(s){for(const e in s)delete s[e]}function yn(s){let e;for(e in s)return!1;return!e}class ss extends vo{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),n=i[e]||(i[e]=[]);n.includes(t)||n.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const r=t?new ot(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,u=n.length;h<u;++h)if("handleEvent"in n[h]?l=n[h].handleEvent(r):l=n[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,mn);delete o[i]}return l}disposeInternal(){this.listeners_&&pn(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const i=this.listeners_[e];if(!i)return;const n=i.indexOf(t);n!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[n]=mn,++this.pendingRemovals_[e]):(i.splice(n,1),i.length===0&&delete this.listeners_[e]))}}const q={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function re(s,e,t,i,n){if(i&&i!==s&&(t=t.bind(i)),n){const o=t;t=function(){s.removeEventListener(e,t),o.apply(this,arguments)}}const r={target:s,type:e,listener:t};return s.addEventListener(e,t),r}function rs(s,e,t,i){return re(s,e,t,i,!0)}function me(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),pn(s))}class os extends ss{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(q.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=re(this,e[r],t);return n}return re(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const n=e.length;i=new Array(n);for(let r=0;r<n;++r)i[r]=rs(this,e[r],t)}else i=rs(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)Il(i);else if(Array.isArray(e))for(let n=0,r=e.length;n<r;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)}}os.prototype.on,os.prototype.once,os.prototype.un;function Il(s){if(Array.isArray(s))for(let e=0,t=s.length;e<t;++e)me(s[e]);else me(s)}function ue(){throw new Error("Unimplemented abstract method.")}let id=0;function se(s){return s.ol_uid||(s.ol_uid=String(++id))}class Ll extends ot{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class At extends os{constructor(e){super(),this.on,this.once,this.un,se(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new Ll(i,e,t)),i=Wi.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new Ll(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const n=this.values_||(this.values_={});if(i)n[e]=t;else{const r=n[e];n[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],yn(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}const er={ACTIVE:"active"};function bl(s){return Math.pow(s,3)}function ji(s){return 1-bl(1-s)}function nd(s){return 3*s*s-2*s*s*s}function sd(s){return s}class vn extends At{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(er.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(er.ACTIVE,e)}setMap(e){this.map_=e}}function rd(s,e,t){const i=s.getCenterInternal();if(i){const n=[i[0]+e[0],i[1]+e[1]];s.animateInternal({duration:t!==void 0?t:250,easing:sd,center:s.getConstrainedCenter(n)})}}function Eo(s,e,t,i){const n=s.getZoom();if(n===void 0)return;const r=s.getConstrainedZoom(n+e),o=s.getResolutionForZoom(r);s.getAnimating()&&s.cancelAnimations(),s.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:ji})}const le={SINGLECLICK:"singleclick",CLICK:q.CLICK,DBLCLICK:q.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class od extends vn{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==le.DBLCLICK){const i=e.originalEvent,n=e.map,r=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=n.getView();Eo(a,o,r,this.duration_),i.preventDefault(),t=!0}return!t}}const Co={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class as{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Co[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const ls=6378137,En=Math.PI*ls,ad=[-En,-En,En,En],ld=[-180,-85,180,85],tr=ls*Math.log(Math.tan(Math.PI/2));class Cn extends as{constructor(e){super({code:e,units:"m",extent:ad,global:!0,worldExtent:ld,getPointResolution:function(t,i){return t/Math.cosh(i[1]/ls)}})}}const Ml=[new Cn("EPSG:3857"),new Cn("EPSG:102100"),new Cn("EPSG:102113"),new Cn("EPSG:900913"),new Cn("http://www.opengis.net/def/crs/EPSG/0/3857"),new Cn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function hd(s,e,t){const i=s.length;t=t>1?t:2,e===void 0&&(t>2?e=s.slice():e=new Array(i));for(let n=0;n<i;n+=t){e[n]=En*s[n]/180;let r=ls*Math.log(Math.tan(Math.PI*(+s[n+1]+90)/360));r>tr?r=tr:r<-tr&&(r=-tr),e[n+1]=r}return e}function cd(s,e,t){const i=s.length;t=t>1?t:2,e===void 0&&(t>2?e=s.slice():e=new Array(i));for(let n=0;n<i;n+=t)e[n]=180*s[n]/En,e[n+1]=360*Math.atan(Math.exp(s[n+1]/ls))/Math.PI-90;return e}const ud=6378137,Pl=[-180,-90,180,90],dd=Math.PI*ud/180;class Xi extends as{constructor(e,t){super({code:e,units:"degrees",extent:Pl,axisOrientation:t,global:!0,metersPerUnit:dd,worldExtent:Pl})}}const Al=[new Xi("CRS:84"),new Xi("EPSG:4326","neu"),new Xi("urn:ogc:def:crs:OGC:1.3:CRS84"),new Xi("urn:ogc:def:crs:OGC:2:84"),new Xi("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Xi("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Xi("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let xo={};function fd(s){return xo[s]||xo[s.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function gd(s,e){xo[s]=e}let xn={};function wn(s,e,t){const i=s.getCode(),n=e.getCode();i in xn||(xn[i]={}),xn[i][n]=t}function _d(s,e){let t;return s in xn&&e in xn[s]&&(t=xn[s][e]),t}const ke={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function at(s){const e=lt();for(let t=0,i=s.length;t<i;++t)fs(e,s[t]);return e}function hs(s,e,t){return t?(t[0]=s[0]-e,t[1]=s[1]-e,t[2]=s[2]+e,t[3]=s[3]+e,t):[s[0]-e,s[1]-e,s[2]+e,s[3]+e]}function Fl(s,e){return e?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e):s.slice()}function Yi(s,e,t){let i,n;return e<s[0]?i=s[0]-e:s[2]<e?i=e-s[2]:i=0,t<s[1]?n=s[1]-t:s[3]<t?n=t-s[3]:n=0,i*i+n*n}function ii(s,e){return wo(s,e[0],e[1])}function Ft(s,e){return s[0]<=e[0]&&e[2]<=s[2]&&s[1]<=e[1]&&e[3]<=s[3]}function wo(s,e,t){return s[0]<=e&&e<=s[2]&&s[1]<=t&&t<=s[3]}function To(s,e){const t=s[0],i=s[1],n=s[2],r=s[3],o=e[0],a=e[1];let l=ke.UNKNOWN;return o<t?l=l|ke.LEFT:o>n&&(l=l|ke.RIGHT),a<i?l=l|ke.BELOW:a>r&&(l=l|ke.ABOVE),l===ke.UNKNOWN&&(l=ke.INTERSECTING),l}function lt(){return[1/0,1/0,-1/0,-1/0]}function ni(s,e,t,i,n){return n?(n[0]=s,n[1]=e,n[2]=t,n[3]=i,n):[s,e,t,i]}function cs(s){return ni(1/0,1/0,-1/0,-1/0,s)}function us(s,e){const t=s[0],i=s[1];return ni(t,i,t,i,e)}function So(s,e,t,i,n){const r=cs(n);return Ol(r,s,e,t,i)}function Ui(s,e){return s[0]==e[0]&&s[2]==e[2]&&s[1]==e[1]&&s[3]==e[3]}function ds(s,e){return e[0]<s[0]&&(s[0]=e[0]),e[2]>s[2]&&(s[2]=e[2]),e[1]<s[1]&&(s[1]=e[1]),e[3]>s[3]&&(s[3]=e[3]),s}function fs(s,e){e[0]<s[0]&&(s[0]=e[0]),e[0]>s[2]&&(s[2]=e[0]),e[1]<s[1]&&(s[1]=e[1]),e[1]>s[3]&&(s[3]=e[1])}function Ol(s,e,t,i,n){for(;t<i;t+=n)md(s,e[t],e[t+1]);return s}function md(s,e,t){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}function Ro(s,e){let t;return t=e(Tn(s)),t||(t=e(Sn(s)),t)||(t=e(gs(s)),t)||(t=e(Xt(s)),t)?t:!1}function Io(s){let e=0;return Rn(s)||(e=fe(s)*Ge(s)),e}function Tn(s){return[s[0],s[1]]}function Sn(s){return[s[2],s[1]]}function Ue(s){return[(s[0]+s[2])/2,(s[1]+s[3])/2]}function pd(s,e){let t;if(e==="bottom-left")t=Tn(s);else if(e==="bottom-right")t=Sn(s);else if(e==="top-left")t=Xt(s);else if(e==="top-right")t=gs(s);else throw new Error("Invalid corner");return t}function ir(s,e,t,i,n){const[r,o,a,l,h,u,f,g]=Lo(s,e,t,i);return ni(Math.min(r,a,h,f),Math.min(o,l,u,g),Math.max(r,a,h,f),Math.max(o,l,u,g),n)}function Lo(s,e,t,i){const n=e*i[0]/2,r=e*i[1]/2,o=Math.cos(t),a=Math.sin(t),l=n*o,h=n*a,u=r*o,f=r*a,g=s[0],_=s[1];return[g-l+f,_-h-u,g-l-f,_-h+u,g+l-f,_+h+u,g+l+f,_+h-u,g-l+f,_-h-u]}function Ge(s){return s[3]-s[1]}function Hi(s,e,t){const i=t||lt();return ze(s,e)?(s[0]>e[0]?i[0]=s[0]:i[0]=e[0],s[1]>e[1]?i[1]=s[1]:i[1]=e[1],s[2]<e[2]?i[2]=s[2]:i[2]=e[2],s[3]<e[3]?i[3]=s[3]:i[3]=e[3]):cs(i),i}function Xt(s){return[s[0],s[3]]}function gs(s){return[s[2],s[3]]}function fe(s){return s[2]-s[0]}function ze(s,e){return s[0]<=e[2]&&s[2]>=e[0]&&s[1]<=e[3]&&s[3]>=e[1]}function Rn(s){return s[2]<s[0]||s[3]<s[1]}function yd(s,e){return e?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e):s}function vd(s,e){const t=(s[2]-s[0])/2*(e-1),i=(s[3]-s[1])/2*(e-1);s[0]-=t,s[2]+=t,s[1]-=i,s[3]+=i}function Ed(s,e,t){let i=!1;const n=To(s,e),r=To(s,t);if(n===ke.INTERSECTING||r===ke.INTERSECTING)i=!0;else{const o=s[0],a=s[1],l=s[2],h=s[3],u=e[0],f=e[1],g=t[0],_=t[1],p=(_-f)/(g-u);let y,E;r&ke.ABOVE&&!(n&ke.ABOVE)&&(y=g-(_-h)/p,i=y>=o&&y<=l),!i&&r&ke.RIGHT&&!(n&ke.RIGHT)&&(E=_-(g-l)*p,i=E>=a&&E<=h),!i&&r&ke.BELOW&&!(n&ke.BELOW)&&(y=g-(_-a)/p,i=y>=o&&y<=l),!i&&r&ke.LEFT&&!(n&ke.LEFT)&&(E=_-(g-o)*p,i=E>=a&&E<=h)}return i}function Nl(s,e){const t=e.getExtent(),i=Ue(s);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const n=fe(t),o=Math.floor((i[0]-t[0])/n)*n;s[0]-=o,s[2]-=o}return s}function Cd(s,e){if(e.canWrapX()){const t=e.getExtent();if(!isFinite(s[0])||!isFinite(s[2]))return[[t[0],s[1],t[2],s[3]]];Nl(s,e);const i=fe(t);if(fe(s)>i)return[[t[0],s[1],t[2],s[3]]];if(s[0]<t[0])return[[s[0]+i,s[1],t[2],s[3]],[t[0],s[1],s[2],s[3]]];if(s[2]>t[2])return[[s[0],s[1],t[2],s[3]],[t[0],s[1],s[2]-i,s[3]]]}return[s]}function Re(s,e,t){return Math.min(Math.max(s,e),t)}function xd(s,e,t,i,n,r){const o=n-t,a=r-i;if(o!==0||a!==0){const l=((s-t)*o+(e-i)*a)/(o*o+a*a);l>1?(t=n,i=r):l>0&&(t+=o*l,i+=a*l)}return si(s,e,t,i)}function si(s,e,t,i){const n=t-s,r=i-e;return n*n+r*r}function wd(s){const e=s.length;for(let i=0;i<e;i++){let n=i,r=Math.abs(s[i][i]);for(let a=i+1;a<e;a++){const l=Math.abs(s[a][i]);l>r&&(r=l,n=a)}if(r===0)return null;const o=s[n];s[n]=s[i],s[i]=o;for(let a=i+1;a<e;a++){const l=-s[a][i]/s[i][i];for(let h=i;h<e+1;h++)i==h?s[a][h]=0:s[a][h]+=l*s[i][h]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=s[i][e]/s[i][i];for(let n=i-1;n>=0;n--)s[n][e]-=s[n][i]*t[i]}return t}function nr(s){return s*Math.PI/180}function Zi(s,e){const t=s%e;return t*e<0?t+e:t}function _t(s,e,t){return s+t*(e-s)}function sr(s,e){const t=Math.pow(10,e);return Math.round(s*t)/t}function rr(s,e){return Math.floor(sr(s,e))}function vi(s,e){return Math.ceil(sr(s,e))}function Td(s,e){return s[0]+=+e[0],s[1]+=+e[1],s}function Dl(s,e){const t=s[0],i=s[1],n=e[0],r=e[1],o=n[0],a=n[1],l=r[0],h=r[1],u=l-o,f=h-a,g=u===0&&f===0?0:(u*(t-o)+f*(i-a))/(u*u+f*f||0);let _,p;return g<=0?(_=o,p=a):g>=1?(_=l,p=h):(_=o+g*u,p=a+g*f),[_,p]}function Ot(s,e){let t=!0;for(let i=s.length-1;i>=0;--i)if(s[i]!=e[i]){t=!1;break}return t}function bo(s,e){const t=Math.cos(e),i=Math.sin(e),n=s[0]*t-s[1]*i,r=s[1]*t+s[0]*i;return s[0]=n,s[1]=r,s}function Sd(s,e){return s[0]*=e,s[1]*=e,s}function In(s,e){const t=s[0]-e[0],i=s[1]-e[1];return t*t+i*i}function or(s,e){return Math.sqrt(In(s,e))}function Rd(s,e){return In(s,Dl(s,e))}function kl(s,e){if(e.canWrapX()){const t=fe(e.getExtent()),i=Id(s,e,t);i&&(s[0]-=i*t)}return s}function Id(s,e,t){const i=e.getExtent();let n=0;return e.canWrapX()&&(s[0]<i[0]||s[0]>i[2])&&(t=t||fe(i),n=Math.floor((s[0]-i[0])/t)),n}const Ld=63710088e-1;function Gl(s,e,t){t=t||Ld;const i=nr(s[1]),n=nr(e[1]),r=(n-i)/2,o=nr(e[0]-s[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(n);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function zl(...s){console.warn(...s)}let Mo=!0;function bd(s){Mo=!1}function Po(s,e){if(e!==void 0){for(let t=0,i=s.length;t<i;++t)e[t]=s[t];e=e}else e=s.slice();return e}function Vl(s,e){if(e!==void 0&&s!==e){for(let t=0,i=s.length;t<i;++t)e[t]=s[t];s=e}return s}function Md(s){gd(s.getCode(),s),wn(s,s,Po)}function Pd(s){s.forEach(Md)}function ht(s){return typeof s=="string"?fd(s):s||null}function Wl(s,e,t,i){s=ht(s);let n;const r=s.getPointResolutionFunc();if(r)n=r(e,t);else{const o=s.getUnits();if(o=="degrees"||i=="degrees")n=e;else{const a=Fo(s,ht("EPSG:4326"));if(a===Vl&&o!=="degrees")n=e*s.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const u=Gl(h.slice(0,2),h.slice(2,4)),f=Gl(h.slice(4,6),h.slice(6,8));n=(u+f)/2}const l=s.getMetersPerUnit();l!==void 0&&(n/=l)}}return n}function Bl(s){Pd(s),s.forEach(function(e){s.forEach(function(t){e!==t&&wn(e,t,Po)})})}function Ad(s,e,t,i){s.forEach(function(n){e.forEach(function(r){wn(n,r,t),wn(r,n,i)})})}function Ao(s,e){return s?typeof s=="string"?ht(s):s:ht(e)}function jl(s){return function(e,t,i){const n=e.length;i=i!==void 0?i:2,t=t!==void 0?t:new Array(n);for(let r=0;r<n;r+=i){const o=s(e.slice(r,r+i)),a=o.length;for(let l=0,h=i;l<h;++l)t[r+l]=l>=a?e[r+l]:o[l]}return t}}function Fd(s,e,t,i){const n=ht(s),r=ht(e);wn(n,r,jl(t)),wn(r,n,jl(i))}function Ei(s,e){if(s===e)return!0;const t=s.getUnits()===e.getUnits();return(s.getCode()===e.getCode()||Fo(s,e)===Po)&&t}function Fo(s,e){const t=s.getCode(),i=e.getCode();let n=_d(t,i);return n||(n=Vl),n}function ar(s,e){const t=ht(s),i=ht(e);return Fo(t,i)}function Od(s,e,t){return ar(e,t)(s,void 0,s.length)}function Ln(s,e){return s}function we(s,e){return Mo&&!Ot(s,[0,0])&&s[0]>=-180&&s[0]<=180&&s[1]>=-90&&s[1]<=90&&(Mo=!1,zl("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),s}function Oo(s,e){return s}function Yt(s,e){return s}function Nd(){Bl(Ml),Bl(Al),Ad(Al,Ml,hd,cd)}Nd();class ri extends vn{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==le.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==le.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==le.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==le.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function No(s){const e=s.length;let t=0,i=0;for(let n=0;n<e;n++)t+=s[n].clientX,i+=s[n].clientY;return{clientX:t/e,clientY:i/e}}function he(s,e){if(!s)throw new Error(e)}new Array(6);function Nt(){return[1,0,0,1,0,0]}function Dd(s,e,t,i,n,r,o){return s[0]=e,s[1]=t,s[2]=i,s[3]=n,s[4]=r,s[5]=o,s}function kd(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=e[4],s[5]=e[5],s}function Oe(s,e){const t=e[0],i=e[1];return e[0]=s[0]*t+s[2]*i+s[4],e[1]=s[1]*t+s[3]*i+s[5],e}function Gd(s,e,t){return Dd(s,e,0,0,t,0,0)}function Dt(s,e,t,i,n,r,o,a){const l=Math.sin(r),h=Math.cos(r);return s[0]=i*h,s[1]=n*l,s[2]=-i*l,s[3]=n*h,s[4]=o*i*h-a*i*l+e,s[5]=o*n*l+a*n*h+t,s}function lr(s,e){const t=zd(e);he(t!==0,"Transformation matrix cannot be inverted");const i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=e[5];return s[0]=o/t,s[1]=-n/t,s[2]=-r/t,s[3]=i/t,s[4]=(r*l-o*a)/t,s[5]=-(i*l-n*a)/t,s}function zd(s){return s[0]*s[3]-s[1]*s[2]}const Xl=[1e6,1e6,1e6,1e6,2,2];function Do(s){return"matrix("+s.map((t,i)=>Math.round(t*Xl[i])/Xl[i]).join(", ")+")"}function Ci(s,e,t,i,n,r){r=r||[];let o=0;for(let a=e;a<t;a+=i){const l=s[a],h=s[a+1];r[o++]=n[0]*l+n[2]*h+n[4],r[o++]=n[1]*l+n[3]*h+n[5]}return r&&r.length!=o&&(r.length=o),r}function ko(s,e,t,i,n,r,o){o=o||[];const a=Math.cos(n),l=Math.sin(n),h=r[0],u=r[1];let f=0;for(let g=e;g<t;g+=i){const _=s[g]-h,p=s[g+1]-u;o[f++]=h+_*a-p*l,o[f++]=u+_*l+p*a;for(let y=g+2;y<g+i;++y)o[f++]=s[y]}return o&&o.length!=f&&(o.length=f),o}function Vd(s,e,t,i,n,r,o,a){a=a||[];const l=o[0],h=o[1];let u=0;for(let f=e;f<t;f+=i){const g=s[f]-l,_=s[f+1]-h;a[u++]=l+n*g,a[u++]=h+r*_;for(let p=f+2;p<f+i;++p)a[u++]=s[p]}return a&&a.length!=u&&(a.length=u),a}function Wd(s,e,t,i,n,r,o){o=o||[];let a=0;for(let l=e;l<t;l+=i){o[a++]=s[l]+n,o[a++]=s[l+1]+r;for(let h=l+2;h<l+i;++h)o[a++]=s[h]}return o&&o.length!=a&&(o.length=a),o}const Yl=Nt();class Ul extends At{constructor(){super(),this.extent_=lt(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Rl((e,t,i)=>{if(!i)return this.getSimplifiedGeometry(t);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return ue()}closestPointXY(e,t,i,n){return ue()}containsXY(e,t){const i=this.getClosestPoint([e,t]);return i[0]===e&&i[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return ue()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&cs(t),this.extentRevision_=this.getRevision()}return yd(this.extent_,e)}rotate(e,t){ue()}scale(e,t,i){ue()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return ue()}getType(){return ue()}applyTransform(e){ue()}intersectsExtent(e){return ue()}translate(e,t){ue()}transform(e,t){const i=ht(e),n=i.getUnits()=="tile-pixels"?function(r,o,a){const l=i.getExtent(),h=i.getWorldExtent(),u=Ge(h)/Ge(l);return Dt(Yl,h[0],h[3],u,-u,0,0,0),Ci(r,0,r.length,a,Yl,o),ar(i,t)(r,o,a)}:ar(i,t);return this.applyTransform(n),this}}class xi extends Ul{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return So(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return ue()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=hr(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){ue()}setLayout(e,t,i){let n;if(e)n=hr(e);else{for(let r=0;r<i;++r){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}n=t.length,e=Bd(n)}this.layout=e,this.stride=n}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();ko(i,0,i.length,n,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=Ue(this.getExtent()));const n=this.getFlatCoordinates();if(n){const r=this.getStride();Vd(n,0,n.length,r,e,t,i,n),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();Wd(i,0,i.length,n,e,t,i),this.changed()}}}function Bd(s){let e;return s==2?e="XY":s==3?e="XYZ":s==4&&(e="XYZM"),e}function hr(s){let e;return s=="XY"?e=2:s=="XYZ"||s=="XYM"?e=3:s=="XYZM"&&(e=4),e}function jd(s,e,t){const i=s.getFlatCoordinates();if(!i)return null;const n=s.getStride();return Ci(i,0,i.length,n,e,t)}function Hl(s,e,t,i,n,r,o){const a=s[e],l=s[e+1],h=s[t]-a,u=s[t+1]-l;let f;if(h===0&&u===0)f=e;else{const g=((n-a)*h+(r-l)*u)/(h*h+u*u);if(g>1)f=t;else if(g>0){for(let _=0;_<i;++_)o[_]=_t(s[e+_],s[t+_],g);o.length=i;return}else f=e}for(let g=0;g<i;++g)o[g]=s[f+g];o.length=i}function Go(s,e,t,i,n){let r=s[e],o=s[e+1];for(e+=i;e<t;e+=i){const a=s[e],l=s[e+1],h=si(r,o,a,l);h>n&&(n=h),r=a,o=l}return n}function zo(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];n=Go(s,e,a,i,n),e=a}return n}function Xd(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];n=zo(s,e,a,i,n),e=a[a.length-1]}return n}function Vo(s,e,t,i,n,r,o,a,l,h,u){if(e==t)return h;let f,g;if(n===0){if(g=si(o,a,s[e],s[e+1]),g<h){for(f=0;f<i;++f)l[f]=s[e+f];return l.length=i,g}return h}u=u||[NaN,NaN];let _=e+i;for(;_<t;)if(Hl(s,_-i,_,i,o,a,u),g=si(o,a,u[0],u[1]),g<h){for(h=g,f=0;f<i;++f)l[f]=u[f];l.length=i,_+=i}else _+=i*Math.max((Math.sqrt(g)-Math.sqrt(h))/n|0,1);if(r&&(Hl(s,t-i,e,i,o,a,u),g=si(o,a,u[0],u[1]),g<h)){for(h=g,f=0;f<i;++f)l[f]=u[f];l.length=i}return h}function Wo(s,e,t,i,n,r,o,a,l,h,u){u=u||[NaN,NaN];for(let f=0,g=t.length;f<g;++f){const _=t[f];h=Vo(s,e,_,i,n,r,o,a,l,h,u),e=_}return h}function Yd(s,e,t,i,n,r,o,a,l,h,u){u=u||[NaN,NaN];for(let f=0,g=t.length;f<g;++f){const _=t[f];h=Wo(s,e,_,i,n,r,o,a,l,h,u),e=_[_.length-1]}return h}function Zl(s,e,t,i){for(let n=0,r=t.length;n<r;++n)s[e++]=t[n];return e}function cr(s,e,t,i){for(let n=0,r=t.length;n<r;++n){const o=t[n];for(let a=0;a<i;++a)s[e++]=o[a]}return e}function Bo(s,e,t,i,n){n=n||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=cr(s,e,t[o],i);n[r++]=l,e=l}return n.length=r,n}function Ud(s,e,t,i,n){n=n||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=Bo(s,e,t[o],i,n[r]);l.length===0&&(l[0]=e),n[r++]=l,e=l[l.length-1]}return n.length=r,n}function ur(s,e,t,i,n,r,o){const a=(t-e)/i;if(a<3){for(;e<t;e+=i)r[o++]=s[e],r[o++]=s[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-i];let u=0;for(;h.length>0;){const f=h.pop(),g=h.pop();let _=0;const p=s[g],y=s[g+1],E=s[f],x=s[f+1];for(let C=g+i;C<f;C+=i){const T=s[C],S=s[C+1],R=xd(T,S,p,y,E,x);R>_&&(u=C,_=R)}_>n&&(l[(u-e)/i]=1,g+i<u&&h.push(g,u),u+i<f&&h.push(u,f))}for(let f=0;f<a;++f)l[f]&&(r[o++]=s[e+f*i],r[o++]=s[e+f*i+1]);return o}function Kl(s,e,t,i,n,r,o,a){for(let l=0,h=t.length;l<h;++l){const u=t[l];o=ur(s,e,u,i,n,r,o),a.push(o),e=u}return o}function Ki(s,e){return e*Math.round(s/e)}function Hd(s,e,t,i,n,r,o){if(e==t)return o;let a=Ki(s[e],n),l=Ki(s[e+1],n);e+=i,r[o++]=a,r[o++]=l;let h,u;do if(h=Ki(s[e],n),u=Ki(s[e+1],n),e+=i,e==t)return r[o++]=h,r[o++]=u,o;while(h==a&&u==l);for(;e<t;){const f=Ki(s[e],n),g=Ki(s[e+1],n);if(e+=i,f==h&&g==u)continue;const _=h-a,p=u-l,y=f-a,E=g-l;if(_*E==p*y&&(_<0&&y<_||_==y||_>0&&y>_)&&(p<0&&E<p||p==E||p>0&&E>p)){h=f,u=g;continue}r[o++]=h,r[o++]=u,a=h,l=u,h=f,u=g}return r[o++]=h,r[o++]=u,o}function jo(s,e,t,i,n,r,o,a){for(let l=0,h=t.length;l<h;++l){const u=t[l];o=Hd(s,e,u,i,n,r,o),a.push(o),e=u}return o}function Zd(s,e,t,i,n,r,o,a){for(let l=0,h=t.length;l<h;++l){const u=t[l],f=[];o=jo(s,e,u,i,n,r,o,f),a.push(f),e=u[u.length-1]}return o}function wi(s,e,t,i,n){n=n!==void 0?n:[];let r=0;for(let o=e;o<t;o+=i)n[r++]=s.slice(o,o+i);return n.length=r,n}function _s(s,e,t,i,n){n=n!==void 0?n:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];n[r++]=wi(s,e,l,i,n[r]),e=l}return n.length=r,n}function Xo(s,e,t,i,n){n=n!==void 0?n:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];n[r++]=l.length===1&&l[0]===e?[]:_s(s,e,l,i,n[r]),e=l[l.length-1]}return n.length=r,n}function ql(s,e,t,i){let n=0,r=s[t-i],o=s[t-i+1];for(;e<t;e+=i){const a=s[e],l=s[e+1];n+=o*a-r*l,r=a,o=l}return n/2}function $l(s,e,t,i){let n=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];n+=ql(s,e,a,i),e=a}return n}function Kd(s,e,t,i){let n=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];n+=$l(s,e,a,i),e=a[a.length-1]}return n}class ms extends xi{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new ms(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,n){return n<Yi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Go(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Vo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,n))}getArea(){return ql(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return wi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=ur(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new ms(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=cr(this.flatCoordinates,0,e,this.stride),this.changed()}}class Ve extends xi{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Ve(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const r=this.flatCoordinates,o=si(e,t,r[0],r[1]);if(o<n){const a=this.stride;for(let l=0;l<a;++l)i[l]=r[l];return i.length=a,o}return n}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return us(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return wo(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Zl(this.flatCoordinates,0,e,this.stride),this.changed()}}function qd(s,e,t,i,n){return!Ro(n,function(o){return!qi(s,e,t,i,o[0],o[1])})}function qi(s,e,t,i,n,r){let o=0,a=s[t-i],l=s[t-i+1];for(;e<t;e+=i){const h=s[e],u=s[e+1];l<=r?u>r&&(h-a)*(r-l)-(n-a)*(u-l)>0&&o++:u<=r&&(h-a)*(r-l)-(n-a)*(u-l)<0&&o--,a=h,l=u}return o!==0}function Yo(s,e,t,i,n,r){if(t.length===0||!qi(s,e,t[0],i,n,r))return!1;for(let o=1,a=t.length;o<a;++o)if(qi(s,t[o-1],t[o],i,n,r))return!1;return!0}function $d(s,e,t,i,n,r){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(Yo(s,e,l,i,n,r))return!0;e=l[l.length-1]}return!1}function Uo(s,e,t,i,n,r,o){let a,l,h,u,f,g,_;const p=n[r+1],y=[];for(let C=0,T=t.length;C<T;++C){const S=t[C];for(u=s[S-i],g=s[S-i+1],a=e;a<S;a+=i)f=s[a],_=s[a+1],(p<=g&&_<=p||g<=p&&p<=_)&&(h=(p-g)/(_-g)*(f-u)+u,y.push(h)),u=f,g=_}let E=NaN,x=-1/0;for(y.sort(Bi),u=y[0],a=1,l=y.length;a<l;++a){f=y[a];const C=Math.abs(f-u);C>x&&(h=(u+f)/2,Yo(s,e,t,i,h,p)&&(E=h,x=C)),u=f}return isNaN(E)&&(E=n[r]),o?(o.push(E,p,x),o):[E,p,x]}function Jl(s,e,t,i,n){let r=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];r=Uo(s,e,l,i,n,2*o,r),e=l[l.length-1]}return r}function Ql(s,e,t,i,n){let r;for(e+=i;e<t;e+=i)if(r=n(s.slice(e-i,e),s.slice(e,e+i)),r)return r;return!1}function dr(s,e,t,i,n){const r=Ol(lt(),s,e,t,i);return ze(n,r)?Ft(n,r)||r[0]>=n[0]&&r[2]<=n[2]||r[1]>=n[1]&&r[3]<=n[3]?!0:Ql(s,e,t,i,function(o,a){return Ed(n,o,a)}):!1}function Jd(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){if(dr(s,e,t[r],i,n))return!0;e=t[r]}return!1}function eh(s,e,t,i,n){return!!(dr(s,e,t,i,n)||qi(s,e,t,i,n[0],n[1])||qi(s,e,t,i,n[0],n[3])||qi(s,e,t,i,n[2],n[1])||qi(s,e,t,i,n[2],n[3]))}function th(s,e,t,i,n){if(!eh(s,e,t[0],i,n))return!1;if(t.length===1)return!0;for(let r=1,o=t.length;r<o;++r)if(qd(s,t[r-1],t[r],i,n)&&!dr(s,t[r-1],t[r],i,n))return!1;return!0}function Qd(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(th(s,e,a,i,n))return!0;e=a[a.length-1]}return!1}function ef(s,e,t,i){for(;e<t-i;){for(let n=0;n<i;++n){const r=s[e+n];s[e+n]=s[t-i+n],s[t-i+n]=r}e+=i,t-=i}}function Ho(s,e,t,i){let n=0,r=s[t-i],o=s[t-i+1];for(;e<t;e+=i){const a=s[e],l=s[e+1];n+=(a-r)*(l+o),r=a,o=l}return n===0?void 0:n>0}function ih(s,e,t,i,n){n=n!==void 0?n:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=Ho(s,e,a,i);if(r===0){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;e=a}return!0}function tf(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(!ih(s,e,a,i,n))return!1;a.length&&(e=a[a.length-1])}return!0}function Zo(s,e,t,i,n){n=n!==void 0?n:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=Ho(s,e,a,i);(r===0?n&&l||!n&&!l:n&&!l||!n&&l)&&ef(s,e,a,i),e=a}return e}function nh(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r)e=Zo(s,e,t[r],i,n);return e}function nf(s,e){const t=[];let i=0,n=0,r;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=Ho(s,i,l,2);if(r===void 0&&(r=h),h===r)t.push(e.slice(n,o+1));else{if(t.length===0)continue;t[t.length-1].push(e[n])}n=o+1,i=l}return t}class tt extends xi{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?Ct(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new tt(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<Yi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(zo(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Wo(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,n))}containsXY(e,t){return Yo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return $l(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Zo(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,_s(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Ue(this.getExtent());this.flatInteriorPoint_=Uo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ve(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new ms(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,n=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new ms(t.slice(r,l),e);n.push(h),r=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;ih(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Zo(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=jo(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new tt(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return th(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Bo(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function $i(s){if(Rn(s))throw new Error("Cannot create polygon from empty extent");const e=s[0],t=s[1],i=s[2],n=s[3],r=[e,t,e,n,i,n,i,t,e,t];return new tt(r,"XY",[r.length])}function sh(s,e,t){e=e||32;const i=s.getStride(),n=s.getLayout(),r=s.getCenter(),o=i*(e+1),a=new Array(o);for(let u=0;u<o;u+=i){a[u]=0,a[u+1]=0;for(let f=2;f<i;f++)a[u+f]=r[f]}const l=[a.length],h=new tt(a,n,l);return sf(h,r,s.getRadius()),h}function sf(s,e,t,i){const n=s.getFlatCoordinates(),r=s.getStride(),o=n.length/r-1,a=0;for(let l=0;l<=o;++l){const h=l*r,u=a+Zi(l,o)*2*Math.PI/o;n[h]=e[0]+t*Math.cos(u),n[h+1]=e[1]+t*Math.sin(u)}s.changed()}class rf extends vo{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(e[0],t[0])+i,n.top=Math.min(e[1],t[1])+i,n.width=Math.abs(t[0]-e[0])+i,n.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new tt([n])}getGeometry(){return this.geometry_}}const Ti=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",of=Ti.includes("firefox");Ti.includes("safari")&&!Ti.includes("chrom")&&(Ti.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Ti));const af=Ti.includes("webkit")&&!Ti.includes("edge"),rh=Ti.includes("macintosh"),oh=typeof devicePixelRatio<"u"?devicePixelRatio:1,ah=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Ko=typeof Image<"u"&&Image.prototype.decode,lf=typeof createImageBitmap=="function",lh=function(){let s=!1;try{const e=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return s}();function qo(s){const e=arguments;return function(t){let i=!0;for(let n=0,r=e.length;n<r&&(i=i&&e[n](t),!!i);++n);return i}}const hf=function(s){const e=s.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},cf=function(s){const e=s.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},uf=function(s){const e=s.map.getTargetElement(),t=s.map.getOwnerDocument().activeElement;return e.contains(t)},hh=function(s){return s.map.getTargetElement().hasAttribute("tabindex")?uf(s):!0},ps=jt,ch=function(s){const e=s.originalEvent;return e.button==0&&!(af&&rh&&e.ctrlKey)},$o=_n,uh=function(s){return s.type==le.SINGLECLICK},fr=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},df=function(s){const e=s.originalEvent;return rh?e.metaKey:e.ctrlKey},ys=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},dh=function(s){const e=s.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Jo=function(s){const e=s.originalEvent;return he(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},Qo=function(s){const e=s.originalEvent;return he(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0},gr={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class ea extends ot{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class ff extends ri{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new rf(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:ch,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const n=i[0]-t[0],r=i[1]-t[1];return n*n+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new ea(gr.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new ea(t?gr.BOXEND:gr.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ea(gr.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}class ta extends ri{constructor(e){super({stopDown:_n}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:qo(fr,Qo);this.condition_=e.onFocusOnly?qo(hh,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,n=t.getEventPixel(No(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const r=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],a=e.map.getView();Sd(r,a.getResolution()),bo(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-n*Math.cos(r),a[1]-n*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:ji})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}function ia(s){if(s!==void 0)return 0}function fh(s){if(s!==void 0)return s}function gf(s){const e=2*Math.PI/s;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function _f(s){const e=nr(5);return function(t,i){return i||t===void 0?t:Math.abs(t)<=e?0:t}}class mf extends ri{constructor(e){e=e||{},super({stopDown:_n}),this.condition_=e.condition?e.condition:cf,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Jo(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===ia)return;const n=t.getSize(),r=e.pixel,o=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Jo(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Jo(e)&&ch(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class pf extends ff{constructor(e){e=e||{};const t=e.condition?e.condition:ys;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(r),a=i.getResolution()/o;n=n.clone(),n.scale(a*a)}i.fitInternal(n,{duration:this.duration_,easing:ji})}}class Ji extends xi{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Ji(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const r=this.flatCoordinates,o=e-r[0],a=t-r[1],l=o*o+a*a;if(l<n){if(l===0)for(let h=0;h<this.stride;++h)i[h]=r[h];else{const h=this.getRadius()/Math.sqrt(l);i[0]=r[0]+h*o,i[1]=r[1]+h*a;for(let u=2;u<this.stride;++u)i[u]=r[u]}return i.length=this.stride,l}return n}containsXY(e,t){const i=this.flatCoordinates,n=e-i[0],r=t-i[1];return n*n+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return ni(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(ze(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:Ro(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+i;for(let r=1;r<t;++r)n[t+r]=e[r];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let r=Zl(n,0,e,this.stride);n[r++]=n[0]+t;for(let o=1,a=this.stride;o<a;++o)n[r++]=n[o];n.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),n=this.getStride();this.setCenter(ko(i,0,i.length,n,e,t,i)),this.changed()}}Ji.prototype.transform;class Pe extends At{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Pe(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(me(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=re(e,q.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?yf(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function yf(s){if(typeof s=="function")return s;let e;return Array.isArray(s)?e=s:(he(typeof s.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[s]),function(){return e}}class vs extends Ul{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(me),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,i=e.length;t<i;++t)this.changeEventsKeys_.push(re(e[t],q.CHANGE,this.changed,this))}clone(){const e=new vs(na(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,i,n){if(n<Yi(this.getExtent(),e,t))return n;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)n=r[o].closestPointXY(e,t,i,n);return n}containsXY(e,t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)if(i[n].containsXY(e,t))return!0;return!1}computeExtent(e){cs(e);const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)ds(e,t[i].getExtent());return e}getGeometries(){return na(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let n=!1;for(let r=0,o=i.length;r<o;++r){const a=i[r],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(n=!0)}return n?new vs(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].rotate(e,t);this.changed()}scale(e,t,i){i||(i=Ue(this.getExtent()));const n=this.geometries_;for(let r=0,o=n.length;r<o;++r)n[r].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(na(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function na(s){return s.map(e=>e.clone())}function _r(s,e,t,i,n,r,o){let a,l;const h=(t-e)/i;if(h===1)a=e;else if(h===2)a=e,l=n;else if(h!==0){let u=s[e],f=s[e+1],g=0;const _=[0];for(let E=e+i;E<t;E+=i){const x=s[E],C=s[E+1];g+=Math.sqrt((x-u)*(x-u)+(C-f)*(C-f)),_.push(g),u=x,f=C}const p=n*g,y=Ju(_,p);y<0?(l=(p-_[-y-2])/(_[-y-1]-_[-y-2]),a=e+(-y-2)*i):a=e+y*i}o=o>1?o:2,r=r||new Array(o);for(let u=0;u<o;++u)r[u]=a===void 0?NaN:l===void 0?s[a+u]:_t(s[a+u],s[a+i+u],l);return r}function sa(s,e,t,i,n,r){if(t==e)return null;let o;if(n<s[e+i-1])return r?(o=s.slice(e,e+i),o[i-1]=n,o):null;if(s[t-1]<n)return r?(o=s.slice(t-i,t),o[i-1]=n,o):null;if(n==s[e+i-1])return s.slice(e,e+i);let a=e/i,l=t/i;for(;a<l;){const g=a+l>>1;n<s[(g+1)*i-1]?l=g:a=g+1}const h=s[a*i-1];if(n==h)return s.slice((a-1)*i,(a-1)*i+i);const u=s[(a+1)*i-1],f=(n-h)/(u-h);o=[];for(let g=0;g<i-1;++g)o.push(_t(s[(a-1)*i+g],s[a*i+g],f));return o.push(n),o}function vf(s,e,t,i,n,r,o){if(o)return sa(s,e,t[t.length-1],i,n,r);let a;if(n<s[i-1])return r?(a=s.slice(0,i),a[i-1]=n,a):null;if(s[s.length-1]<n)return r?(a=s.slice(s.length-i),a[i-1]=n,a):null;for(let l=0,h=t.length;l<h;++l){const u=t[l];if(e!=u){if(n<s[e+i-1])return null;if(n<=s[u-1])return sa(s,e,u,i,n,!1);e=u}}return null}function gh(s,e,t,i){let n=s[e],r=s[e+1],o=0;for(let a=e+i;a<t;a+=i){const l=s[a],h=s[a+1];o+=Math.sqrt((l-n)*(l-n)+(h-r)*(h-r)),n=l,r=h}return o}class kt extends xi{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){Ct(this.flatCoordinates,e),this.changed()}clone(){const e=new kt(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<Yi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Go(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Vo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,n))}forEachSegment(e){return Ql(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,sa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return wi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return _r(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return gh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=ur(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new kt(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return dr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=cr(this.flatCoordinates,0,e,this.stride),this.changed()}}class bn extends ot{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class oi extends bn{constructor(e,t,i,n,r,o){super(e,t,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}class Es extends xi{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{const n=e,r=[],o=[];for(let l=0,h=n.length;l<h;++l){const u=n[l];Ct(r,u.getFlatCoordinates()),o.push(r.length)}const a=n.length===0?this.getLayout():n[0].getLayout();this.setFlatCoordinates(a,r),this.ends_=o}}appendLineString(e){Ct(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Es(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<Yi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(zo(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Wo(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,n))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,vf(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return _s(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new kt(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,n=[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=new kt(e.slice(r,l),i);n.push(h),r=l}return n}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const n=this.ends_,r=this.stride;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=_r(t,i,l,r,.5);Ct(e,h),i=l}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=Kl(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new Es(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return Jd(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Bo(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class mr extends xi{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){Ct(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new mr(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){if(n<Yi(this.getExtent(),e,t))return n;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=si(e,t,r[a],r[a+1]);if(h<n){n=h;for(let u=0;u<o;++u)i[u]=r[a+u];i.length=o}}return n}getCoordinates(){return wi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new Ve(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,n=[];for(let r=0,o=e.length;r<o;r+=i){const a=new Ve(e.slice(r,r+i),t);n.push(a)}return n}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let n=0,r=t.length;n<r;n+=i){const o=t[n],a=t[n+1];if(wo(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=cr(this.flatCoordinates,0,e,this.stride),this.changed()}}function _h(s,e,t,i){const n=[];let r=lt();for(let o=0,a=t.length;o<a;++o){const l=t[o];r=So(s,e,l[0],i),n.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=l[l.length-1]}return n}class Cs extends xi{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){const n=e,r=[],o=[];for(let a=0,l=n.length;a<l;++a){const h=n[a],u=r.length,f=h.getEnds();for(let g=0,_=f.length;g<_;++g)f[g]+=u;Ct(r,h.getFlatCoordinates()),o.push(f)}t=n.length===0?this.getLayout():n[0].getLayout(),e=r,i=o}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;Ct(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let n=0,r=t.length;n<r;++n)t[n]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=this.endss_[n].slice();const i=new Cs(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,n){return n<Yi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xd(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,n))}containsXY(e,t){return $d(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return Kd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),nh(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,Xo(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=_h(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Jl(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new mr(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;tf(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=nh(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=Zd(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new Cs(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const i=this.endss_[e].slice(),n=i[i.length-1];if(t!==0)for(let r=0,o=i.length;r<o;++r)i[r]-=t;return new tt(this.flatCoordinates.slice(t,n),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,n=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(r!==0)for(let f=0,g=l.length;f<g;++f)l[f]-=r;const u=new tt(t.slice(r,h),e,l);n.push(u),r=h}return n}getType(){return"MultiPolygon"}intersectsExtent(e){return Qd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=Ud(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const n=i[i.length-1];this.flatCoordinates.length=n.length===0?0:n[n.length-1]}this.changed()}}const pe={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class mh extends At{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[pe.OPACITY]=e.opacity!==void 0?e.opacity:1,he(typeof t[pe.OPACITY]=="number","Layer opacity must be a number"),t[pe.VISIBLE]=e.visible!==void 0?e.visible:!0,t[pe.Z_INDEX]=e.zIndex,t[pe.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[pe.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[pe.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[pe.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=Re(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return ue()}getLayerStatesArray(e){return ue()}getExtent(){return this.get(pe.EXTENT)}getMaxResolution(){return this.get(pe.MAX_RESOLUTION)}getMinResolution(){return this.get(pe.MIN_RESOLUTION)}getMinZoom(){return this.get(pe.MIN_ZOOM)}getMaxZoom(){return this.get(pe.MAX_ZOOM)}getOpacity(){return this.get(pe.OPACITY)}getSourceState(){return ue()}getVisible(){return this.get(pe.VISIBLE)}getZIndex(){return this.get(pe.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(pe.EXTENT,e)}setMaxResolution(e){this.set(pe.MAX_RESOLUTION,e)}setMinResolution(e){this.set(pe.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(pe.MAX_ZOOM,e)}setMinZoom(e){this.set(pe.MIN_ZOOM,e)}setOpacity(e){he(typeof e=="number","Layer opacity must be a number"),this.set(pe.OPACITY,e)}setVisible(e){this.set(pe.VISIBLE,e)}setZIndex(e){this.set(pe.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const xt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},We={ANIMATING:0,INTERACTING:1},mt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},Ef=42,xs=256;function ph(s,e,t){return function(i,n,r,o,a){if(!i)return;if(!n&&!e)return i;const l=e?0:r[0]*n,h=e?0:r[1]*n,u=a?a[0]:0,f=a?a[1]:0;let g=s[0]+l/2+u,_=s[2]-l/2+u,p=s[1]+h/2+f,y=s[3]-h/2+f;g>_&&(g=(_+g)/2,_=g),p>y&&(p=(y+p)/2,y=p);let E=Re(i[0],g,_),x=Re(i[1],p,y);if(o&&t&&n){const C=30*n;E+=-C*Math.log(1+Math.max(0,g-i[0])/C)+C*Math.log(1+Math.max(0,i[0]-_)/C),x+=-C*Math.log(1+Math.max(0,p-i[1])/C)+C*Math.log(1+Math.max(0,i[1]-y)/C)}return[E,x]}}function Cf(s){return s}function ra(s,e,t,i){const n=fe(e)/t[0],r=Ge(e)/t[1];return i?Math.min(s,Math.max(n,r)):Math.min(s,Math.min(n,r))}function oa(s,e,t){let i=Math.min(s,e);const n=50;return i*=Math.log(1+n*Math.max(0,s/e-1))/n+1,t&&(i=Math.max(i,t),i/=Math.log(1+n*Math.max(0,t/s-1))/n+1),Re(i,t/2,e*2)}function xf(s,e,t,i){return e=e!==void 0?e:!0,function(n,r,o,a){if(n!==void 0){const l=s[0],h=s[s.length-1],u=t?ra(l,t,o,i):l;if(a)return e?oa(n,u,h):Re(n,h,u);const f=Math.min(u,n),g=Math.floor(Qs(s,f,r));return s[g]>u&&g<s.length-1?s[g+1]:s[g]}}}function wf(s,e,t,i,n,r){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const u=n?ra(e,n,l,r):e;if(h)return i?oa(o,u,t):Re(o,t,u);const f=1e-9,g=Math.ceil(Math.log(e/u)/Math.log(s)-f),_=-a*(.5-f)+.5,p=Math.min(u,o),y=Math.floor(Math.log(e/p)/Math.log(s)+_),E=Math.max(g,y),x=e/Math.pow(s,E);return Re(x,t,u)}}}function yh(s,e,t,i,n){return t=t!==void 0?t:!0,function(r,o,a,l){if(r!==void 0){const h=i?ra(s,i,a,n):s;return!t||!l?Re(r,e,h):oa(r,h,e)}}}const aa=0;class wt extends At{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Ao(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&bd(),e.center&&(e.center=we(e.center,this.projection_)),e.extent&&(e.extent=Yt(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in mt)delete t[a];this.setProperties(t,!0);const i=Sf(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const n=Tf(e),r=i.constraint,o=Rf(e);this.constraints_={center:n,resolution:r,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const n=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(n[3]-t[3]+t[1]-n[1]),a=r/2*(n[0]-t[0]+t[2]-n[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=we(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=we(n.anchor,this.getProjection())),t[i]=n}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let n=0;for(;n<t&&!this.isDef();++n){const u=arguments[n];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(n===t){i&&pr(i,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;n<t;++n){const u=arguments[n],f={start:r,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||nd,callback:i};if(u.center&&(f.sourceCenter=o,f.targetCenter=u.center.slice(),o=f.targetCenter),u.zoom!==void 0?(f.sourceResolution=a,f.targetResolution=this.getResolutionForZoom(u.zoom),a=f.targetResolution):u.resolution&&(f.sourceResolution=a,f.targetResolution=u.resolution,a=f.targetResolution),u.rotation!==void 0){f.sourceRotation=l;const g=Zi(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;f.targetRotation=l+g,l=f.targetRotation}If(f)?f.complete=!0:r+=f.duration,h.push(f)}this.animations_.push(h),this.setHint(We.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[We.ANIMATING]>0}getInteracting(){return this.hints_[We.INTERACTING]>0}cancelAnimations(){this.setHint(We.ANIMATING,-this.hints_[We.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const n=this.animations_[t];if(n[0].callback&&pr(n[0].callback,!1),!e)for(let r=0,o=n.length;r<o;++r){const a=n[r];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let r=!0;for(let o=0,a=n.length;o<a;++o){const l=n[o];if(l.complete)continue;const h=e-l.start;let u=l.duration>0?h/l.duration:1;u>=1?(l.complete=!0,u=1):r=!1;const f=l.easing(u);if(l.sourceCenter){const g=l.sourceCenter[0],_=l.sourceCenter[1],p=l.targetCenter[0],y=l.targetCenter[1];this.nextCenter_=l.targetCenter;const E=g+f*(p-g),x=_+f*(y-_);this.targetCenter_=[E,x]}if(l.sourceResolution&&l.targetResolution){const g=f===1?l.targetResolution:l.sourceResolution+f*(l.targetResolution-l.sourceResolution);if(l.anchor){const _=this.getViewportSize_(this.getRotation()),p=this.constraints_.resolution(g,0,_,!0);this.targetCenter_=this.calculateCenterZoom(p,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=g,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const g=f===1?Zi(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+f*(l.targetRotation-l.sourceRotation);if(l.anchor){const _=this.constraints_.rotation(g,!0);this.targetCenter_=this.calculateCenterRotate(_,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=g}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(r){this.animations_[i]=null,this.setHint(We.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&pr(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const n=this.getCenterInternal();return n!==void 0&&(i=[n[0]-t[0],n[1]-t[1]],bo(i,e-this.getRotation()),Td(i,t)),i}calculateCenterZoom(e,t){let i;const n=this.getCenterInternal(),r=this.getResolution();if(n!==void 0&&r!==void 0){const o=t[0]-e*(t[0]-n[0])/r,a=t[1]-e*(t[1]-n[1])/r;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],n=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(n*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(n*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Ln(e,this.getProjection())}getCenterInternal(){return this.get(mt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return Oo(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();he(t,"The view center is not defined");const i=this.getResolution();he(i!==void 0,"The view resolution is not defined");const n=this.getRotation();return he(n!==void 0,"The view rotation is not defined"),ir(t,i,n,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(mt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Yt(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=fe(e)/t[0],n=Ge(e)/t[1];return Math.max(i,n)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(t/i)/Math.log(e);return function(r){return t/Math.pow(e,r*n)}}getRotation(){return this.get(mt.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(i/n)/t;return function(o){return Math.log(i/o)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();n=la(n,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],t,i)}return{center:n.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,n;if(this.resolutions_){const r=Qs(this.resolutions_,e,1);t=r,i=this.resolutions_[r],r==this.resolutions_.length-1?n=2:n=i/this.resolutions_[r+1]}else i=this.maxResolution_,n=this.zoomFactor_;return t+Math.log(i/e)/Math.log(n)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=Re(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,Re(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(he(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){he(!Rn(e),"Cannot fit empty extent provided as `geometry`");const n=Yt(e,this.getProjection());i=$i(n)}else if(e.getType()==="Circle"){const n=Yt(e.getExtent(),this.getProjection());i=$i(n),i.rotate(this.getRotation(),Ue(n))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),n=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,u=-1/0;for(let f=0,g=r.length;f<g;f+=o){const _=r[f]*i-r[f+1]*n,p=r[f]*n+r[f+1]*i;a=Math.min(a,_),l=Math.min(l,p),h=Math.max(h,_),u=Math.max(u,p)}return[a,l,h,u]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const n=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),u=Math.sin(h),f=Math.cos(h),g=Ue(a);g[0]+=(n[1]-n[3])/2*l,g[1]+=(n[0]-n[2])/2*l;const _=g[0]*f-g[1]*u,p=g[1]*f+g[0]*u,y=this.getConstrainedCenter([_,p],l),E=t.callback?t.callback:mn;t.duration!==void 0?this.animateInternal({resolution:l,center:y,duration:t.duration,easing:t.easing},E):(this.targetResolution_=l,this.targetCenter_=y,this.applyTargetState_(!1,!0),pr(E,!0))}centerOn(e,t,i){this.centerOnInternal(we(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(la(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,n){let r;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),l=la(e,n,[a[0]/2+o[3],a[1]/2+o[0]],t,i);r=[e[0]-l[0],e[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Ln(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&we(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,n,i);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=we(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(n,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&we(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,r,i),a=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,n,r));this.get(mt.ROTATION)!==n&&this.set(mt.ROTATION,n),this.get(mt.RESOLUTION)!==o&&(this.set(mt.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(mt.CENTER)||!Ot(this.get(mt.CENTER),a))&&this.set(mt.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const n=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!Ot(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:e,easing:ji,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(We.INTERACTING,1)}endInteraction(e,t,i){i=i&&we(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(We.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function pr(s,e){setTimeout(function(){s(e)},0)}function Tf(s){if(s.extent!==void 0){const t=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return ph(s.extent,s.constrainOnlyCenter,t)}const e=Ao(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,ph(t,!1,!1)}return Cf}function Sf(s){let e,t,i,o=s.minZoom!==void 0?s.minZoom:aa,a=s.maxZoom!==void 0?s.maxZoom:28;const l=s.zoomFactor!==void 0?s.zoomFactor:2,h=s.multiWorld!==void 0?s.multiWorld:!1,u=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,f=s.showFullExtent!==void 0?s.showFullExtent:!1,g=Ao(s.projection,"EPSG:3857"),_=g.getExtent();let p=s.constrainOnlyCenter,y=s.extent;if(!h&&!y&&g.isGlobal()&&(p=!1,y=_),s.resolutions!==void 0){const E=s.resolutions;t=E[o],i=E[a]!==void 0?E[a]:E[E.length-1],s.constrainResolution?e=xf(E,u,!p&&y,f):e=yh(t,i,u,!p&&y,f)}else{const x=(_?Math.max(fe(_),Ge(_)):360*Co.degrees/g.getMetersPerUnit())/xs/Math.pow(2,aa),C=x/Math.pow(2,28-aa);t=s.maxResolution,t!==void 0?o=0:t=x/Math.pow(l,o),i=s.minResolution,i===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?i=t/Math.pow(l,a):i=x/Math.pow(l,a):i=C),a=o+Math.floor(Math.log(t/i)/Math.log(l)),i=t/Math.pow(l,a-o),s.constrainResolution?e=wf(l,t,i,u,!p&&y,f):e=yh(t,i,u,!p&&y,f)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:o,zoomFactor:l}}function Rf(s){if(s.enableRotation!==void 0?s.enableRotation:!0){const t=s.constrainRotation;return t===void 0||t===!0?_f():t===!1?fh:typeof t=="number"?gf(t):fh}return ia}function If(s){return!(s.sourceCenter&&s.targetCenter&&!Ot(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function la(s,e,t,i,n){const r=Math.cos(-n);let o=Math.sin(-n),a=s[0]*r-s[1]*o,l=s[1]*r+s[0]*o;a+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,o=-o;const h=a*r-l*o,u=l*r+a*o;return[h,u]}let ws=class extends mh{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(pe.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(pe.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(me(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=re(e,q.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof wt?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let n;t.layerStatesArray?n=t.layerStatesArray.find(o=>o.layer===this):n=this.getLayerState();const r=this.getExtent();return ha(n,t.viewState)&&(!r||ze(r,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const i=this.getSource();if(i&&(t=i.getAttributions()),!t)return[];const n=e instanceof wt?e.getViewStateAndExtent():e;let r=t(n);return Array.isArray(r)||(r=[r]),r}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(pe.MAP,e)}getMapInternal(){return this.get(pe.MAP)}setMap(e){this.mapPrecomposeKey_&&(me(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(me(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=re(e,xt.PRECOMPOSE,function(t){const n=t.frameState.layerStatesArray,r=this.getLayerState(!1);he(!n.some(function(o){return o.layer===r.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),n.push(r)},this),this.mapRenderKey_=re(this,q.CHANGE,e.render,e),this.changed())}setSource(e){this.set(pe.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function ha(s,e){if(!s.visible)return!1;const t=e.resolution;if(t<s.minResolution||t>=s.maxResolution)return!1;const i=e.zoom;return i>s.minZoom&&i<=s.maxZoom}function Lf(s,e,t,i,n){vh(s,e,t||0,i||s.length-1,n||bf)}function vh(s,e,t,i,n){for(;i>t;){if(i-t>600){var r=i-t+1,o=e-t+1,a=Math.log(r),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(r-l)/r)*(o-r/2<0?-1:1),u=Math.max(t,Math.floor(e-o*l/r+h)),f=Math.min(i,Math.floor(e+(r-o)*l/r+h));vh(s,e,u,f,n)}var g=s[e],_=t,p=i;for(Ts(s,t,e),n(s[i],g)>0&&Ts(s,t,i);_<p;){for(Ts(s,_,p),_++,p--;n(s[_],g)<0;)_++;for(;n(s[p],g)>0;)p--}n(s[t],g)===0?Ts(s,t,p):(p++,Ts(s,p,i)),p<=e&&(t=p+1),e<=p&&(i=p-1)}}function Ts(s,e,t){var i=s[e];s[e]=s[t],s[t]=i}function bf(s,e){return s<e?-1:s>e?1:0}let Eh=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!vr(e,t))return i;const n=this.toBBox,r=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?n(a):a;vr(e,l)&&(t.leaf?i.push(a):ua(e,l)?this._all(a,i):r.push(a))}t=r.pop()}return i}collides(e){let t=this.data;if(!vr(e,t))return!1;const i=[];for(;t;){for(let n=0;n<t.children.length;n++){const r=t.children[n],o=t.leaf?this.toBBox(r):r;if(vr(e,o)){if(t.leaf||ua(e,o))return!0;i.push(r)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Pn([]),this}remove(e,t){if(!e)return this;let i=this.data;const n=this.toBBox(e),r=[],o=[];let a,l,h;for(;i||r.length;){if(i||(i=r.pop(),l=r[r.length-1],a=o.pop(),h=!0),i.leaf){const u=Mf(e,i.children,t);if(u!==-1)return i.children.splice(u,1),r.push(i),this._condense(r),this}!h&&!i.leaf&&ua(i,n)?(r.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,n){const r=i-t+1;let o=this._maxEntries,a;if(r<=o)return a=Pn(e.slice(t,i+1)),Mn(a,this.toBBox),a;n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),a=Pn([]),a.leaf=!1,a.height=n;const l=Math.ceil(r/o),h=l*Math.ceil(Math.sqrt(o));Ch(e,t,i,h,this.compareMinX);for(let u=t;u<=i;u+=h){const f=Math.min(u+h-1,i);Ch(e,u,f,l,this.compareMinY);for(let g=u;g<=f;g+=l){const _=Math.min(g+l-1,f);a.children.push(this._build(e,g,_,n-1))}}return Mn(a,this.toBBox),a}_chooseSubtree(e,t,i,n){for(;n.push(t),!(t.leaf||n.length-1===i);){let r=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const h=t.children[l],u=ca(h),f=Ff(e,h)-u;f<o?(o=f,r=u<r?u:r,a=h):f===o&&u<r&&(r=u,a=h)}t=a||t.children[0]}return t}_insert(e,t,i){const n=i?e:this.toBBox(e),r=[],o=this._chooseSubtree(n,this.data,t,r);for(o.children.push(e),Rs(o,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)}_split(e,t){const i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const o=this._chooseSplitIndex(i,r,n),a=Pn(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Mn(i,this.toBBox),Mn(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=Pn([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Mn(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let n,r=1/0,o=1/0;for(let a=t;a<=i-t;a++){const l=Ss(e,0,a,this.toBBox),h=Ss(e,a,i,this.toBBox),u=Of(l,h),f=ca(l)+ca(h);u<r?(r=u,n=a,o=f<o?f:o):u===r&&f<o&&(o=f,n=a)}return n||i-t}_chooseSplitAxis(e,t,i){const n=e.leaf?this.compareMinX:Pf,r=e.leaf?this.compareMinY:Af,o=this._allDistMargin(e,t,i,n),a=this._allDistMargin(e,t,i,r);o<a&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const r=this.toBBox,o=Ss(e,0,t,r),a=Ss(e,i-t,i,r);let l=yr(o)+yr(a);for(let h=t;h<i-t;h++){const u=e.children[h];Rs(o,e.leaf?r(u):u),l+=yr(o)}for(let h=i-t-1;h>=t;h--){const u=e.children[h];Rs(a,e.leaf?r(u):u),l+=yr(a)}return l}_adjustParentBBoxes(e,t,i){for(let n=i;n>=0;n--)Rs(t[n],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():Mn(e[t],this.toBBox)}};function Mf(s,e,t){if(!t)return e.indexOf(s);for(let i=0;i<e.length;i++)if(t(s,e[i]))return i;return-1}function Mn(s,e){Ss(s,0,s.children.length,e,s)}function Ss(s,e,t,i,n){n||(n=Pn(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=e;r<t;r++){const o=s.children[r];Rs(n,s.leaf?i(o):o)}return n}function Rs(s,e){return s.minX=Math.min(s.minX,e.minX),s.minY=Math.min(s.minY,e.minY),s.maxX=Math.max(s.maxX,e.maxX),s.maxY=Math.max(s.maxY,e.maxY),s}function Pf(s,e){return s.minX-e.minX}function Af(s,e){return s.minY-e.minY}function ca(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function yr(s){return s.maxX-s.minX+(s.maxY-s.minY)}function Ff(s,e){return(Math.max(e.maxX,s.maxX)-Math.min(e.minX,s.minX))*(Math.max(e.maxY,s.maxY)-Math.min(e.minY,s.minY))}function Of(s,e){const t=Math.max(s.minX,e.minX),i=Math.max(s.minY,e.minY),n=Math.min(s.maxX,e.maxX),r=Math.min(s.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,r-i)}function ua(s,e){return s.minX<=e.minX&&s.minY<=e.minY&&e.maxX<=s.maxX&&e.maxY<=s.maxY}function vr(s,e){return e.minX<=s.maxX&&e.minY<=s.maxY&&e.maxX>=s.minX&&e.maxY>=s.minY}function Pn(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ch(s,e,t,i,n){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;Lf(s,o,e,t,n),r.push(e,o,o,t)}}const H={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function xh(s){return s[0]>0&&s[1]>0}function Nf(s,e,t){return t===void 0&&(t=[0,0]),t[0]=s[0]*e+.5|0,t[1]=s[1]*e+.5|0,t}function ct(s,e){return Array.isArray(s)?s:(e===void 0?e=[s,s]:(e[0]=s,e[1]=s),e)}class Er{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=ct(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Er({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ue()}getImage(e){return ue()}getHitDetectionImage(){return ue()}getPixelRatio(e){return 1}getImageState(){return ue()}getImageSize(){return ue()}getOrigin(){return ue()}getSize(){return ue()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=ct(e)}listenImageChange(e){ue()}load(){ue()}unlistenImageChange(e){ue()}ready(){return Promise.resolve()}}const Is={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Xe={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Xe.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}},Xe.max=Xe.whitepoint[2].D65,Xe.rgb=function(s,e){e=e||Xe.whitepoint[2].E;var t=s[0]/e[0],i=s[1]/e[1],n=s[2]/e[2],r,o,a;return r=t*3.240969941904521+i*-1.537383177570093+n*-.498610760293,o=t*-.96924363628087+i*1.87596750150772+n*.041555057407175,a=t*.055630079696993+i*-.20397695888897+n*1.056971514242878,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r=r*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,r=Math.min(Math.max(0,r),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[r*255,o*255,a*255]},Is.xyz=function(s,e){var t=s[0]/255,i=s[1]/255,n=s[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var r=t*.41239079926595+i*.35758433938387+n*.18048078840183,o=t*.21263900587151+i*.71516867876775+n*.072192315360733,a=t*.019330818715591+i*.11919477979462+n*.95053215224966;return e=e||Xe.whitepoint[2].E,[r*e[0],o*e[1],a*e[2]]};const da={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(s,e,t){var i,n,r,o,a,l,h,u,f,g,_,p,y;if(r=s[0],o=s[1],a=s[2],r===0)return[0,0,0];var E=.0011070564598794539;return e=e||"D65",t=t||2,f=Xe.whitepoint[t][e][0],g=Xe.whitepoint[t][e][1],_=Xe.whitepoint[t][e][2],p=4*f/(f+15*g+3*_),y=9*g/(f+15*g+3*_),i=o/(13*r)+p||0,n=a/(13*r)+y||0,h=r>8?g*Math.pow((r+16)/116,3):g*r*E,l=h*9*i/(4*n)||0,u=h*(12-3*i-20*n)/(4*n)||0,[l,h,u]}};Xe.luv=function(s,e,t){var i,n,r,o,a,l,h,u,f,g,_,p,y,E=.008856451679035631,x=903.2962962962961;e=e||"D65",t=t||2,f=Xe.whitepoint[t][e][0],g=Xe.whitepoint[t][e][1],_=Xe.whitepoint[t][e][2],p=4*f/(f+15*g+3*_),y=9*g/(f+15*g+3*_),l=s[0],h=s[1],u=s[2],i=4*l/(l+15*h+3*u)||0,n=9*h/(l+15*h+3*u)||0;var C=h/g;return r=C<=E?x*C:116*Math.pow(C,1/3)-16,o=13*r*(i-p),a=13*r*(n-y),[r,o,a]};var wh={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(s){var e=s[0],t=s[1],i=s[2],n,r,o;return o=i/360*2*Math.PI,n=t*Math.cos(o),r=t*Math.sin(o),[e,n,r]},xyz:function(s){return da.xyz(wh.luv(s))}};da.lchuv=function(s){var e=s[0],t=s[1],i=s[2],n=Math.sqrt(t*t+i*i),r=Math.atan2(i,t),o=r*360/2/Math.PI;return o<0&&(o+=360),[e,n,o]},Xe.lchuv=function(s){return da.lchuv(Xe.luv(s))};var Df={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const Th=Et(Df);var Sh={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function kf(s){var u,f;var e,t=[],i=1,n;if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(s=String(s).toLowerCase(),Th[s])t=Th[s].slice(),n="rgb";else if(s==="transparent")i=0,n="rgb",t=[0,0,0];else if(s[0]==="#"){var r=s.slice(1),o=r.length,a=o<=4;i=1,a?(t=[parseInt(r[0]+r[0],16),parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16)],o===4&&(i=parseInt(r[3]+r[3],16)/255)):(t=[parseInt(r[0]+r[1],16),parseInt(r[2]+r[3],16),parseInt(r[4]+r[5],16)],o===8&&(i=parseInt(r[6]+r[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),n="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(s)){var l=e[1];n=l.replace(/a$/,"");var h=n==="cmyk"?4:n==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/),n==="color"&&(n=t.shift()),t=t.map(function(g,_){if(g[g.length-1]==="%")return g=parseFloat(g)/100,_===3?g:n==="rgb"?g*255:n[0]==="h"||n[0]==="l"&&!_?g*100:n==="lab"?g*125:n==="lch"?_<2?g*150:g*360:n[0]==="o"&&!_?g:n==="oklab"?g*.4:n==="oklch"?_<2?g*.4:g*360:g;if(n[_]==="h"||_===2&&n[n.length-1]==="h"){if(Sh[g]!==void 0)return Sh[g];if(g.endsWith("deg"))return parseFloat(g);if(g.endsWith("turn"))return parseFloat(g)*360;if(g.endsWith("grad"))return parseFloat(g)*360/400;if(g.endsWith("rad"))return parseFloat(g)*180/Math.PI}return g==="none"?0:parseFloat(g)}),i=t.length>h?t.pop():1}else/[0-9](?:\s|\/|,)/.test(s)&&(t=s.match(/([0-9]+)/g).map(function(g){return parseFloat(g)}),n=((f=(u=s.match(/([a-z])/ig))==null?void 0:u.join(""))==null?void 0:f.toLowerCase())||"rgb");return{space:n,values:t,alpha:i}}const fa={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(s){var e=s[0]/360,t=s[1]/100,i=s[2]/100,n,r,o,a,l,h=0;if(t===0)return l=i*255,[l,l,l];for(r=i<.5?i*(1+t):i+t-i*t,n=2*i-r,a=[0,0,0];h<3;)o=e+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?n+(r-n)*6*o:2*o<1?r:3*o<2?n+(r-n)*(2/3-o)*6:n,a[h++]=l*255;return a}};Is.hsl=function(s){var e=s[0]/255,t=s[1]/255,i=s[2]/255,n=Math.min(e,t,i),r=Math.max(e,t,i),o=r-n,a,l,h;return r===n?a=0:e===r?a=(t-i)/o:t===r?a=2+(i-e)/o:i===r&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(n+r)/2,r===n?l=0:h<=.5?l=o/(r+n):l=o/(2-r-n),[a,l*100,h*100]};function Gf(s){Array.isArray(s)&&s.raw&&(s=String.raw(...arguments)),s instanceof Number&&(s=+s);var e,t=kf(s);if(!t.space)return[];const i=t.space[0]==="h"?fa.min:Is.min,n=t.space[0]==="h"?fa.max:Is.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],i[0]),n[0]),e[1]=Math.min(Math.max(t.values[1],i[1]),n[1]),e[2]=Math.min(Math.max(t.values[2],i[2]),n[2]),t.space[0]==="h"&&(e=fa.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}function zf(s){return typeof s=="string"?s:Lh(s)}const Vf=1024,Ls={};let ga=0;function Wf(s){if(s.length===4)return s;const e=s.slice();return e[3]=1,e}function Rh(s){const e=Xe.lchuv(Is.xyz(s));return e[3]=s[3],e}function Bf(s){const e=Xe.rgb(wh.xyz(s));return e[3]=s[3],e}function _a(s){if(Ls.hasOwnProperty(s))return Ls[s];if(ga>=Vf){let t=0;for(const i in Ls)t++&3||(delete Ls[i],--ga)}const e=Gf(s);if(e.length!==4)throw new Error('Failed to parse "'+s+'" as color');for(const t of e)if(isNaN(t))throw new Error('Failed to parse "'+s+'" as color');return Ih(e),Ls[s]=e,++ga,e}function bs(s){return Array.isArray(s)?s:_a(s)}function Ih(s){return s[0]=Re(s[0]+.5|0,0,255),s[1]=Re(s[1]+.5|0,0,255),s[2]=Re(s[2]+.5|0,0,255),s[3]=Re(s[3],0,1),s}function Lh(s){let e=s[0];e!=(e|0)&&(e=e+.5|0);let t=s[1];t!=(t|0)&&(t=t+.5|0);let i=s[2];i!=(i|0)&&(i=i+.5|0);const n=s[3]===void 0?1:Math.round(s[3]*1e3)/1e3;return"rgba("+e+","+t+","+i+","+n+")"}function jf(s){try{return _a(s),!0}catch{return!1}}function Be(s,e,t,i){let n;return t&&t.length?n=t.shift():ah?n=new OffscreenCanvas(s||300,e||300):n=document.createElement("canvas"),s&&(n.width=s),e&&(n.height=e),n.getContext("2d",i)}let ma;function pa(){return ma||(ma=Be(1,1)),ma}function Cr(s){const e=s.canvas;e.width=1,e.height=1,s.clearRect(0,0,1,1)}function Xf(s){let e=s.offsetWidth;const t=getComputedStyle(s);return e+=parseInt(t.marginLeft,10)+parseInt(t.marginRight,10),e}function Yf(s){let e=s.offsetHeight;const t=getComputedStyle(s);return e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10),e}function An(s,e){const t=e.parentNode;t&&t.replaceChild(s,e)}function xr(s){return s&&s.parentNode?s.parentNode.removeChild(s):null}function bh(s){for(;s.lastChild;)s.removeChild(s.lastChild)}function Uf(s,e){const t=s.childNodes;for(let i=0;;++i){const n=t[i],r=e[i];if(!n&&!r)break;if(n!==r){if(!n){s.appendChild(r);continue}if(!r){s.removeChild(n),--i;continue}s.insertBefore(r,n)}}}class ya extends ss{constructor(e,t,i,n){super(),this.extent=e,this.pixelRatio_=i,this.resolution=t,this.state=typeof n=="function"?H.IDLE:n,this.image_=null,this.loader=typeof n=="function"?n:null}changed(){this.dispatchEvent(q.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==H.IDLE&&this.loader){this.state=H.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;td(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=H.LOADED}).catch(i=>{this.state=H.ERROR,console.error(i)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function Hf(s,e,t){const i=s;let n=!0,r=!1,o=!1;const a=[rs(i,q.LOAD,function(){o=!0,r||e()})];return i.src&&Ko?(r=!0,i.decode().then(function(){n&&e()}).catch(function(l){n&&(o?e():t())})):a.push(rs(i,q.ERROR,t)),function(){n=!1,a.forEach(me)}}function Zf(s,e){return new Promise((t,i)=>{function n(){o(),t(s)}function r(){o(),i(new Error("Image load error"))}function o(){s.removeEventListener("load",n),s.removeEventListener("error",r)}s.addEventListener("load",n),s.addEventListener("error",r)})}function Mh(s,e){return e&&(s.src=e),s.src&&Ko?new Promise((t,i)=>s.decode().then(()=>t(s)).catch(n=>s.complete&&s.width?t(s):i(n))):Zf(s)}function Ph(s,e){return e&&(s.src=e),s.src&&Ko&&lf?s.decode().then(()=>createImageBitmap(s)).catch(t=>{if(s.complete&&s.width)return s;throw t}):Mh(s)}class Kf{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];!(e++&3)&&!i.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,i){const n=va(e,t,i);return n in this.cache_?this.cache_[n]:null}getPattern(e,t,i){const n=va(e,t,i);return n in this.patternCache_?this.patternCache_[n]:null}set(e,t,i,n,r){const o=va(e,t,i),a=o in this.cache_;this.cache_[o]=n,r&&(n.getImageState()===H.IDLE&&n.load(),n.getImageState()===H.LOADING?n.ready().then(()=>{this.patternCache_[o]=pa().createPattern(n.getImage(1),"repeat")}):this.patternCache_[o]=pa().createPattern(n.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function va(s,e,t){const i=t?bs(t):"null";return e+":"+s+":"+i}const Ut=new Kf;let Ms=null;class qf extends ss{constructor(e,t,i,n,r){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=n===void 0?H.IDLE:n,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===H.LOADED){Ms||(Ms=Be(1,1,void 0,{willReadFrequently:!0})),Ms.drawImage(this.image_,0,0);try{Ms.getImageData(0,0,1,1),this.tainted_=!1}catch{Ms=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(q.CHANGE)}handleImageError_(){this.imageState_=H.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=H.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=Be(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===H.IDLE){this.image_||this.initializeImage_(),this.imageState_=H.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Mh(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==H.LOADED)return;const t=this.image_,i=document.createElement("canvas");i.width=Math.ceil(t.width*e),i.height=Math.ceil(t.height*e);const n=i.getContext("2d");n.scale(e,e),n.drawImage(t,0,0),n.globalCompositeOperation="multiply",n.fillStyle=zf(this.color_),n.fillRect(0,0,i.width/e,i.height/e),n.globalCompositeOperation="destination-in",n.drawImage(t,0,0),this.canvas_[e]=i}ready(){return this.ready_||(this.ready_=new Promise(e=>{this.imageState_===H.LOADED||this.imageState_===H.ERROR?e():this.addEventListener(q.CHANGE,function t(){(this.imageState_===H.LOADED||this.imageState_===H.ERROR)&&(this.removeEventListener(q.CHANGE,t),e())})})),this.ready_}}function Ea(s,e,t,i,n,r){let o=e===void 0?void 0:Ut.get(e,t,n);return o||(o=new qf(s,s instanceof HTMLImageElement?s.src||void 0:e,t,i,n),Ut.set(e,t,n,o,r)),r&&o&&!Ut.getPattern(e,t,n)&&Ut.set(e,t,n,o,r),o}function Ht(s){return s?Array.isArray(s)?Lh(s):typeof s=="object"&&"src"in s?$f(s):s:null}function $f(s){if(!s.offset||!s.size)return Ut.getPattern(s.src,"anonymous",s.color);const e=s.src+":"+s.offset,t=Ut.getPattern(e,void 0,s.color);if(t)return t;const i=Ut.get(s.src,"anonymous",null);if(i.getImageState()!==H.LOADED)return null;const n=Be(s.size[0],s.size[1]);return n.drawImage(i.getImage(1),s.offset[0],s.offset[1],s.size[0],s.size[1],0,0,s.size[0],s.size[1]),Ea(n.canvas,e,void 0,H.LOADED,s.color,!0),Ut.getPattern(e,void 0,s.color)}const wr="ol-hidden",Jf="ol-selectable",Si="ol-unselectable",Ah="ol-unsupported",Fn="ol-control",Tr="ol-collapsed",Qf=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Fh=["style","variant","weight","size","lineHeight","family"],Oh=function(s){const e=s.match(Qf);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,n=Fh.length;i<n;++i){const r=e[i+1];r!==void 0&&(t[Fh[i]]=r)}return t.families=t.family.split(/,\s?/),t},Nh="10px sans-serif",ut="#000",On="round",ai=[],li=0,Nn="round",Ps=10,As="#000",Fs="center",Sr="middle",Qi=[0,0,0,0],Os=1,hi=new At;let Dn=null,Ca;const xa={},eg=function(){const e="32px ",t=["monospace","serif"],i=t.length,n="wmytzilWMYTZIL@#/&?$%10ï";let r,o;function a(h,u,f){let g=!0;for(let _=0;_<i;++_){const p=t[_];if(o=Rr(h+" "+u+" "+e+p,n),f!=p){const y=Rr(h+" "+u+" "+e+f+","+p,n);g=g&&y!=o}}return!!g}function l(){let h=!0;const u=hi.getKeys();for(let f=0,g=u.length;f<g;++f){const _=u[f];hi.get(_)<100&&(a.apply(this,_.split(`
`))?(pn(xa),Dn=null,Ca=void 0,hi.set(_,100)):(hi.set(_,hi.get(_)+1,!0),h=!1))}h&&(clearInterval(r),r=void 0)}return function(h){const u=Oh(h);if(!u)return;const f=u.families;for(let g=0,_=f.length;g<_;++g){const p=f[g],y=u.style+`
`+u.weight+`
`+p;hi.get(y)===void 0&&(hi.set(y,100,!0),a(u.style,u.weight,p)||(hi.set(y,0,!0),r===void 0&&(r=setInterval(l,32))))}}}(),tg=function(){let s;return function(e){let t=xa[e];if(t==null){if(ah){const i=Oh(e),n=Dh(e,"Å½g");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=e,document.body.appendChild(s),t=s.offsetHeight,document.body.removeChild(s);xa[e]=t}return t}}();function Dh(s,e){return Dn||(Dn=Be(1,1)),s!=Ca&&(Dn.font=s,Ca=Dn.font),Dn.measureText(e)}function Rr(s,e){return Dh(s,e).width}function kh(s,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((n,r)=>Math.max(n,Rr(s,r)),0);return t[e]=i,i}function ig(s,e){const t=[],i=[],n=[];let r=0,o=0,a=0,l=0;for(let h=0,u=e.length;h<=u;h+=2){const f=e[h];if(f===`
`||h===u){r=Math.max(r,o),n.push(o),o=0,a+=l;continue}const g=e[h+1]||s.font,_=Rr(g,f);t.push(_),o+=_;const p=tg(g);i.push(p),l=Math.max(l,p)}return{width:r,height:a,widths:t,heights:i,lineWidths:n}}function ng(s,e,t,i,n,r,o,a,l,h,u){s.save(),t!==1&&(s.globalAlpha===void 0?s.globalAlpha=f=>f.globalAlpha*=t:s.globalAlpha*=t),e&&s.transform.apply(s,e),i.contextInstructions?(s.translate(l,h),s.scale(u[0],u[1]),sg(i,s)):u[0]<0||u[1]<0?(s.translate(l,h),s.scale(u[0],u[1]),s.drawImage(i,n,r,o,a,0,0,o,a)):s.drawImage(i,n,r,o,a,l,h,o*u[0],a*u[1]),s.restore()}function sg(s,e){const t=s.contextInstructions;for(let i=0,n=t.length;i<n;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class en extends Er{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?H.LOADING:H.LOADED,this.imageState_===H.LOADING&&this.ready().then(()=>this.imageState_=H.LOADED),this.render()}clone(){const e=this.getScale(),t=new en({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){let t=this.canvases_[e];if(!t){const i=this.renderOptions_,n=Be(i.size*e,i.size*e);this.draw_(i,n,e),t=n.canvas,this.canvases_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let n=this.radius_,r=this.radius2_===void 0?n:this.radius2_;if(n<r){const b=n;n=r,r=b}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),u=n-h,f=Math.sqrt(l*l+u*u),g=f/l;if(e==="miter"&&g<=i)return g*t;const _=t/2/g,p=t/2*(u/f),E=Math.sqrt((n+_)*(n+_)+p*p)-n;if(this.radius2_===void 0||e==="bevel")return E*2;const x=n*Math.sin(a),C=Math.sqrt(n*n-x*x),T=r-C,R=Math.sqrt(x*x+T*T)/x;if(R<=i){const b=R*t/2-r-n;return 2*Math.max(E,b)}return E*2}createRenderOptions(){let e=On,t=Nn,i=0,n=null,r=0,o,a=0;this.stroke_&&(o=Ht(this.stroke_.getColor()??As),a=this.stroke_.getWidth()??Os,n=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??Nn,e=this.stroke_.getLineCap()??On,i=this.stroke_.getMiterLimit()??Ps);const l=this.calculateLineJoinSize_(t,a,i),h=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:u,lineCap:e,lineDash:n,lineDashOffset:r,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let n=this.fill_.getColor();n===null&&(n=ut),t.fillStyle=Ht(n),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let i=this.fill_.getColor(),n=0;typeof i=="string"&&(i=bs(i)),i===null?n=1:Array.isArray(i)&&(n=i.length===4?i[3]:1),n===0&&(t=Be(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const i=this.radius_;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const n=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=r+a*o,h=a%2===0?i:n;e.lineTo(h*Math.cos(l),h*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=ut,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Ns extends en{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Ns({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}class Tt{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new Tt({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=Ea(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===H.IDLE&&t.load(),t.getImageState()===H.LOADING&&(this.patternImage_=t)}this.color_=e}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class St{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new St({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}class it{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Gh,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new it({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Gh,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function rg(s){let e;if(typeof s=="function")e=s;else{let t;Array.isArray(s)?t=s:(he(typeof s.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[s]),e=function(){return t}}return e}let wa=null;function og(s,e){if(!wa){const t=new Tt({color:"rgba(255,255,255,0.4)"}),i=new St({color:"#3399CC",width:1.25});wa=[new it({image:new Ns({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return wa}function Ta(){const s={},e=[255,255,255,1],t=[0,153,255,1],i=3;return s.Polygon=[new it({fill:new Tt({color:[255,255,255,.5]})})],s.MultiPolygon=s.Polygon,s.LineString=[new it({stroke:new St({color:e,width:i+2})}),new it({stroke:new St({color:t,width:i})})],s.MultiLineString=s.LineString,s.Circle=s.Polygon.concat(s.LineString),s.Point=[new it({image:new Ns({radius:i*2,fill:new Tt({color:t}),stroke:new St({color:e,width:i/2})}),zIndex:1/0})],s.MultiPoint=s.Point,s.GeometryCollection=s.Polygon.concat(s.LineString,s.Point),s}function Gh(s){return s.getGeometry()}function zh(s,e,t,i){return t!==void 0&&i!==void 0?[t/s,i/e]:t!==void 0?t/s:i!==void 0?i/e:1}class Ir extends Er{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,n=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:n,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;he(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||se(o)),he(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),he(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=H.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?H.LOADED:H.IDLE:l=H.LOADING:l=H.LOADED),this.color_=e.color!==void 0?bs(e.color):null,this.iconImage_=Ea(o,a,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,e.width!==void 0||e.height!==void 0){let h,u;if(e.size)[h,u]=e.size;else{const f=this.getImage(1);if(f.width&&f.height)h=f.width,u=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=e;const g=()=>{if(this.unlistenImageChange(g),!this.initialOptions_)return;const _=this.iconImage_.getSize();this.setScale(zh(_[0],_[1],e.width,e.height))};this.listenImageChange(g);return}}h!==void 0&&this.setScale(zh(h,u,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Ir({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=n[0]),this.anchorYUnits_=="fraction"&&(e[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+n[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==H.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==H.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(q.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(q.CHANGE,e)}ready(){return this.iconImage_.ready()}}const ag="#333";class Sa{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=ct(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Tt({color:ag}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Sa({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=ct(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}let kn=0;const Gn=0,be=1<<kn++,K=1<<kn++,Gt=1<<kn++,He=1<<kn++,ci=1<<kn++,Ze=Math.pow(2,kn)-1,Vh={[be]:"boolean",[K]:"number",[Gt]:"string",[He]:"color",[ci]:"number[]"},lg=Object.keys(Vh).map(Number).sort(Bi);function Ke(s){const e=[];for(const t of lg)hg(s,t)&&e.push(Vh[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function hg(s,e){return(s&e)===e}function Zt(s,e){return!!(s&e)}function Lr(s,e){return s===e}class Ri{constructor(e,t){this.type=e,this.value=t}}class cg{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function Wh(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function ug(s){switch(s){case"string":return Gt;case"color":return He;case"number":return K;case"boolean":return be;case"number[]":return ci;default:throw new Error(`Unrecognized type hint: ${s}`)}}function ge(s,e,t){switch(typeof s){case"boolean":return new Ri(be,s);case"number":return new Ri(K,s);case"string":{let n=Gt;return jf(s)&&(n|=He),Lr(n&t,Gn)||(n&=t),new Ri(n,s)}}if(!Array.isArray(s))throw new Error("Expression must be an array or a primitive value");if(s.length===0)throw new Error("Empty expression");if(typeof s[0]=="string")return wg(s,e,t);for(const n of s)if(typeof n!="number")throw new Error("Expected an array of numbers");let i=ci;return(s.length===3||s.length===4)&&(i|=He),t&&(i&=t),new Ri(i,s)}const A={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},dg={[A.Get]:te(([s,e])=>e!==void 0?ug(e.value):Ze,oe(1,2),fg),[A.Var]:te(([s])=>s.type,oe(1,1),gg),[A.Id]:te(K|Gt,Ds,_g),[A.Concat]:te(Gt,oe(2,1/0),de(Ze)),[A.GeometryType]:te(Gt,Ds,mg),[A.Resolution]:te(K,Ds),[A.Zoom]:te(K,Ds),[A.Time]:te(K,Ds),[A.Any]:te(be,oe(2,1/0),de(be)),[A.All]:te(be,oe(2,1/0),de(be)),[A.Not]:te(be,oe(1,1),de(be)),[A.Equal]:te(be,oe(2,2),de(Ze),Ii),[A.NotEqual]:te(be,oe(2,2),de(Ze),Ii),[A.GreaterThan]:te(be,oe(2,2),de(Ze),Ii),[A.GreaterThanOrEqualTo]:te(be,oe(2,2),de(Ze),Ii),[A.LessThan]:te(be,oe(2,2),de(Ze),Ii),[A.LessThanOrEqualTo]:te(be,oe(2,2),de(Ze),Ii),[A.Multiply]:te(s=>{let e=K|He;for(let t=0;t<s.length;t++)e&=s[t].type;return e},oe(2,1/0),de(K|He),Ii),[A.Coalesce]:te(s=>{let e=Ze;for(let t=1;t<s.length;t+=2)e&=s[t].type;return e&=s[s.length-1].type,e},oe(2,1/0),de(Ze),Ii),[A.Divide]:te(K,oe(2,2),de(K)),[A.Add]:te(K,oe(2,1/0),de(K)),[A.Subtract]:te(K,oe(2,2),de(K)),[A.Clamp]:te(K,oe(3,3),de(K)),[A.Mod]:te(K,oe(2,2),de(K)),[A.Pow]:te(K,oe(2,2),de(K)),[A.Abs]:te(K,oe(1,1),de(K)),[A.Floor]:te(K,oe(1,1),de(K)),[A.Ceil]:te(K,oe(1,1),de(K)),[A.Round]:te(K,oe(1,1),de(K)),[A.Sin]:te(K,oe(1,1),de(K)),[A.Cos]:te(K,oe(1,1),de(K)),[A.Atan]:te(K,oe(1,2),de(K)),[A.Sqrt]:te(K,oe(1,1),de(K)),[A.Match]:te(s=>{let e=Ze;for(let t=2;t<s.length;t+=2)e&=s[t].type;return e&=s[s.length-1].type,e},oe(4,1/0),Bh,yg),[A.Between]:te(be,oe(3,3),de(K)),[A.Interpolate]:te(s=>{let e=He|K;for(let t=3;t<s.length;t+=2)e&=s[t].type;return e},oe(6,1/0),Bh,vg),[A.Case]:te(s=>{let e=Ze;for(let t=1;t<s.length;t+=2)e&=s[t].type;return e&=s[s.length-1].type,e},oe(3,1/0),pg,Eg),[A.In]:te(be,oe(2,2),Cg),[A.Number]:te(K,oe(1,1/0),de(Ze)),[A.String]:te(Gt,oe(1,1/0),de(Ze)),[A.Array]:te(s=>s.length===3||s.length===4?ci|He:ci,oe(1,1/0),de(K)),[A.Color]:te(He,oe(1,4),de(K)),[A.Band]:te(K,oe(1,3),de(K)),[A.Palette]:te(He,oe(2,2),xg)};function fg(s,e){const t=ge(s[1],e);if(!(t instanceof Ri))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");if(e.properties.add(t.value),s.length===3){const i=ge(s[2],e);return[t,i]}return[t]}function gg(s,e,t,i){const n=s[1];if(typeof n!="string")throw new Error("Expected a string argument for var operation");if(e.variables.add(n),!("variables"in e.style)||e.style.variables[n]===void 0)return[new Ri(Ze,n)];const r=e.style.variables[n],o=ge(r,e);if(o.value=n,i&&!Zt(i,o.type))throw new Error(`The variable ${n} has type ${Ke(o.type)} but the following type was expected: ${Ke(i)}`);return[o]}function _g(s,e){e.featureId=!0}function mg(s,e){e.geometryType=!0}function Ds(s,e){const t=s[0];if(s.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function oe(s,e){return function(t,i){const n=t[0],r=t.length-1;if(s===e){if(r!==s){const o=s===1?"":"s";throw new Error(`Expected ${s} argument${o} for ${n}, got ${r}`)}}else if(r<s||r>e){const o=e===1/0?`${s} or more`:`${s} to ${e}`;throw new Error(`Expected ${o} arguments for ${n}, got ${r}`)}}}function de(s){return function(e,t){const i=e[0],n=e.length-1,r=new Array(n);for(let o=0;o<n;++o){const a=ge(e[o+1],t);if(!Zt(s,a.type)){const l=Ke(s),h=Ke(a.type);throw new Error(`Unexpected type for argument ${o} of ${i} operation, got ${l} but expected ${h}`)}a.type&=s,r[o]=a}return r}}function Ii(s,e,t){const i=s[0],n=s.length-1;let r=Ze;for(let a=0;a<t.length;++a)r&=t[a].type;if(r===Gn)throw new Error(`No common type could be found for arguments of ${i} operation`);const o=new Array(n);for(let a=0;a<n;++a)o[a]=ge(s[a+1],e,r);return o}function pg(s,e){const t=s[0],i=s.length-1;if(i%2===0)throw new Error(`An odd amount of arguments was expected for operation ${t}, got ${JSON.stringify(i)} instead`)}function Bh(s,e){const t=s[0],i=s.length-1;if(i%2===1)throw new Error(`An even amount of arguments was expected for operation ${t}, got ${JSON.stringify(i)} instead`)}function yg(s,e,t,i){const n=s.length-1;let o=ge(s[1],e).type;const a=ge(s[s.length-1],e);let l=i!==void 0?i&a.type:a.type;const h=new Array(n-2);for(let f=0;f<n-2;f+=2){const g=ge(s[f+2],e),_=ge(s[f+3],e);o&=g.type,l&=_.type,h[f]=g,h[f+1]=_}const u=Gt|K|be;if(!Zt(u,o))throw new Error(`Expected an input of type ${Ke(u)} for the interpolate operation, got ${Ke(o)} instead`);if(Lr(l,Gn))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(s));for(let f=0;f<n-2;f+=2){const g=ge(s[f+2],e,o),_=ge(s[f+3],e,l);h[f]=g,h[f+1]=_}return[ge(s[1],e,o),...h,ge(s[s.length-1],e,l)]}function vg(s,e,t,i){const n=s[1];let r;switch(n[0]){case"linear":r=1;break;case"exponential":if(r=n[1],typeof r!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(r)} instead`);break;default:r=null}if(!r)throw new Error(`Invalid interpolation type: ${JSON.stringify(n)}`);r=ge(r,e);let o=ge(s[2],e);if(!Zt(K,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${Ke(o.type)} instead`);o=ge(s[2],e,K);const a=new Array(s.length-3);for(let l=0;l<a.length;l+=2){let h=ge(s[l+3],e);if(!Zt(K,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${Ke(h.type)} at position ${l+2} instead`);let u=ge(s[l+4],e);if(!Zt(K|He,u.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${Ke(u.type)} at position ${l+3} instead`);h=ge(s[l+3],e,K),u=ge(s[l+4],e,K|He),a[l]=h,a[l+1]=u}return[r,o,...a]}function Eg(s,e,t,i){const n=ge(s[s.length-1],e);let r=i!==void 0?i&n.type:n.type;const o=new Array(s.length-1);for(let a=0;a<o.length-1;a+=2){const l=ge(s[a+1],e),h=ge(s[a+2],e);if(!Zt(be,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${Ke(l.type)} at position ${a} instead`);r&=h.type,o[a]=l,o[a+1]=h}if(Lr(r,Gn))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(s));for(let a=0;a<o.length-1;a+=2)o[a+1]=ge(s[a+2],e,r);return o[o.length-1]=ge(s[s.length-1],e,r),o}function Cg(s,e){let t=s[2];if(!Array.isArray(t))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof t[0]=="string"){if(t[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(t[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');t=t[1]}let i=Gt|K;const n=new Array(t.length);for(let o=0;o<n.length;o++){const a=ge(t[o],e);i&=a.type,n[o]=a}if(Lr(i,Gn))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(s));return[ge(s[1],e,i),...n]}function xg(s,e){const t=ge(s[1],e,K);if(t.type!==K)throw new Error(`The first argument of palette must be an number, got ${Ke(t.type)} instead`);const i=s[2];if(!Array.isArray(i))throw new Error("The second argument of palette must be an array");const n=new Array(i.length);for(let r=0;r<n.length;r++){const o=ge(i[r],e,He);if(!(o instanceof Ri))throw new Error(`The palette color at index ${r} must be a literal value`);if(!Zt(o.type,He))throw new Error(`The palette color at index ${r} should be of type color, got ${Ke(o.type)} instead`);n[r]=o}return[t,...n]}function te(s,...e){return function(t,i,n){const r=t[0];let o=[];for(let l=0;l<e.length;l++)o=e[l](t,i,o,n)||o;let a=typeof s=="function"?s(o):s;if(n!==void 0){if(!Zt(a,n))throw new Error(`The following expression was expected to return ${Ke(n)}, but returns ${Ke(a)} instead: ${JSON.stringify(t)}`);a&=n}if(a===Gn)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(t)}`);return new cg(a,r,...o)}}function wg(s,e,t){const i=s[0],n=dg[i];if(!n)throw new Error(`Unknown operator: ${i}`);return n(s,e,t)}function jh(s){if(!s)return"";const e=s.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return jh(s.getGeometries()[0]);default:return""}}function Xh(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function ui(s,e,t){const i=ge(s,t);if(!Zt(e,i.type)){const n=Ke(e),r=Ke(i.type);throw new Error(`Expected expression to be of type ${n}, got ${r}`)}return Kt(i)}function Kt(s,e){if(s instanceof Ri){if(s.type===He&&typeof s.value=="string"){const i=_a(s.value);return function(){return i}}return function(){return s.value}}const t=s.operator;switch(t){case A.Number:case A.String:case A.Coalesce:return Tg(s);case A.Get:case A.Var:return Sg(s);case A.Id:return i=>i.featureId;case A.GeometryType:return i=>i.geometryType;case A.Concat:{const i=s.args.map(n=>Kt(n));return n=>"".concat(...i.map(r=>r(n).toString()))}case A.Resolution:return i=>i.resolution;case A.Any:case A.All:case A.Not:return Ig(s);case A.Equal:case A.NotEqual:case A.LessThan:case A.LessThanOrEqualTo:case A.GreaterThan:case A.GreaterThanOrEqualTo:return Rg(s);case A.Multiply:case A.Divide:case A.Add:case A.Subtract:case A.Clamp:case A.Mod:case A.Pow:case A.Abs:case A.Floor:case A.Ceil:case A.Round:case A.Sin:case A.Cos:case A.Atan:case A.Sqrt:return Lg(s);case A.Case:return bg(s);case A.Match:return Mg(s);case A.Interpolate:return Pg(s);default:throw new Error(`Unsupported operator ${t}`)}}function Tg(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=Kt(s.args[r]);switch(t){case A.Coalesce:return r=>{for(let o=0;o<i;++o){const a=n[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case A.Number:case A.String:return r=>{for(let o=0;o<i;++o){const a=n[o](r);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function Sg(s,e){const i=s.args[0].value;switch(s.operator){case A.Get:return n=>n.properties[i];case A.Var:return n=>n.variables[i];default:throw new Error(`Unsupported accessor operator ${s.operator}`)}}function Rg(s,e){const t=s.operator,i=Kt(s.args[0]),n=Kt(s.args[1]);switch(t){case A.Equal:return r=>i(r)===n(r);case A.NotEqual:return r=>i(r)!==n(r);case A.LessThan:return r=>i(r)<n(r);case A.LessThanOrEqualTo:return r=>i(r)<=n(r);case A.GreaterThan:return r=>i(r)>n(r);case A.GreaterThanOrEqualTo:return r=>i(r)>=n(r);default:throw new Error(`Unsupported comparison operator ${t}`)}}function Ig(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=Kt(s.args[r]);switch(t){case A.Any:return r=>{for(let o=0;o<i;++o)if(n[o](r))return!0;return!1};case A.All:return r=>{for(let o=0;o<i;++o)if(!n[o](r))return!1;return!0};case A.Not:return r=>!n[0](r);default:throw new Error(`Unsupported logical operator ${t}`)}}function Lg(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=Kt(s.args[r]);switch(t){case A.Multiply:return r=>{let o=1;for(let a=0;a<i;++a)o*=n[a](r);return o};case A.Divide:return r=>n[0](r)/n[1](r);case A.Add:return r=>{let o=0;for(let a=0;a<i;++a)o+=n[a](r);return o};case A.Subtract:return r=>n[0](r)-n[1](r);case A.Clamp:return r=>{const o=n[0](r),a=n[1](r);if(o<a)return a;const l=n[2](r);return o>l?l:o};case A.Mod:return r=>n[0](r)%n[1](r);case A.Pow:return r=>Math.pow(n[0](r),n[1](r));case A.Abs:return r=>Math.abs(n[0](r));case A.Floor:return r=>Math.floor(n[0](r));case A.Ceil:return r=>Math.ceil(n[0](r));case A.Round:return r=>Math.round(n[0](r));case A.Sin:return r=>Math.sin(n[0](r));case A.Cos:return r=>Math.cos(n[0](r));case A.Atan:return i===2?r=>Math.atan2(n[0](r),n[1](r)):r=>Math.atan(n[0](r));case A.Sqrt:return r=>Math.sqrt(n[0](r));default:throw new Error(`Unsupported numeric operator ${t}`)}}function bg(s,e){const t=s.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=Kt(s.args[n]);return n=>{for(let r=0;r<t-1;r+=2)if(i[r](n))return i[r+1](n);return i[t-1](n)}}function Mg(s,e){const t=s.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=Kt(s.args[n]);return n=>{const r=i[0](n);for(let o=1;o<t;o+=2)if(r===i[o](n))return i[o+1](n);return i[t-1](n)}}function Pg(s,e){const t=s.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=Kt(s.args[n]);return n=>{const r=i[0](n),o=i[1](n);let a,l;for(let h=2;h<t;h+=2){const u=i[h](n);let f=i[h+1](n);const g=Array.isArray(f);if(g&&(f=Wf(f)),u>=o)return h===2?f:g?Ag(r,o,a,l,u,f):ks(r,o,a,l,u,f);a=u,l=f}return l}}function ks(s,e,t,i,n,r){const o=n-t;if(o===0)return i;const a=e-t,l=s===1?a/o:(Math.pow(s,a)-1)/(Math.pow(s,o)-1);return i+l*(r-i)}function Ag(s,e,t,i,n,r){if(n-t===0)return i;const a=Rh(i),l=Rh(r);let h=l[2]-a[2];h>180?h-=360:h<-180&&(h+=360);const u=[ks(s,e,t,a[0],n,l[0]),ks(s,e,t,a[1],n,l[1]),a[2]+ks(s,e,t,0,n,h),ks(s,e,t,i[3],n,r[3])];return Ih(Bf(u))}function Fg(s){return!0}function Og(s){const e=Wh(),t=Ng(s,e),i=Xh();return function(n,r){if(i.properties=n.getPropertiesInternal(),i.resolution=r,e.featureId){const o=n.getId();o!==void 0?i.featureId=o:i.featureId=null}return e.geometryType&&(i.geometryType=jh(n.getGeometry())),t(i)}}function Yh(s){const e=Wh(),t=s.length,i=new Array(t);for(let o=0;o<t;++o)i[o]=Ra(s[o],e);const n=Xh(),r=new Array(t);return function(o,a){if(n.properties=o.getPropertiesInternal(),n.resolution=a,e.featureId){const h=o.getId();h!==void 0?n.featureId=h:n.featureId=null}let l=0;for(let h=0;h<t;++h){const u=i[h](n);u&&(r[l]=u,l+=1)}return r.length=l,r}}function Ng(s,e){const t=s.length,i=new Array(t);for(let n=0;n<t;++n){const r=s[n],o="filter"in r?ui(r.filter,be,e):Fg;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Ra(r.style[h],e)}else a=[Ra(r.style,e)];i[n]={filter:o,styles:a}}return function(n){const r=[];let o=!1;for(let a=0;a<t;++a){const l=i[a].filter;if(l(n)&&!(s[a].else&&o)){o=!0;for(const h of i[a].styles){const u=h(n);u&&r.push(u)}}}return r}}function Ra(s,e){const t=Gs(s,"",e),i=zs(s,"",e),n=Dg(s,e),r=kg(s,e),o=dt(s,"z-index",e);if(!t&&!i&&!n&&!r&&!yn(s))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(s));const a=new it;return function(l){let h=!0;if(t){const u=t(l);u&&(h=!1),a.setFill(u)}if(i){const u=i(l);u&&(h=!1),a.setStroke(u)}if(n){const u=n(l);u&&(h=!1),a.setText(u)}if(r){const u=r(l);u&&(h=!1),a.setImage(u)}return o&&a.setZIndex(o(l)),h?null:a}}function Gs(s,e,t){let i;if(e+"fill-pattern-src"in s?i=Wg(s,e+"fill-",t):i=Ia(s,e+"fill-color",t),!i)return null;const n=new Tt;return function(r){const o=i(r);return o==="none"?null:(n.setColor(o),n)}}function zs(s,e,t){const i=dt(s,e+"stroke-width",t),n=Ia(s,e+"stroke-color",t);if(!i&&!n)return null;const r=di(s,e+"stroke-line-cap",t),o=di(s,e+"stroke-line-join",t),a=Uh(s,e+"stroke-line-dash",t),l=dt(s,e+"stroke-line-dash-offset",t),h=dt(s,e+"stroke-miter-limit",t),u=new St;return function(f){if(n){const g=n(f);if(g==="none")return null;u.setColor(g)}if(i&&u.setWidth(i(f)),r){const g=r(f);if(g!=="butt"&&g!=="round"&&g!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(g)}if(o){const g=o(f);if(g!=="bevel"&&g!=="round"&&g!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(g)}return a&&u.setLineDash(a(f)),l&&u.setLineDashOffset(l(f)),h&&u.setMiterLimit(h(f)),u}}function Dg(s,e){const t="text-",i=di(s,t+"value",e);if(!i)return null;const n=Gs(s,t,e),r=Gs(s,t+"background-",e),o=zs(s,t,e),a=zs(s,t+"background-",e),l=di(s,t+"font",e),h=dt(s,t+"max-angle",e),u=dt(s,t+"offset-x",e),f=dt(s,t+"offset-y",e),g=Vs(s,t+"overflow",e),_=di(s,t+"placement",e),p=dt(s,t+"repeat",e),y=Mr(s,t+"scale",e),E=Vs(s,t+"rotate-with-view",e),x=dt(s,t+"rotation",e),C=di(s,t+"align",e),T=di(s,t+"justify",e),S=di(s,t+"baseline",e),R=Uh(s,t+"padding",e),b=Ar(s,t+"declutter-mode"),P=new Sa({declutterMode:b});return function(F){if(P.setText(i(F)),n&&P.setFill(n(F)),r&&P.setBackgroundFill(r(F)),o&&P.setStroke(o(F)),a&&P.setBackgroundStroke(a(F)),l&&P.setFont(l(F)),h&&P.setMaxAngle(h(F)),u&&P.setOffsetX(u(F)),f&&P.setOffsetY(f(F)),g&&P.setOverflow(g(F)),_){const I=_(F);if(I!=="point"&&I!=="line")throw new Error("Expected point or line for text-placement");P.setPlacement(I)}if(p&&P.setRepeat(p(F)),y&&P.setScale(y(F)),E&&P.setRotateWithView(E(F)),x&&P.setRotation(x(F)),C){const I=C(F);if(I!=="left"&&I!=="center"&&I!=="right"&&I!=="end"&&I!=="start")throw new Error("Expected left, right, center, start, or end for text-align");P.setTextAlign(I)}if(T){const I=T(F);if(I!=="left"&&I!=="right"&&I!=="center")throw new Error("Expected left, right, or center for text-justify");P.setJustify(I)}if(S){const I=S(F);if(I!=="bottom"&&I!=="top"&&I!=="middle"&&I!=="alphabetic"&&I!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");P.setTextBaseline(I)}return R&&P.setPadding(R(F)),P}}function kg(s,e){return"icon-src"in s?Gg(s,e):"shape-points"in s?zg(s,e):"circle-radius"in s?Vg(s,e):null}function Gg(s,e){const t="icon-",i=t+"src",n=qh(s[i],i),r=br(s,t+"anchor",e),o=Mr(s,t+"scale",e),a=dt(s,t+"opacity",e),l=br(s,t+"displacement",e),h=dt(s,t+"rotation",e),u=Vs(s,t+"rotate-with-view",e),f=Zh(s,t+"anchor-origin"),g=Kh(s,t+"anchor-x-units"),_=Kh(s,t+"anchor-y-units"),p=Yg(s,t+"color"),y=jg(s,t+"cross-origin"),E=Xg(s,t+"offset"),x=Zh(s,t+"offset-origin"),C=Pr(s,t+"width"),T=Pr(s,t+"height"),S=Bg(s,t+"size"),R=Ar(s,t+"declutter-mode"),b=new Ir({src:n,anchorOrigin:f,anchorXUnits:g,anchorYUnits:_,color:p,crossOrigin:y,offset:E,offsetOrigin:x,height:T,width:C,size:S,declutterMode:R});return function(P){return a&&b.setOpacity(a(P)),l&&b.setDisplacement(l(P)),h&&b.setRotation(h(P)),u&&b.setRotateWithView(u(P)),o&&b.setScale(o(P)),r&&b.setAnchor(r(P)),b}}function zg(s,e){const t="shape-",i=t+"points",n=t+"radius",r=La(s[i],i),o=La(s[n],n),a=Gs(s,t,e),l=zs(s,t,e),h=Mr(s,t+"scale",e),u=br(s,t+"displacement",e),f=dt(s,t+"rotation",e),g=Vs(s,t+"rotate-with-view",e),_=Pr(s,t+"radius2"),p=Pr(s,t+"angle"),y=Ar(s,t+"declutter-mode"),E=new en({points:r,radius:o,radius2:_,angle:p,declutterMode:y});return function(x){return a&&E.setFill(a(x)),l&&E.setStroke(l(x)),u&&E.setDisplacement(u(x)),f&&E.setRotation(f(x)),g&&E.setRotateWithView(g(x)),h&&E.setScale(h(x)),E}}function Vg(s,e){const t="circle-",i=Gs(s,t,e),n=zs(s,t,e),r=dt(s,t+"radius",e),o=Mr(s,t+"scale",e),a=br(s,t+"displacement",e),l=dt(s,t+"rotation",e),h=Vs(s,t+"rotate-with-view",e),u=Ar(s,t+"declutter-mode"),f=new Ns({radius:5,declutterMode:u});return function(g){return r&&f.setRadius(r(g)),i&&f.setFill(i(g)),n&&f.setStroke(n(g)),a&&f.setDisplacement(a(g)),l&&f.setRotation(l(g)),h&&f.setRotateWithView(h(g)),o&&f.setScale(o(g)),f}}function dt(s,e,t){if(!(e in s))return;const i=ui(s[e],K,t);return function(n){return La(i(n),e)}}function di(s,e,t){if(!(e in s))return null;const i=ui(s[e],Gt,t);return function(n){return qh(i(n),e)}}function Wg(s,e,t){const i=di(s,e+"pattern-src",t),n=Hh(s,e+"pattern-offset",t),r=Hh(s,e+"pattern-size",t),o=Ia(s,e+"color",t);return function(a){return{src:i(a),offset:n&&n(a),size:r&&r(a),color:o&&o(a)}}}function Vs(s,e,t){if(!(e in s))return null;const i=ui(s[e],be,t);return function(n){const r=i(n);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${e}`);return r}}function Ia(s,e,t){if(!(e in s))return null;const i=ui(s[e],He|Gt,t);return function(n){return $h(i(n),e)}}function Uh(s,e,t){if(!(e in s))return null;const i=ui(s[e],ci,t);return function(n){return Ws(i(n),e)}}function br(s,e,t){if(!(e in s))return null;const i=ui(s[e],ci,t);return function(n){const r=Ws(i(n),e);if(r.length!==2)throw new Error(`Expected two numbers for ${e}`);return r}}function Hh(s,e,t){if(!(e in s))return null;const i=ui(s[e],ci,t);return function(n){return Jh(i(n),e)}}function Mr(s,e,t){if(!(e in s))return null;const i=ui(s[e],ci|K,t);return function(n){return Ug(i(n),e)}}function Pr(s,e){const t=s[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function Bg(s,e){const t=s[e];if(t!==void 0){if(typeof t=="number")return ct(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function jg(s,e){const t=s[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function Zh(s,e){const t=s[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function Kh(s,e){const t=s[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function Xg(s,e){const t=s[e];if(t!==void 0)return Ws(t,e)}function Ar(s,e){const t=s[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function Yg(s,e){const t=s[e];if(t!==void 0)return $h(t,e)}function Ws(s,e){if(!Array.isArray(s))throw new Error(`Expected an array for ${e}`);const t=s.length;for(let i=0;i<t;++i)if(typeof s[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return s}function qh(s,e){if(typeof s!="string")throw new Error(`Expected a string for ${e}`);return s}function La(s,e){if(typeof s!="number")throw new Error(`Expected a number for ${e}`);return s}function $h(s,e){if(typeof s=="string")return s;const t=Ws(s,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function Jh(s,e){const t=Ws(s,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function Ug(s,e){return typeof s=="number"?s:Jh(s,e)}const Qh={RENDER_ORDER:"renderOrder"};class ec extends ws{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Qh.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const i=this.getDeclutter();i in e.declutter||(e.declutter[i]=new Eh(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(Qh.RENDER_ORDER,e)}setStyle(e){this.style_=Hg(e),this.styleFunction_=e===null?void 0:rg(this.style_),this.changed()}}function Hg(s){if(s===void 0)return og;if(!s)return null;if(typeof s=="function"||s instanceof it)return s;if(!Array.isArray(s))return Yh([s]);if(s.length===0)return[];const e=s.length,t=s[0];if(t instanceof it){const n=new Array(e);for(let r=0;r<e;++r){const o=s[r];if(!(o instanceof it))throw new Error("Expected a list of style instances");n[r]=o}return n}if("style"in t){const n=new Array(e);for(let r=0;r<e;++r){const o=s[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");n[r]=o}return Og(n)}return Yh(s)}const $={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Fr=[$.FILL],Li=[$.STROKE],tn=[$.BEGIN_PATH],tc=[$.CLOSE_PATH];class ic{drawCustom(e,t,i,n,r){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,i){}drawFeature(e,t,i){}drawGeometryCollection(e,t,i){}drawLineString(e,t,i){}drawMultiLineString(e,t,i){}drawMultiPoint(e,t,i){}drawMultiPolygon(e,t,i){}drawPoint(e,t,i){}drawPolygon(e,t,i){}drawText(e,t,i){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}class Bs extends ic{constructor(e,t,i,n){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=e.length;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],ii(i,n)&&(r[o++]=n[0],r[o++]=n[1]);return o}appendFlatLineCoordinates(e,t,i,n,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(t+=n);let u=e[t],f=e[t+1];const g=this.tmpCoordinate_;let _=!0,p,y,E;for(p=t+n;p<i;p+=n)g[0]=e[p],g[1]=e[p+1],E=To(h,g),E!==y?(_&&(a[l++]=u,a[l++]=f,_=!1),a[l++]=g[0],a[l++]=g[1]):E===ke.INTERSECTING?(a[l++]=g[0],a[l++]=g[1],_=!1):_=!0,u=g[0],f=g[1],y=E;return(r&&_||p===t+n)&&(a[l++]=u,a[l++]=f),l}drawCustomCoordinates_(e,t,i,n,r){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(e,t,l,n,!1,!1);r.push(h),t=l}return t}drawCustom(e,t,i,n,r){this.beginGeometry(e,t,r);const o=e.getType(),a=e.getStride(),l=this.coordinates.length;let h,u,f,g,_;switch(o){case"MultiPolygon":h=e.getOrientedFlatCoordinates(),g=[];const p=e.getEndss();_=0;for(let y=0,E=p.length;y<E;++y){const x=[];_=this.drawCustomCoordinates_(h,_,p[y],a,x),g.push(x)}this.instructions.push([$.CUSTOM,l,g,e,i,Xo,r]),this.hitDetectionInstructions.push([$.CUSTOM,l,g,e,n||i,Xo,r]);break;case"Polygon":case"MultiLineString":f=[],h=o=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),_=this.drawCustomCoordinates_(h,0,e.getEnds(),a,f),this.instructions.push([$.CUSTOM,l,f,e,i,_s,r]),this.hitDetectionInstructions.push([$.CUSTOM,l,f,e,n||i,_s,r]);break;case"LineString":case"Circle":h=e.getFlatCoordinates(),u=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([$.CUSTOM,l,u,e,i,wi,r]),this.hitDetectionInstructions.push([$.CUSTOM,l,u,e,n||i,wi,r]);break;case"MultiPoint":h=e.getFlatCoordinates(),u=this.appendFlatPointCoordinates(h,a),u>l&&(this.instructions.push([$.CUSTOM,l,u,e,i,wi,r]),this.hitDetectionInstructions.push([$.CUSTOM,l,u,e,n||i,wi,r]));break;case"Point":h=e.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),u=this.coordinates.length,this.instructions.push([$.CUSTOM,l,u,e,i,void 0,r]),this.hitDetectionInstructions.push([$.CUSTOM,l,u,e,n||i,void 0,r]);break}this.endGeometry(t)}beginGeometry(e,t,i){this.beginGeometryInstruction1_=[$.BEGIN_GEOMETRY,t,0,e,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[$.BEGIN_GEOMETRY,t,0,e,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let n,r,o=-1;for(t=0;t<i;++t)n=e[t],r=n[0],r==$.END_GEOMETRY?o=t:r==$.BEGIN_GEOMETRY&&(n[2]=t,Qu(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const i=this.state;if(e){const n=e.getColor();i.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,i.fillStyle=Ht(n||ut)}else i.fillStyle=void 0;if(t){const n=t.getColor();i.strokeStyle=Ht(n||As);const r=t.getLineCap();i.lineCap=r!==void 0?r:On;const o=t.getLineDash();i.lineDash=o?o.slice():ai;const a=t.getLineDashOffset();i.lineDashOffset=a||li;const l=t.getLineJoin();i.lineJoin=l!==void 0?l:Nn;const h=t.getWidth();i.lineWidth=h!==void 0?h:Os;const u=t.getMiterLimit();i.miterLimit=u!==void 0?u:Ps,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(e){const t=e.fillStyle,i=[$.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(e.fillPatternScale),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[$.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,n=e.lineCap,r=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=n||r!=e.currentLineDash&&!ti(e.currentLineDash,r)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=h)&&(i!==void 0&&t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=n,e.currentLineDash=r,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[$.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Fl(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;hs(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Zg extends Bs{constructor(e,t,i,n){super(e,t,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,i){if(!this.image_||this.maxExtent&&!ii(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,i);const n=e.getFlatCoordinates(),r=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,r);this.instructions.push([$.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([$.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,i){if(!this.image_)return;this.beginGeometry(e,t,i);const n=e.getFlatCoordinates(),r=[];for(let l=0,h=n.length;l<h;l+=e.getStride())(!this.maxExtent||ii(this.maxExtent,n.slice(l,l+2)))&&r.push(n[l],n[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([$.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([$.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),n=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=n[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class Kg extends Bs{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinates_(e,t,i,n){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,n,!1,!1),a=[$.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t,i){const n=this.state,r=n.strokeStyle,o=n.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([$.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ai,li],tn);const a=e.getFlatCoordinates(),l=e.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(Li),this.endGeometry(t)}drawMultiLineString(e,t,i){const n=this.state,r=n.strokeStyle,o=n.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([$.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ai,li],tn);const a=e.getEnds(),l=e.getFlatCoordinates(),h=e.getStride();let u=0;for(let f=0,g=a.length;f<g;++f)u=this.drawFlatCoordinates_(l,u,a[f],h);this.hitDetectionInstructions.push(Li),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(Li),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(Li),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(tn)}}class nc extends Bs{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinatess_(e,t,i,n){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=i.length;this.instructions.push(tn),this.hitDetectionInstructions.push(tn);for(let h=0;h<l;++h){const u=i[h],f=this.coordinates.length,g=this.appendFlatLineCoordinates(e,t,u,n,!0,!a),_=[$.MOVE_TO_LINE_TO,f,g];this.instructions.push(_),this.hitDetectionInstructions.push(_),a&&(this.instructions.push(tc),this.hitDetectionInstructions.push(tc)),t=u}return o&&(this.instructions.push(Fr),this.hitDetectionInstructions.push(Fr)),a&&(this.instructions.push(Li),this.hitDetectionInstructions.push(Li)),t}drawCircle(e,t,i){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([$.SET_FILL_STYLE,ut]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([$.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ai,li]);const a=e.getFlatCoordinates(),l=e.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const u=[$.CIRCLE,h];this.instructions.push(tn,u),this.hitDetectionInstructions.push(tn,u),n.fillStyle!==void 0&&(this.instructions.push(Fr),this.hitDetectionInstructions.push(Fr)),n.strokeStyle!==void 0&&(this.instructions.push(Li),this.hitDetectionInstructions.push(Li)),this.endGeometry(t)}drawPolygon(e,t,i){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([$.SET_FILL_STYLE,ut]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([$.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ai,li]);const a=e.getEnds(),l=e.getOrientedFlatCoordinates(),h=e.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(t)}drawMultiPolygon(e,t,i){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([$.SET_FILL_STYLE,ut]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([$.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ai,li]);const a=e.getEndss(),l=e.getOrientedFlatCoordinates(),h=e.getStride();let u=0;for(let f=0,g=a.length;f<g;++f)u=this.drawFlatCoordinatess_(l,u,a[f],h);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,n=t.length;i<n;++i)t[i]=Ki(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}function qg(s,e,t,i,n){const r=[];let o=t,a=0,l=e.slice(t,2);for(;a<s&&o+n<i;){const[h,u]=l.slice(-2),f=e[o+n],g=e[o+n+1],_=Math.sqrt((f-h)*(f-h)+(g-u)*(g-u));if(a+=_,a>=s){const p=(s-a+_)/_,y=_t(h,f,p),E=_t(u,g,p);l.push(y,E),r.push(l),l=[y,E],a==s&&(o+=n),a=0}else if(a<s)l.push(e[o+n],e[o+n+1]),o+=n;else{const p=_-a,y=_t(h,f,p/_),E=_t(u,g,p/_);l.push(y,E),r.push(l),l=[y,E],a=0,o+=n}}return a>0&&r.push(l),r}function $g(s,e,t,i,n){let r=t,o=t,a=0,l=0,h=t,u,f,g,_,p,y,E,x,C,T;for(f=t;f<i;f+=n){const S=e[f],R=e[f+1];p!==void 0&&(C=S-p,T=R-y,_=Math.sqrt(C*C+T*T),E!==void 0&&(l+=g,u=Math.acos((E*C+x*T)/(g*_)),u>s&&(l>a&&(a=l,r=h,o=f),l=0,h=f-n)),g=_,E=C,x=T),p=S,y=R}return l+=_,l>a?[h,f]:[r,o]}const Or={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Jg extends Bs{constructor(e,t,i,n){super(e,t,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[ut]={fillStyle:ut},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,i){const n=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!n&&!r)return;const a=this.coordinates;let l=a.length;const h=e.getType();let u=null,f=e.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!ze(this.maxExtent,e.getExtent()))return;let g;if(u=e.getFlatCoordinates(),h=="LineString")g=[u.length];else if(h=="MultiLineString")g=e.getEnds();else if(h=="Polygon")g=e.getEnds().slice(0,1);else if(h=="MultiPolygon"){const E=e.getEndss();g=[];for(let x=0,C=E.length;x<C;++x)g.push(E[x][0])}this.beginGeometry(e,t,i);const _=o.repeat,p=_?void 0:o.textAlign;let y=0;for(let E=0,x=g.length;E<x;++E){let C;_?C=qg(_*this.resolution,u,y,g[E],f):C=[u.slice(y,g[E])];for(let T=0,S=C.length;T<S;++T){const R=C[T];let b=0,P=R.length;if(p==null){const I=$g(o.maxAngle,R,0,R.length,2);b=I[0],P=I[1]}for(let I=b;I<P;I+=f)a.push(R[I],R[I+1]);const F=a.length;y=g[E],this.drawChars_(l,F),l=F}}this.endGeometry(t)}else{let g=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":u=e.getFlatCoordinates();break;case"LineString":u=e.getFlatMidpoint();break;case"Circle":u=e.getCenter();break;case"MultiLineString":u=e.getFlatMidpoints(),f=2;break;case"Polygon":u=e.getFlatInteriorPoint(),o.overflow||g.push(u[2]/this.resolution),f=3;break;case"MultiPolygon":const C=e.getFlatInteriorPoints();u=[];for(let T=0,S=C.length;T<S;T+=3)o.overflow||g.push(C[T+2]/this.resolution),u.push(C[T],C[T+1]);if(u.length===0)return;f=2;break}const _=this.appendFlatPointCoordinates(u,f);if(_===l)return;if(g&&(_-l)/2!==u.length/f){let C=l/2;g=g.filter((T,S)=>{const R=a[(C+S)*2]===u[S*f]&&a[(C+S)*2+1]===u[S*f+1];return R||--C,R})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t,i);let p=o.padding;if(p!=Qi&&(o.scale[0]<0||o.scale[1]<0)){let C=o.padding[0],T=o.padding[1],S=o.padding[2],R=o.padding[3];o.scale[0]<0&&(T=-T,R=-R),o.scale[1]<0&&(C=-C,S=-S),p=[C,T,S,R]}const y=this.pixelRatio;this.instructions.push([$.DRAW_IMAGE,l,_,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,p==Qi?Qi:p.map(function(C){return C*y}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,g]);const E=1/y,x=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=ut,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([$.DRAW_IMAGE,l,_,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[E,E],NaN,this.declutterMode_,this.declutterImageWithText_,p,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?ut:this.fillKey_,this.textOffsetX_,this.textOffsetY_,g]),o.backgroundFill&&(this.state.fillStyle=x,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,n=this.strokeKey_;e&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||Fs,justify:t.justify,textBaseline:t.textBaseline||Sr,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,n=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=Or[n.textBaseline],u=this.textOffsetY_*l,f=this.text_,g=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([$.DRAW_CHARS,e,t,h,n.overflow,a,n.maxAngle,l,u,r,g*l,f,o,1,this.declutterMode_]),this.hitDetectionInstructions.push([$.DRAW_CHARS,e,t,h,n.overflow,a&&ut,n.maxAngle,l,u,r,g*l,f,o,1/l,this.declutterMode_])}setTextStyle(e,t){let i,n,r;if(!e)this.text_="";else{const o=e.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=Ht(o.getColor()||ut)):(n=null,this.textFillState_=n);const a=e.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const p=a.getLineDash(),y=a.getLineDashOffset(),E=a.getWidth(),x=a.getMiterLimit();r.lineCap=a.getLineCap()||On,r.lineDash=p?p.slice():ai,r.lineDashOffset=y===void 0?li:y,r.lineJoin=a.getLineJoin()||Nn,r.lineWidth=E===void 0?Os:E,r.miterLimit=x===void 0?Ps:x,r.strokeStyle=Ht(a.getColor()||As)}i=this.textState_;const l=e.getFont()||Nh;eg(l);const h=e.getScaleArray();i.overflow=e.getOverflow(),i.font=l,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||Sr,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||Qi,i.scale=h===void 0?[1,1]:h;const u=e.getOffsetX(),f=e.getOffsetY(),g=e.getRotateWithView(),_=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=f===void 0?0:f,this.textRotateWithView_=g===void 0?!1:g,this.textRotation_=_===void 0?0:_,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:se(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?typeof n.fillStyle=="string"?n.fillStyle:"|"+se(n.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const Qg={Circle:nc,Default:Bs,Image:Zg,LineString:Kg,Polygon:nc,Text:Jg};class e_{constructor(e,t,i,n){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const n in i){const r=i[n].finish();e[t][n]=r}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let r=n[t];if(r===void 0){const o=Qg[t];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=r}return r}}class t_ extends os{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return ue()}getData(e){return null}prepareFrame(e){return ue()}renderFrame(e,t){return ue()}loadedTileCallback(e,t,i){e[t]||(e[t]={}),e[t][i.tileCoord.toString()]=i}createLoadedTileFinder(e,t,i){return(n,r)=>{const o=this.loadedTileCallback.bind(this,i,n);return e.forEachLoadedTile(t,n,r,o)}}forEachFeatureAtCoordinate(e,t,i,n,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===H.LOADED||t.getState()===H.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=H.LOADED&&t!=H.ERROR&&e.addEventListener(q.CHANGE,this.boundHandleImageChange_),t==H.IDLE&&(e.load(),t=e.getState()),t==H.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class sc extends ot{constructor(e,t,i,n){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=n}}class rc{constructor(){Js(this,"pushMethodArgs_",(...e)=>(this.instructions_[this.zIndex+this.offset_].push(e),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(e,t)=>{if(typeof pa()[t]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t),this.pushMethodArgs_},set:(e,t,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t,i),!0)})}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let i=0,n=t.length;i<n;i+=2){const r=t[i],o=t[i+1];if(typeof e[r]=="function")e[r](...o);else{if(typeof o=="function"){e[r]=o(e);continue}e[r]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const oc=[];let zn=null;function i_(){zn=Be(1,1,void 0,{willReadFrequently:!0})}class ba extends t_{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=Nt(),this.pixelTransform=Nt(),this.inversePixelTransform=Nt(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,i){zn||i_(),zn.clearRect(0,0,1,1);let n;try{zn.drawImage(e,t,i,1,1,0,0,1,1),n=zn.getImageData(0,0,1,1).data}catch{return zn=null,null}return n}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const n=this.getLayer().getClassName();let r,o;if(e&&e.className===n&&(!i||e&&e.style.backgroundColor&&ti(bs(e.style.backgroundColor),bs(i)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=n;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=Be();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const n=Xt(i),r=gs(i),o=Sn(i),a=Tn(i);Oe(t.coordinateToPixelTransform,n),Oe(t.coordinateToPixelTransform,r),Oe(t.coordinateToPixelTransform,o),Oe(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Oe(l,n),Oe(l,r),Oe(l,o),Oe(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,i){const n=this.getLayer();if(n.hasListener(e)){const r=new sc(e,this.inversePixelTransform,i,t);n.dispatchEvent(r)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(xt.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(xt.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new rc),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(xt.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(xt.POSTRENDER,this.context,e))}getRenderTransform(e,t,i,n,r,o,a){const l=r/2,h=o/2,u=n/t,f=-u,g=-e[0]+a,_=-e[1];return Dt(this.tempTransform,l,h,u,f,-i,g,_)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function n_(s,e,t,i,n,r,o,a,l,h,u,f){let g=s[e],_=s[e+1],p=0,y=0,E=0,x=0;function C(){p=g,y=_,e+=i,g=s[e],_=s[e+1],x+=E,E=Math.sqrt((g-p)*(g-p)+(_-y)*(_-y))}do C();while(e<t-i&&x+E<r);let T=E===0?0:(r-x)/E;const S=_t(p,g,T),R=_t(y,_,T),b=e-i,P=x,F=r+a*l(h,n,u);for(;e<t-i&&x+E<F;)C();T=E===0?0:(F-x)/E;const I=_t(p,g,T),O=_t(y,_,T);let X;if(f){const k=[S,R,I,O];ko(k,0,4,2,f,k,k),X=k[0]>k[2]}else X=S>I;const Z=Math.PI,G=[],Y=b+i===e;e=b,E=0,x=P,g=s[e],_=s[e+1];let z;if(Y){C(),z=Math.atan2(_-y,g-p),X&&(z+=z>0?-Z:Z);const k=(I+S)/2,B=(O+R)/2;return G[0]=[k,B,(F-r)/2,z,n],G}n=n.replace(/\n/g," ");for(let k=0,B=n.length;k<B;){C();let U=Math.atan2(_-y,g-p);if(X&&(U+=U>0?-Z:Z),z!==void 0){let D=U-z;if(D+=D>Z?-2*Z:D<-Z?2*Z:0,Math.abs(D)>o)return null}z=U;const ie=k;let ee=0;for(;k<B;++k){const D=X?B-k-1:k,ye=a*l(h,n[D],u);if(e+i<t&&x+E<r+ee+ye/2)break;ee+=ye}if(k===ie)continue;const ne=X?n.substring(B-ie,B-k):n.substring(ie,k);T=E===0?0:(r+ee/2-x)/E;const Q=_t(p,g,T),ae=_t(y,_,T);G.push([Q,ae,ee/2,U,ne]),r+=ee}return G}const Vn=lt(),bi=[],fi=[],gi=[],Mi=[];function ac(s){return s[3].declutterBox}const lc=new RegExp("[Ö-à£¿ï¬-ï·¿ï¹°-ï»¼à -à¿¿î -î¿¿]");function Ma(s,e){return e==="start"?e=lc.test(s)?"right":"left":e==="end"&&(e=lc.test(s)?"left":"right"),Or[e]}function s_(s,e,t){return t>0&&s.push(`
`,""),s.push(e,""),s}class r_{constructor(e,t,i,n,r){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=Nt(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new rc:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,i,n){const r=e+t+i+n;if(this.labels_[r])return this.labels_[r];const o=n?this.strokeStates[n]:null,a=i?this.fillStates[i]:null,l=this.textStates[t],h=this.pixelRatio,u=[l.scale[0]*h,l.scale[1]*h],f=Array.isArray(e),g=l.justify?Or[l.justify]:Ma(Array.isArray(e)?e[0]:e,l.textAlign||Fs),_=n&&o.lineWidth?o.lineWidth:0,p=f?e:e.split(`
`).reduce(s_,[]),{width:y,height:E,widths:x,heights:C,lineWidths:T}=ig(l,p),S=y+_,R=[],b=(S+2)*u[0],P=(E+_)*u[1],F={width:b<0?Math.floor(b):Math.ceil(b),height:P<0?Math.floor(P):Math.ceil(P),contextInstructions:R};(u[0]!=1||u[1]!=1)&&R.push("scale",u),n&&(R.push("strokeStyle",o.strokeStyle),R.push("lineWidth",_),R.push("lineCap",o.lineCap),R.push("lineJoin",o.lineJoin),R.push("miterLimit",o.miterLimit),R.push("setLineDash",[o.lineDash]),R.push("lineDashOffset",o.lineDashOffset)),i&&R.push("fillStyle",a.fillStyle),R.push("textBaseline","middle"),R.push("textAlign","center");const I=.5-g;let O=g*S+I*_;const X=[],Z=[];let G=0,Y=0,z=0,k=0,B;for(let U=0,ie=p.length;U<ie;U+=2){const ee=p[U];if(ee===`
`){Y+=G,G=0,O=g*S+I*_,++k;continue}const ne=p[U+1]||l.font;ne!==B&&(n&&X.push("font",ne),i&&Z.push("font",ne),B=ne),G=Math.max(G,C[z]);const Q=[ee,O+I*x[z]+g*(x[z]-T[k]),.5*(_+G)+Y];O+=x[z],n&&X.push("strokeText",Q),i&&Z.push("fillText",Q),++z}return Array.prototype.push.apply(R,X),Array.prototype.push.apply(R,Z),this.labels_[r]=F,F}replayTextBackground_(e,t,i,n,r,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,n),e.lineTo.apply(e,r),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,n,r,o,a,l,h,u,f,g,_,p,y,E){a*=g[0],l*=g[1];let x=i-a,C=n-l;const T=r+h>e?e-h:r,S=o+u>t?t-u:o,R=p[3]+T*g[0]+p[1],b=p[0]+S*g[1]+p[2],P=x-p[3],F=C-p[0];(y||f!==0)&&(bi[0]=P,Mi[0]=P,bi[1]=F,fi[1]=F,fi[0]=P+R,gi[0]=fi[0],gi[1]=F+b,Mi[1]=gi[1]);let I;return f!==0?(I=Dt(Nt(),i,n,1,1,f,-i,-n),Oe(I,bi),Oe(I,fi),Oe(I,gi),Oe(I,Mi),ni(Math.min(bi[0],fi[0],gi[0],Mi[0]),Math.min(bi[1],fi[1],gi[1],Mi[1]),Math.max(bi[0],fi[0],gi[0],Mi[0]),Math.max(bi[1],fi[1],gi[1],Mi[1]),Vn)):ni(Math.min(P,P+R),Math.min(F,F+b),Math.max(P,P+R),Math.max(F,F+b),Vn),_&&(x=Math.round(x),C=Math.round(C)),{drawImageX:x,drawImageY:C,drawImageW:T,drawImageH:S,originX:h,originY:u,declutterBox:{minX:Vn[0],minY:Vn[1],maxX:Vn[2],maxY:Vn[3],value:E},canvasTransform:I,scale:g}}replayImageOrLabel_(e,t,i,n,r,o,a){const l=!!(o||a),h=n.declutterBox,u=a?a[2]*n.scale[0]/2:0;return h.minX-u<=t[0]&&h.maxX+u>=0&&h.minY-u<=t[1]&&h.maxY+u>=0&&(l&&this.replayTextBackground_(e,bi,fi,gi,Mi,o,a),ng(e,n.canvasTransform,r,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const i=Oe(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;e.save(),e.translate(i[0]%n,i[1]%n),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,i,n){const r=this.textStates[t],o=this.createLabel(e,t,n,i),a=this.strokeStates[i],l=this.pixelRatio,h=Ma(Array.isArray(e)?e[0]:e,r.textAlign||Fs),u=Or[r.textBaseline||Sr],f=a&&a.lineWidth?a.lineWidth:0,g=o.width/l-2*r.scale[0],_=h*g+2*(.5-h)*f,p=u*o.height/l+2*(.5-u)*f;return{label:o,anchorX:_,anchorY:p}}execute_(e,t,i,n,r,o,a,l){const h=this.zIndexContext_;let u;this.pixelCoordinates_&&ti(i,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=Ci(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),kd(this.renderedTransform_,i));let f=0;const g=n.length;let _=0,p,y,E,x,C,T,S,R,b,P,F,I,O,X=0,Z=0,G=null,Y=null;const z=this.coordinateCache_,k=this.viewRotation_,B=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,U={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:k},ie=this.instructions!=n||this.overlaps?0:200;let ee,ne,Q,ae;for(;f<g;){const D=n[f];switch(D[0]){case $.BEGIN_GEOMETRY:ee=D[1],ae=D[3],ee.getGeometry()?a!==void 0&&!ze(a,ae.getExtent())?f=D[2]+1:++f:f=D[2],h&&(h.zIndex=D[4]);break;case $.BEGIN_PATH:X>ie&&(this.fill_(e),X=0),Z>ie&&(e.stroke(),Z=0),!X&&!Z&&(e.beginPath(),C=NaN,T=NaN),++f;break;case $.CIRCLE:_=D[1];const Ye=u[_],Ie=u[_+1],$e=u[_+2],vt=u[_+3],Je=$e-Ye,on=vt-Ie,Jt=Math.sqrt(Je*Je+on*on);e.moveTo(Ye+Jt,Ie),e.arc(Ye,Ie,Jt,0,2*Math.PI,!0),++f;break;case $.CLOSE_PATH:e.closePath(),++f;break;case $.CUSTOM:_=D[1],p=D[2];const Zn=D[3],Kn=D[4],qn=D[5];U.geometry=Zn,U.feature=ee,f in z||(z[f]=[]);const Qe=z[f];qn?qn(u,_,p,2,Qe):(Qe[0]=u[_],Qe[1]=u[_+1],Qe.length=2),h&&(h.zIndex=D[6]),Kn(Qe,U),++f;break;case $.DRAW_IMAGE:_=D[1],p=D[2],b=D[3],y=D[4],E=D[5];let zt=D[6];const Ni=D[7],$n=D[8],an=D[9],Qt=D[10];let ce=D[11];const Ee=D[12];let Se=D[13];x=D[14]||"declutter";const nt=D[15];if(!b&&D.length>=20){P=D[19],F=D[20],I=D[21],O=D[22];const et=this.drawLabelWithPointPlacement_(P,F,I,O);b=et.label,D[3]=b;const Wt=D[23];y=(et.anchorX-Wt)*this.pixelRatio,D[4]=y;const st=D[24];E=(et.anchorY-st)*this.pixelRatio,D[5]=E,zt=b.height,D[6]=zt,Se=b.width,D[13]=Se}let _i;D.length>25&&(_i=D[25]);let ei,Lt,Vt;D.length>17?(ei=D[16],Lt=D[17],Vt=D[18]):(ei=Qi,Lt=!1,Vt=!1),Qt&&B?ce+=k:!Qt&&!B&&(ce-=k);let ln=0;for(;_<p;_+=2){if(_i&&_i[ln++]<Se/this.pixelRatio)continue;const et=this.calculateImageOrLabelDimensions_(b.width,b.height,u[_],u[_+1],Se,zt,y,E,$n,an,ce,Ee,r,ei,Lt||Vt,ee),Wt=[e,t,b,et,Ni,Lt?G:null,Vt?Y:null];if(l){let st,ft,rt;if(nt){const Ce=p-_;if(!nt[Ce]){nt[Ce]={args:Wt,declutterMode:x};continue}const je=nt[Ce];st=je.args,ft=je.declutterMode,delete nt[Ce],rt=ac(st)}let bt,Mt;if(st&&(ft!=="declutter"||!l.collides(rt))&&(bt=!0),(x!=="declutter"||!l.collides(et.declutterBox))&&(Mt=!0),ft==="declutter"&&x==="declutter"){const Ce=bt&&Mt;bt=Ce,Mt=Ce}bt&&(ft!=="none"&&l.insert(rt),this.replayImageOrLabel_.apply(this,st)),Mt&&(x!=="none"&&l.insert(et.declutterBox),this.replayImageOrLabel_.apply(this,Wt))}else this.replayImageOrLabel_.apply(this,Wt)}++f;break;case $.DRAW_CHARS:const De=D[1],Jn=D[2],hn=D[3],eo=D[4];O=D[5];const to=D[6],Zs=D[7],Di=D[8];I=D[9];const cn=D[10];P=D[11],F=D[12];const io=[D[13],D[13]];x=D[14]||"declutter";const Qn=this.textStates[F],un=Qn.font,ki=[Qn.scale[0]*Zs,Qn.scale[1]*Zs];let Gi;un in this.widths_?Gi=this.widths_[un]:(Gi={},this.widths_[un]=Gi);const dn=gh(u,De,Jn,2),no=Math.abs(ki[0])*kh(un,P,Gi);if(eo||no<=dn){const et=this.textStates[F].textAlign,Wt=(dn-no)*Ma(P,et),st=n_(u,De,Jn,2,P,Wt,to,Math.abs(ki[0]),kh,un,Gi,B?0:this.viewRotation_);e:if(st){const ft=[];let rt,bt,Mt,Ce,je;if(I)for(rt=0,bt=st.length;rt<bt;++rt){je=st[rt],Mt=je[4],Ce=this.createLabel(Mt,F,"",I),y=je[2]+(ki[0]<0?-cn:cn),E=hn*Ce.height+(.5-hn)*2*cn*ki[1]/ki[0]-Di;const Pt=this.calculateImageOrLabelDimensions_(Ce.width,Ce.height,je[0],je[1],Ce.width,Ce.height,y,E,0,0,je[3],io,!1,Qi,!1,ee);if(l&&x==="declutter"&&l.collides(Pt.declutterBox))break e;ft.push([e,t,Ce,Pt,1,null,null])}if(O)for(rt=0,bt=st.length;rt<bt;++rt){je=st[rt],Mt=je[4],Ce=this.createLabel(Mt,F,O,""),y=je[2],E=hn*Ce.height-Di;const Pt=this.calculateImageOrLabelDimensions_(Ce.width,Ce.height,je[0],je[1],Ce.width,Ce.height,y,E,0,0,je[3],io,!1,Qi,!1,ee);if(l&&x==="declutter"&&l.collides(Pt.declutterBox))break e;ft.push([e,t,Ce,Pt,1,null,null])}l&&x!=="none"&&l.load(ft.map(ac));for(let Pt=0,so=ft.length;Pt<so;++Pt)this.replayImageOrLabel_.apply(this,ft[Pt])}}++f;break;case $.END_GEOMETRY:if(o!==void 0){ee=D[1];const et=o(ee,ae);if(et)return et}++f;break;case $.FILL:ie?X++:this.fill_(e),++f;break;case $.MOVE_TO_LINE_TO:for(_=D[1],p=D[2],ne=u[_],Q=u[_+1],S=ne+.5|0,R=Q+.5|0,(S!==C||R!==T)&&(e.moveTo(ne,Q),C=S,T=R),_+=2;_<p;_+=2)ne=u[_],Q=u[_+1],S=ne+.5|0,R=Q+.5|0,(_==p-2||S!==C||R!==T)&&(e.lineTo(ne,Q),C=S,T=R);++f;break;case $.SET_FILL_STYLE:G=D,this.alignAndScaleFill_=D[2],X&&(this.fill_(e),X=0,Z&&(e.stroke(),Z=0)),e.fillStyle=D[1],++f;break;case $.SET_STROKE_STYLE:Y=D,Z&&(e.stroke(),Z=0),this.setStrokeStyle_(e,D),++f;break;case $.STROKE:ie?Z++:e.stroke(),++f;break;default:++f;break}}X&&this.fill_(e),Z&&e.stroke()}execute(e,t,i,n,r,o){this.viewRotation_=n,this.execute_(e,t,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(e,t,i,n,r){return this.viewRotation_=i,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,n,r)}}const js=["Polygon","Circle","LineString","Image","Text","Default"],hc=["Image","Text"],o_=js.filter(s=>!hc.includes(s));class a_{constructor(e,t,i,n,r,o,a){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Nt(),this.renderedContext_=null,this.deferredZIndexContexts_=[],this.createExecutors_(r,a)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e,t){for(const i in e){let n=this.executorsByZIndex_[i];n===void 0&&(n={},this.executorsByZIndex_[i]=n);const r=e[i];for(const o in r){const a=r[o];n[o]=new r_(this.resolution_,this.pixelRatio_,this.overlaps_,a,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let n=0,r=e.length;n<r;++n)if(e[n]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,n,r,o){n=Math.round(n);const a=n*2+1,l=Dt(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-i,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Be(a,a,void 0,{willReadFrequently:!0}));const u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):h||u.clearRect(0,0,a,a);let f;this.renderBuffer_!==void 0&&(f=lt(),fs(f,e),hs(f,t*(this.renderBuffer_+n),f));const g=l_(n);let _;function p(R,b){const P=u.getImageData(0,0,a,a).data;for(let F=0,I=g.length;F<I;F++)if(P[g[F]]>0){if(!o||_!=="Image"&&_!=="Text"||o.includes(R)){const O=(g[F]-3)/4,X=n-O%a,Z=n-(O/a|0),G=r(R,b,X*X+Z*Z);if(G)return G}u.clearRect(0,0,a,a);break}}const y=Object.keys(this.executorsByZIndex_).map(Number);y.sort(Bi);let E,x,C,T,S;for(E=y.length-1;E>=0;--E){const R=y[E].toString();for(C=this.executorsByZIndex_[R],x=js.length-1;x>=0;--x)if(_=js[x],T=C[_],T!==void 0&&(S=T.executeHitDetection(u,l,i,p,f),S))return S}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],n=t[1],r=t[2],o=t[3],a=[i,n,i,o,r,o,r,n];return Ci(a,0,8,2,e,a),a}isEmpty(){return yn(this.executorsByZIndex_)}execute(e,t,i,n,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(Bi),o=o||js;let h,u,f,g,_,p;for(a&&l.reverse(),h=0,u=l.length;h<u;++h){const y=l[h].toString();for(_=this.executorsByZIndex_[y],f=0,g=o.length;f<g;++f){const E=o[f];if(p=_[E],p!==void 0){const x=a===null?void 0:p.getZIndexContext(),C=x?x.getContext():e,T=this.maxExtent_&&E!=="Image"&&E!=="Text";if(T&&(C.save(),this.clip(C,i)),p.execute(C,t,i,n,r,a),T&&C.restore(),x){x.offset();const S=l[h];this.deferredZIndexContexts_[S]||(this.deferredZIndexContexts_[S]=[]),this.deferredZIndexContexts_[S].push(x)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){this.deferredZIndexContexts_.forEach(e=>{e.forEach(t=>{t.draw(this.renderedContext_),t.clear()})})}}const Pa={};function l_(s){if(Pa[s]!==void 0)return Pa[s];const e=s*2+1,t=s*s,i=new Array(t+1);for(let r=0;r<=s;++r)for(let o=0;o<=s;++o){const a=r*r+o*o;if(a>t)break;let l=i[a];l||(l=[],i[a]=l),l.push(((s+r)*e+(s+o))*4+3),r>0&&l.push(((s-r)*e+(s+o))*4+3),o>0&&(l.push(((s+r)*e+(s-o))*4+3),r>0&&l.push(((s-r)*e+(s-o))*4+3))}const n=[];for(let r=0,o=i.length;r<o;++r)i[r]&&n.push(...i[r]);return Pa[s]=n,n}class h_ extends ic{constructor(e,t,i,n,r,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=n,this.transformRotation_=n?sr(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Nt()}drawImages_(e,t,i,n){if(!this.image_)return;const r=Ci(e,t,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let u=0,f=r.length;u<f;u+=2){const g=r[u]-this.imageAnchorX_,_=r[u+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const p=g+this.imageAnchorX_,y=_+this.imageAnchorY_;Dt(a,p,y,1,1,h,-p,-y),o.save(),o.transform.apply(o,a),o.translate(p,y),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,g,_,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=Ci(e,t,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=n){const l=r[t]+this.textOffsetX_,h=r[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(e,t,i,n,r){const o=this.context_,a=Ci(e,t,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),i}drawRings_(e,t,i,n){for(let r=0,o=i.length;r<o;++r)t=this.moveToLineTo_(e,t,i[r],n,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ze(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=jd(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],n=t[3]-t[1],r=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,n=t.length;i<n;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ze(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(ze(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=e.getFlatCoordinates();let r=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(n,r,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ze(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ze(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let n=0;const r=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];n=this.drawRings_(i,n,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),ti(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,n=e.textAlign?e.textAlign:Fs;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=n&&(i.textAlign=n,t.textAlign=n),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=n,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:n,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:Ht(i||ut)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),n=t.getLineCap(),r=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),h=t.getMiterLimit(),u=r||ai;this.strokeState_={lineCap:n!==void 0?n:On,lineDash:this.pixelRatio_===1?u:u.map(f=>f*this.pixelRatio_),lineDashOffset:(o||li)*this.pixelRatio_,lineJoin:a!==void 0?a:Nn,lineWidth:(l!==void 0?l:Os)*this.pixelRatio_,miterLimit:h!==void 0?h:Ps,strokeStyle:Ht(i||As)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),n=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const _=t.getColor();this.textFillState_={fillStyle:Ht(_||ut)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const _=i.getColor(),p=i.getLineCap(),y=i.getLineDash(),E=i.getLineDashOffset(),x=i.getLineJoin(),C=i.getWidth(),T=i.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:On,lineDash:y||ai,lineDashOffset:E||li,lineJoin:x!==void 0?x:Nn,lineWidth:C!==void 0?C:Os,miterLimit:T!==void 0?T:Ps,strokeStyle:Ht(_||As)}}const n=e.getFont(),r=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),h=e.getScaleArray(),u=e.getText(),f=e.getTextAlign(),g=e.getTextBaseline();this.textState_={font:n!==void 0?n:Nh,textAlign:f!==void 0?f:Fs,textBaseline:g!==void 0?g:Sr},this.text_=u!==void 0?Array.isArray(u)?u.reduce((_,p,y)=>_+=y%2?" ":p,""):u:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const qt=.5;function c_(s,e,t,i,n,r,o,a,l){const h=n,u=s[0]*qt,f=s[1]*qt,g=Be(u,f);g.imageSmoothingEnabled=!1;const _=g.canvas,p=new h_(g,qt,n,null,o,a,null),y=t.length,E=Math.floor((256*256*256-1)/y),x={};for(let T=1;T<=y;++T){const S=t[T-1],R=S.getStyleFunction()||i;if(!R)continue;let b=R(S,r);if(!b)continue;Array.isArray(b)||(b=[b]);const F=(T*E).toString(16).padStart(7,"#00000");for(let I=0,O=b.length;I<O;++I){const X=b[I],Z=X.getGeometryFunction()(S);if(!Z||!ze(h,Z.getExtent()))continue;const G=X.clone(),Y=G.getFill();Y&&Y.setColor(F);const z=G.getStroke();z&&(z.setColor(F),z.setLineDash(null)),G.setText(void 0);const k=X.getImage();if(k){const ee=k.getImageSize();if(!ee)continue;const ne=Be(ee[0],ee[1],void 0,{alpha:!1}),Q=ne.canvas;ne.fillStyle=F,ne.fillRect(0,0,Q.width,Q.height),G.setImage(new Ir({img:Q,anchor:k.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:k.getOrigin(),opacity:1,size:k.getSize(),scale:k.getScale(),rotation:k.getRotation(),rotateWithView:k.getRotateWithView()}))}const B=G.getZIndex()||0;let U=x[B];U||(U={},x[B]=U,U.Polygon=[],U.Circle=[],U.LineString=[],U.Point=[]);const ie=Z.getType();if(ie==="GeometryCollection"){const ee=Z.getGeometriesArrayRecursive();for(let ne=0,Q=ee.length;ne<Q;++ne){const ae=ee[ne];U[ae.getType().replace("Multi","")].push(ae,G)}}else U[ie.replace("Multi","")].push(Z,G)}}const C=Object.keys(x).map(Number).sort(Bi);for(let T=0,S=C.length;T<S;++T){const R=x[C[T]];for(const b in R){const P=R[b];for(let F=0,I=P.length;F<I;F+=2){p.setStyle(P[F+1]);for(let O=0,X=e.length;O<X;++O)p.setTransform(e[O]),p.drawGeometry(P[F])}}}return g.getImageData(0,0,_.width,_.height)}function u_(s,e,t){const i=[];if(t){const n=Math.floor(Math.round(s[0])*qt),r=Math.floor(Math.round(s[1])*qt),o=(Re(n,0,t.width-1)+Re(r,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],u=t.data[o+2]+256*(l+256*a),f=Math.floor((256*256*256-1)/e.length);u&&u%f===0&&i.push(e[u/f-1])}return i}const d_=.5,cc={Point:E_,LineString:p_,Polygon:x_,MultiPoint:C_,MultiLineString:y_,MultiPolygon:v_,GeometryCollection:m_,Circle:g_};function f_(s,e){return parseInt(se(s),10)-parseInt(se(e),10)}function uc(s,e){const t=dc(s,e);return t*t}function dc(s,e){return d_*s/e}function g_(s,e,t,i){const n=t.getFill(),r=t.getStroke();if(n||r){const a=s.getBuilder(t.getZIndex(),"Circle");a.setFillStrokeStyle(n,r),a.drawCircle(e,i)}const o=t.getText();if(o&&o.getText()){const a=s.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i)}}function fc(s,e,t,i,n,r,o,a){const l=[],h=t.getImage();if(h){let g=!0;const _=h.getImageState();_==H.LOADED||_==H.ERROR?g=!1:_==H.IDLE&&h.load(),g&&l.push(h.ready())}const u=t.getFill();u&&u.loading()&&l.push(u.ready());const f=l.length>0;return f&&Promise.all(l).then(()=>n(null)),__(s,e,t,i,r,o,a),f}function __(s,e,t,i,n,r,o){const a=t.getGeometryFunction()(e);if(!a)return;const l=a.simplifyTransformed(i,n);if(t.getRenderer())gc(s,l,t,e,o);else{const u=cc[l.getType()];u(s,l,t,e,o,r)}}function gc(s,e,t,i,n){if(e.getType()=="GeometryCollection"){const o=e.getGeometries();for(let a=0,l=o.length;a<l;++a)gc(s,o[a],t,i,n);return}s.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer(),n)}function m_(s,e,t,i,n,r){const o=e.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=cc[o[a].getType()];h(s,o[a],t,i,n,r)}}function p_(s,e,t,i,n){const r=t.getStroke();if(r){const a=s.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(e,i,n)}const o=t.getText();if(o&&o.getText()){const a=s.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,n)}}function y_(s,e,t,i,n){const r=t.getStroke();if(r){const a=s.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(e,i,n)}const o=t.getText();if(o&&o.getText()){const a=s.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,n)}}function v_(s,e,t,i,n){const r=t.getFill(),o=t.getStroke();if(o||r){const l=s.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=s.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,n)}}function E_(s,e,t,i,n,r){const o=t.getImage(),a=t.getText(),l=a&&a.getText(),h=r&&o&&l?{}:void 0;if(o){if(o.getImageState()!=H.LOADED)return;const u=s.getBuilder(t.getZIndex(),"Image");u.setImageStyle(o,h),u.drawPoint(e,i,n)}if(l){const u=s.getBuilder(t.getZIndex(),"Text");u.setTextStyle(a,h),u.drawText(e,i,n)}}function C_(s,e,t,i,n,r){const o=t.getImage(),a=o&&o.getOpacity()!==0,l=t.getText(),h=l&&l.getText(),u=r&&a&&h?{}:void 0;if(a){if(o.getImageState()!=H.LOADED)return;const f=s.getBuilder(t.getZIndex(),"Image");f.setImageStyle(o,u),f.drawMultiPoint(e,i,n)}if(h){const f=s.getBuilder(t.getZIndex(),"Text");f.setTextStyle(l,u),f.drawText(e,i,n)}}function x_(s,e,t,i,n){const r=t.getFill(),o=t.getStroke();if(r||o){const l=s.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=s.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,n)}}class w_ extends ba{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=lt(),this.wrappedRenderedExtent_=lt(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,i){const n=t.extent,r=t.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,u=l.getExtent(),f=this.getLayer().getSource(),g=this.getLayer().getDeclutter(),_=t.pixelRatio,p=t.viewHints,y=!(p[We.ANIMATING]||p[We.INTERACTING]),E=this.compositionContext_,x=Math.round(t.size[0]*_),C=Math.round(t.size[1]*_),T=f.getWrapX()&&l.canWrapX(),S=T?fe(u):null,R=T?Math.ceil((n[2]-u[2])/S)+1:1;let b=T?Math.floor((n[0]-u[0])/S):0;do{const P=this.getRenderTransform(o,a,h,_,x,C,b*S);e.execute(E,[E.canvas.width,E.canvas.height],P,h,y,i===void 0?js:i?hc:o_,i?g&&t.declutter[g]:void 0)}while(++b<R)}setupCompositionContext_(){if(this.opacity_!==1){const e=Be(this.context.canvas.width,this.context.canvas.height,oc);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,Cr(this.compositionContext_),oc.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.getLayer().getDeclutter()&&(this.setupCompositionContext_(),this.renderWorlds(this.replayGroup_,e,!0),this.releaseCompositionContext_())}renderDeferredInternal(e){this.replayGroup_.renderDeferred()}renderFrame(e,t){const i=e.pixelRatio,n=e.layerStatesArray[e.layerIndex];Gd(this.pixelTransform,1/i,1/i),lr(this.inversePixelTransform,this.pixelTransform);const r=Do(this.pixelTransform);this.useContainer(t,r,this.getBackground(e));const o=this.context,a=o.canvas,l=this.replayGroup_;let h=l&&!l.isEmpty();if(!h&&!(this.getLayer().hasListener(xt.PRERENDER)||this.getLayer().hasListener(xt.POSTRENDER)))return null;const u=Math.round(e.size[0]*i),f=Math.round(e.size[1]*i);a.width!=u||a.height!=f?(a.width=u,a.height=f,a.style.transform!==r&&(a.style.transform=r)):this.containerReused||o.clearRect(0,0,u,f),this.preRender(o,e);const g=e.viewState;g.projection,this.opacity_=n.opacity,this.setupCompositionContext_();let _=!1;if(h&&n.extent&&this.clipping){const p=Yt(n.extent);h=ze(p,e.extent),_=h&&!Ft(p,e.extent),_&&this.clipUnrotated(this.compositionContext_,e,p)}return h&&this.renderWorlds(l,e,this.getLayer().getDeclutter()?!1:void 0),_&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,e),this.renderedRotation_!==g.rotation&&(this.renderedRotation_=g.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];Oe(this.pixelTransform,i);const n=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),u=[],f=i[0]*qt,g=i[1]*qt;u.push(this.getRenderTransform(n,r,o,qt,f,g,0).slice());const _=h.getSource(),p=a.getExtent();if(_.getWrapX()&&a.canWrapX()&&!Ft(p,l)){let y=l[0];const E=fe(p);let x=0,C;for(;y<p[0];)--x,C=E*x,u.push(this.getRenderTransform(n,r,o,qt,f,g,C).slice()),y+=E;for(x=0,y=l[2];y>p[2];)++x,C=E*x,u.push(this.getRenderTransform(n,r,o,qt,f,g,C).slice()),y-=E}this.hitDetectionImageData_=c_(i,u,this.renderedFeatures_,h.getStyleFunction(),l,r,o,uc(r,this.renderedPixelRatio_))}t(u_(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,n,r){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},u=function(p,y,E){const x=se(p),C=h[x];if(C){if(C!==!0&&E<C.distanceSq){if(E===0)return h[x]=!0,r.splice(r.lastIndexOf(C),1),n(p,l,y);C.geometry=y,C.distanceSq=E}}else{if(E===0)return h[x]=!0,n(p,l,y);r.push(h[x]={feature:p,layer:l,geometry:y,distanceSq:E,callback:n})}};let f;const g=[this.replayGroup_],_=this.getLayer().getDeclutter();return g.some(p=>f=p.forEachFeatureAtCoordinate(e,o,a,i,u,_&&t.declutter[_]?t.declutter[_].all().map(y=>y.value):null)),f}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const n=e.viewHints[We.ANIMATING],r=e.viewHints[We.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,u=h.projection,f=h.resolution,g=e.pixelRatio,_=t.getRevision(),p=t.getRenderBuffer();let y=t.getRenderOrder();y===void 0&&(y=f_);const E=h.center.slice(),x=hs(l,p*f),C=x.slice(),T=[x.slice()],S=u.getExtent();if(i.getWrapX()&&u.canWrapX()&&!Ft(S,e.extent)){const Y=fe(S),z=Math.max(fe(x)/2,Y);x[0]=S[0]-z,x[2]=S[2]+z,kl(E,u);const k=Nl(T[0],u);k[0]<S[0]&&k[2]<S[2]?T.push([k[0]+Y,k[1],k[2]+Y,k[3]]):k[0]>S[0]&&k[2]>S[2]&&T.push([k[0]-Y,k[1],k[2]-Y,k[3]])}if(this.ready&&this.renderedResolution_==f&&this.renderedRevision_==_&&this.renderedRenderOrder_==y&&Ft(this.wrappedRenderedExtent_,x))return ti(this.renderedExtent_,C)||(this.hitDetectionImageData_=null,this.renderedExtent_=C),this.renderedCenter_=E,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const R=new e_(dc(f,g),x,f,g);let b;for(let Y=0,z=T.length;Y<z;++Y)i.loadFeatures(T[Y],f,u);const P=uc(f,g);let F=!0;const I=(Y,z)=>{let k;const B=Y.getStyleFunction()||t.getStyleFunction();if(B&&(k=B(Y,f)),k){const U=this.renderFeature(Y,P,k,R,b,this.getLayer().getDeclutter(),z);F=F&&!U}},O=Oo(x),X=i.getFeaturesInExtent(O);y&&X.sort(y);for(let Y=0,z=X.length;Y<z;++Y)I(X[Y],Y);this.renderedFeatures_=X,this.ready=F;const Z=R.finish(),G=new a_(x,f,g,i.getOverlaps(),Z,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=f,this.renderedRevision_=_,this.renderedRenderOrder_=y,this.renderedExtent_=C,this.wrappedRenderedExtent_=x,this.renderedCenter_=E,this.renderedProjection_=u,this.renderedPixelRatio_=g,this.replayGroup_=G,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,n,r,o,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let h=0,u=i.length;h<u;++h)l=fc(n,e,i[h],t,this.boundHandleStyleImageChange_,r,o,a)||l;else l=fc(n,e,i,t,this.boundHandleStyleImageChange_,r,o,a);return l}}class Xs extends ec{constructor(e){super(e)}createRenderer(){return new w_(this)}}const Ae={ADD:"add",REMOVE:"remove"},_c={LENGTH:"length"};class Nr extends ot{constructor(e,t,i){super(e),this.element=t,this.index=i}}class Te extends At{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(_c.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Nr(Ae.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Nr(Ae.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const n=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Nr(Ae.REMOVE,n,e)),this.dispatchEvent(new Nr(Ae.ADD,t,e))}updateLength_(){this.set(_c.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===e&&i!==t)throw new Error("Duplicate item added to a unique collection")}}class Aa{constructor(e){this.rbush_=new Eh(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[se(t)]=i}load(e,t){const i=new Array(t.length);for(let n=0,r=t.length;n<r;n++){const o=e[n],a=t[n],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[n]=l,this.items_[se(a)]=l}this.rbush_.load(i)}remove(e){const t=se(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[se(t)],n=[i.minX,i.minY,i.maxX,i.maxY];Ui(n,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(n){return n.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let n=0,r=e.length;n<r;n++)if(i=t(e[n]),i)return i;return i}isEmpty(){return yn(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return ni(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const mc=Nt();class Rt{constructor(e,t,i,n,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=r,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?us(this.flatCoordinates_):So(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=Ue(this.getExtent());this.flatInteriorPoints_=Uo(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=nf(this.flatCoordinates_,this.ends_),t=_h(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=Jl(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=_r(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let n=0,r=i.length;n<r;++n){const o=i[n],a=_r(e,t,o,2,.5);Ct(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=ht(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const n=Ge(i)/Ge(t);Dt(mc,i[0],i[3],n,-n,0,0,0),Ci(this.flatCoordinates_,0,this.flatCoordinates_.length,2,mc,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var e;return new Rt(this.type_,this.flatCoordinates_.slice(),(e=this.ends_)==null?void 0:e.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Rl((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const i=this.simplifiedGeometry_.getFlatCoordinates();let n;switch(this.type_){case"LineString":i.length=ur(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,i,0),n=[i.length];break;case"MultiLineString":n=[],i.length=Kl(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,i,0,n);break;case"Polygon":n=[],i.length=jo(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),i,0,n);break}return n&&(this.simplifiedGeometry_=new Rt(this.type_,i,n,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}Rt.prototype.getFlatCoordinates=Rt.prototype.getOrientedFlatCoordinates;class Fa extends At{constructor(e){super(),this.projection=ht(e.projection),this.attributions_=pc(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,n){t.viewResolver=i,t.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=pc(e),this.changed()}setState(e){this.state_=e,this.changed()}}function pc(s){return s?Array.isArray(s)?function(e){return s}:typeof s=="function"?s:function(e){return[s]}:null}const pt={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function T_(s,e){return[[-1/0,-1/0,1/0,1/0]]}let S_=!1;function R_(s,e,t,i,n,r,o){const a=new XMLHttpRequest;a.open("GET",typeof s=="function"?s(t,i,n):s,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=S_,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=e.getType();let u;h=="json"?u=JSON.parse(a.responseText):h=="text"?u=a.responseText:h=="xml"?(u=a.responseXML,u||(u=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(u=a.response),u?r(e.readFeatures(u,{extent:t,featureProjection:n}),e.readProjection(u)):o()}else o()},a.onerror=o,a.send()}function yc(s,e){return function(t,i,n,r,o){const a=this;R_(s,e,t,i,n,function(l,h){a.addFeatures(l),r!==void 0&&r(l)},o||mn)}}class Pi extends ot{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class Dr extends Fa{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=mn,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(he(this.format_,"`format` must be set when `url` is set"),this.loader_=yc(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:T_;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new Aa:null,this.loadedExtentsRtree_=new Aa,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(e.features)?n=e.features:e.features&&(i=e.features,n=i.getArray()),!t&&i===void 0&&(i=new Te(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=se(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Pi(pt.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof Rt||(this.featureChangeKeys_[e]=[re(t,q.CHANGE,this.handleFeatureChange_,this),re(t,Wi.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const n=String(t.getId());if(!(n in this.idIndex_))this.idIndex_[n]=t;else if(t instanceof Rt){const r=this.idIndex_[n];r instanceof Rt?Array.isArray(r)?r.push(t):this.idIndex_[n]=[r,t]:i=!1}else i=!1}return i&&(he(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],n=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],l=se(a);this.addToIndex_(l,a)&&i.push(a)}for(let r=0,o=i.length;r<o;r++){const a=i[r],l=se(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const u=h.getExtent();t.push(u),n.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,n),this.hasListener(pt.ADDFEATURE))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new Pi(pt.ADDFEATURE,i[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(pt.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(pt.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(Ae.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(Ae.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(me);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=n=>{this.removeFeatureInternal(n)};this.featuresRtree_.forEach(i);for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Pi(pt.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(n){const r=n.getGeometry();if(r instanceof Rt||r.intersectsCoordinate(e))return t(n)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const n=i.getGeometry();if(n instanceof Rt||n.intersectsExtent(e)){const r=t(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),yn(this.nullGeometryFeatures_)||Ct(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const n=Cd(e,t);return[].concat(...n.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],n=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||jt,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const u=h.getGeometry(),f=a;if(a=u instanceof Rt?0:u.closestPointXY(i,n,o,a),a<f){r=h;const g=Math.sqrt(a);l[0]=i-g,l[1]=n-g,l[2]=i+g,l[3]=n+g}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=se(t),n=t.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const o=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new Pi(pt.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:se(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&yn(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const n=this.loadedExtentsRtree_,r=this.strategy_(e,t,i);for(let o=0,a=r.length;o<a;++o){const l=r[o];n.forEachInExtent(l,function(u){return Ft(u.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Pi(pt.FEATURESLOADSTART)),this.loader_.call(this,l,t,i,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new Pi(pt.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Pi(pt.FEATURESLOADERROR))}),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let i;t.forEachInExtent(e,function(n){if(Ui(n.extent,e))return i=n,!0}),i&&t.remove(i)}removeFeature(e){if(!e)return;const t=se(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=se(e),i=this.featureChangeKeys_[t];if(!i)return;i.forEach(me),delete this.featureChangeKeys_[t];const n=e.getId();return n!==void 0&&delete this.idIndex_[n.toString()],delete this.uidIndex_[t],this.dispatchEvent(new Pi(pt.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const i in this.idIndex_){const n=this.idIndex_[i];if(e instanceof Rt&&Array.isArray(n)&&n.includes(e))n.splice(n.indexOf(e),1);else if(this.idIndex_[i]===e){delete this.idIndex_[i],t=!0;break}}return t}setLoader(e){this.loader_=e}setUrl(e){he(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(yc(e,this.format_))}}const kr={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Gr extends ot{constructor(e,t){super(e),this.feature=t}}function I_(s,e){const t=[];for(let i=0;i<e.length;++i){const r=e[i].getGeometry();vc(s,r,t)}return t}function zr(s,e){return si(s[0],s[1],e[0],e[1])}function Wn(s,e){const t=s.length;return e<0?s[e+t]:e>=t?s[e-t]:s[e]}function Vr(s,e,t){let i,n;e<t?(i=e,n=t):(i=t,n=e);const r=Math.ceil(i),o=Math.floor(n);if(r>o){const l=Bn(s,i),h=Bn(s,n);return zr(l,h)}let a=0;if(i<r){const l=Bn(s,i),h=Wn(s,r);a+=zr(l,h)}if(o<n){const l=Wn(s,o),h=Bn(s,n);a+=zr(l,h)}for(let l=r;l<o-1;++l){const h=Wn(s,l),u=Wn(s,l+1);a+=zr(h,u)}return a}function vc(s,e,t){if(e instanceof kt){Wr(s,e.getCoordinates(),!1,t);return}if(e instanceof Es){const i=e.getCoordinates();for(let n=0,r=i.length;n<r;++n)Wr(s,i[n],!1,t);return}if(e instanceof tt){const i=e.getCoordinates();for(let n=0,r=i.length;n<r;++n)Wr(s,i[n],!0,t);return}if(e instanceof Cs){const i=e.getCoordinates();for(let n=0,r=i.length;n<r;++n){const o=i[n];for(let a=0,l=o.length;a<l;++a)Wr(s,o[a],!0,t)}return}if(e instanceof vs){const i=e.getGeometries();for(let n=0;n<i.length;++n)vc(s,i[n],t);return}}const Oa={index:-1,endIndex:NaN};function L_(s,e,t,i){const n=s[0],r=s[1];let o=1/0,a=-1,l=NaN;for(let f=0;f<e.targets.length;++f){const g=e.targets[f],_=g.coordinates;let p=1/0,y;for(let E=0;E<_.length-1;++E){const x=_[E],C=_[E+1],T=Ec(n,r,x,C);T.squaredDistance<p&&(p=T.squaredDistance,y=E+T.along)}p<o&&(o=p,g.ring&&e.targetIndex===f&&(g.endIndex>g.startIndex?y<g.startIndex&&(y+=_.length):g.endIndex<g.startIndex&&y>g.startIndex&&(y-=_.length)),l=y,a=f)}const h=e.targets[a];let u=h.ring;if(e.targetIndex===a&&u){const f=Bn(h.coordinates,l),g=t.getPixelFromCoordinate(f);or(g,e.startPx)>i&&(u=!1)}if(u){const f=h.coordinates,g=f.length,_=h.startIndex,p=l;if(_<p){const y=Vr(f,_,p);Vr(f,_,p-g)<y&&(l-=g)}else{const y=Vr(f,_,p);Vr(f,_,p+g)<y&&(l+=g)}}return Oa.index=a,Oa.endIndex=l,Oa}function Wr(s,e,t,i){const n=s[0],r=s[1];for(let o=0,a=e.length-1;o<a;++o){const l=e[o],h=e[o+1],u=Ec(n,r,l,h);if(u.squaredDistance===0){const f=o+u.along;i.push({coordinates:e,ring:t,startIndex:f,endIndex:f});return}}}const Na={along:0,squaredDistance:0};function Ec(s,e,t,i){const n=t[0],r=t[1],o=i[0],a=i[1],l=o-n,h=a-r;let u=0,f=n,g=r;return(l!==0||h!==0)&&(u=Re(((s-n)*l+(e-r)*h)/(l*l+h*h),0,1),f+=l*u,g+=h*u),Na.along=u,Na.squaredDistance=sr(si(s,e,f,g),10),Na}function Bn(s,e){const t=s.length;let i=Math.floor(e);const n=e-i;i>=t?i-=t:i<0&&(i+=t);let r=i+1;r>=t&&(r-=t);const o=s[i],a=o[0],l=o[1],h=s[r],u=h[0]-a,f=h[1]-l;return[a+u*n,l+f*n]}class b_ extends ri{constructor(e){const t=e;t.stopDown||(t.stopDown=_n),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=A_(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:jt,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const n=this.mode_;if(n==="Circle")i=function(r,o,a){const l=o||new Ji([NaN,NaN]),h=we(r[0]),u=In(h,we(r[r.length-1]));return l.setCenterAndRadius(h,Math.sqrt(u),this.geometryLayout_),l};else{let r;n==="Point"?r=Ve:n==="LineString"?r=kt:n==="Polygon"&&(r=tt),i=function(o,a,l){return a?n==="Polygon"?o[0].length?a.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(o,this.geometryLayout_):a=new r(o,this.geometryLayout_),a}}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Xs({source:new Dr({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:M_(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:fr,this.freehandCondition_,e.freehand?this.freehandCondition_=ps:this.freehandCondition_=e.freehandCondition?e.freehandCondition:ys,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(er.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=ps:t=e:t=$o,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===q.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===le.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===le.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===le.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===le.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===le.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===le.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===le.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new oi(le.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),n=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),r=at([i,n]),o=this.traceSource_.getFeaturesInExtent(r);if(o.length===0)return;const a=I_(e.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,n=e.startIndex<=t;i===n?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const n=Math.ceil(e);let r=Math.floor(t);r===t&&(r-=1),i=r-n+1}else{const n=Math.floor(e);let r=Math.ceil(t);r===t&&(r+=1),i=n-r+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const n=[];if(t<i){const r=Math.ceil(t);let o=Math.floor(i);o===i&&(o-=1);for(let a=r;a<=o;++a)n.push(Wn(e.coordinates,a))}else{const r=Math.floor(t);let o=Math.ceil(i);o===i&&(o+=1);for(let a=r;a>=o;--a)n.push(Wn(e.coordinates,a))}n.length&&this.appendCoordinates(n)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&or(t.startPx,e.pixel)<this.snapTolerance_)return;const i=L_(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[i.index];this.addTracedCoordinates_(a,a.startIndex,i.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,i.endIndex)}t.targetIndex=i.index;const n=t.targets[t.targetIndex];n.endIndex=i.endIndex;const r=Bn(n.coordinates,n.endIndex),o=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(e.coordinate),!n&&this.freehand_?this.finishDrawing():!this.freehand_&&(!n||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,n=t[0]-i[0],r=t[1]-i[1],o=n*n+r*r;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let n=!1,r=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")i=!0;else if(o==="Circle")i=this.sketchCoords_.length===2;else if(o==="LineString")n=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const a=this.sketchCoords_;n=a[0].length>this.minPoints_,r=[a[0][0],a[0][a[0].length-2]],t?r=[a[0][0]]:r=[a[0][0],a[0][a[0].length-2]]}if(n){const a=this.getMap();for(let l=0,h=r.length;l<h;l++){const u=r[l],f=a.getPixelFromCoordinate(u),g=e[0]-f[0],_=e[1]-f[1],p=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(g*g+_*_)<=p,i){this.finishCoordinate_=u;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Pe(new Ve(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Pe);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new kt(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=hr(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Pe(new kt(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Pe,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new Gr(kr.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),n=t.getView().getProjection(),r=hr(this.geometryLayout_);let o,a;for(;e.length<r;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let n,r;const o=this.mode_;return o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():n=!0),r.push(e.slice()),this.geometryFunction_(r,t,i)):o==="Polygon"&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():n=!0),r.push(e.slice()),n&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),n?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),n=this.mode_;for(let r=0;r<e;++r){let o;if(n==="LineString"||n==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const a=this.finishCoordinate_.slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(o,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(n==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const a=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,i)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),n=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,n)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,n),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new mr([t])):this.type_==="MultiLineString"?e.setGeometry(new Es([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Cs([t])),this.dispatchEvent(new Gr(kr.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Gr(kr.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let n;if(t==="LineString"||t==="Circle")n=this.sketchCoords_;else if(t==="Polygon")n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&n.shift(),n.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const r=e[e.length-1];this.sketchFeature_=this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.sketchPoint_=new Pe(new Ve(n)),this.updateSketchFeatures_(),this.dispatchEvent(new Gr(kr.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function M_(){const s=Ta();return function(e,t){return s[e.getGeometry().getType()]}}function P_(){return function(s,e,t){const i=at([s[0],s[s.length-1]].map(function(r){return we(r)})),n=[[Tn(i),Sn(i),gs(i),Xt(i),Tn(i)]];return e?e.setCoordinates(n):e=new tt(n),e}}function A_(s){switch(s){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+s)}}const nn={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class F_ extends vn{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return fr(t)&&dh(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==q.KEYDOWN){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==nn.DOWN||n==nn.LEFT||n==nn.RIGHT||n==nn.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;n==nn.DOWN?h=-a:n==nn.LEFT?l=-a:n==nn.RIGHT?l=a:h=a;const u=[l,h];bo(u,o.getRotation()),rd(o,u,this.duration_),i.preventDefault(),t=!0}}return!t}}class O_ extends vn{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!df(t)&&dh(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==q.KEYDOWN||e.type==q.KEYPRESS){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==="+"||n==="-")){const r=e.map,o=n==="+"?this.delta_:-this.delta_,a=r.getView();Eo(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const $t={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Cc=0,Ys=1,xc=[0,0,0,0],jn=[],Da={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class ka extends ot{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class N_ extends ri{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Qo,this.defaultDeleteCondition_=function(i){return hf(i)&&uh(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:ps,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Aa,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Xs({source:new Dr({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:k_(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new Te(this.source_.getFeatures()),this.source_.addEventListener(pt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(pt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ae.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ae.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const n=this.SEGMENT_WRITERS_[t.getType()];n&&n(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(q.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Te;const i=this.featuresBeingModified_.getArray();for(let n=0,r=t.length;n<r;++n){const o=t[n];for(let a=0,l=o.length;a<l;++a){const h=o[a].feature;h&&!i.includes(h)&&this.featuresBeingModified_.push(h)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new ka(Da.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(q.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(n){e===n.feature&&i.push(n)});for(let n=i.length-1;n>=0;--n){const r=i[n];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),n={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),n)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const o=i[n],a={feature:e,geometry:t,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length-1;n<r;++n){const o=i.slice(n,n+2),a={feature:e,geometry:t,index:n,segment:o};this.rBush_.insert(at(o),a)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const o=i[n];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),u={feature:e,geometry:t,depth:[n],index:a,segment:h};this.rBush_.insert(at(h),u)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const o=i[n];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),u={feature:e,geometry:t,depth:[n],index:a,segment:h};this.rBush_.insert(at(h),u)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const o=i[n];for(let a=0,l=o.length;a<l;++a){const h=o[a];for(let u=0,f=h.length-1;u<f;++u){const g=h.slice(u,u+2),_={feature:e,geometry:t,depth:[a,n],index:u,segment:g};this.rBush_.insert(at(g),_)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),n={feature:e,geometry:t,index:Cc,segment:[i,i]},r={feature:e,geometry:t,index:Ys,segment:[i,i]},o=[n,r];n.featureSegments=o,r.featureSegments=o,this.rBush_.insert(us(i),n);let a=t;this.rBush_.insert(a.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let n=0;n<i.length;++n){const r=i[n],o=this.SEGMENT_WRITERS_[r.getType()];o(e,r)}}createOrUpdateVertexFeature_(e,t,i){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(e):(n=new Pe(new Ve(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",t),n.set("geometries",i),n}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==le.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=le.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==le.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],n=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){const a=this.dragSegments_[r],l=a[0],h=l.feature;i.includes(h)||i.push(h);const u=l.geometry;n.includes(u)||n.push(u);const f=l.depth;let g;const _=l.segment,p=a[1];for(;t.length<u.getStride();)t.push(_[p][t.length]);switch(u.getType()){case"Point":g=t,_[0]=t,_[1]=t;break;case"MultiPoint":g=u.getCoordinates(),g[l.index]=t,_[0]=t,_[1]=t;break;case"LineString":g=u.getCoordinates(),g[l.index+p]=t,_[p]=t;break;case"MultiLineString":g=u.getCoordinates(),g[f[0]][l.index+p]=t,_[p]=t;break;case"Polygon":g=u.getCoordinates(),g[f[0]][l.index+p]=t,_[p]=t;break;case"MultiPolygon":g=u.getCoordinates(),g[f[1]][f[0]][l.index+p]=t,_[p]=t;break;case"Circle":if(_[0]=t,_[1]=t,l.index===Cc)this.changingFeature_=!0,u.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let y=or(we(u.getCenter()),we(t));u.setRadius(y),this.changingFeature_=!1}break}g&&this.setGeometryCoordinates_(u,g)}this.createOrUpdateVertexFeature_(t,i,n)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){e.map.getView().getProjection();const n=[],r=i.getGeometry().getCoordinates(),o=at([r]),a=this.rBush_.getInExtent(o),l={};a.sort(D_);for(let h=0,u=a.length;h<u;++h){const f=a[h],g=f.segment;let _=se(f.geometry);const p=f.depth;if(p&&(_+="-"+p.join("-")),l[_]||(l[_]=new Array(2)),f.geometry.getType()==="Circle"&&f.index===Ys){const y=Tc(t,f);Ot(y,r)&&!l[_][0]&&(this.dragSegments_.push([f,0]),l[_][0]=f);continue}if(Ot(g[0],r)&&!l[_][0]){this.dragSegments_.push([f,0]),l[_][0]=f;continue}if(Ot(g[1],r)&&!l[_][1]){if(l[_][0]&&l[_][0].index===0){let y=f.geometry.getCoordinates();switch(f.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":y=y[p[1]];case"Polygon":if(f.index!==y[p[0]].length-2)continue;break}}this.dragSegments_.push([f,1]),l[_][1]=f;continue}se(g)in this.vertexSegments_&&!l[_][0]&&!l[_][1]&&this.insertVertexCondition_(e)&&n.push(f)}n.length&&this.willModifyFeatures_(e,[n]);for(let h=n.length-1;h>=0;--h)this.insertVertex_(n[h],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],n=i.geometry;if(n.getType()==="Circle"){const r=n.getCenter(),o=i.featureSegments[0],a=i.featureSegments[1];o.segment[0]=r,o.segment[1]=r,a.segment[0]=r,a.segment[1]=r,this.rBush_.update(us(r),o);let l=n;this.rBush_.update(l.getExtent(),a)}else this.rBush_.update(at(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new ka(Da.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,i){const n=i||t.getCoordinateFromPixel(e);t.getView().getProjection();const r=function(l,h){return wc(n,l)-wc(n,h)};let o,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?h=>h===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(h,u,f)=>{f&&f.getType()==="Point"&&(f=new Ve(Ln(f.getCoordinates())));const g=f||h.getGeometry();if(h instanceof Pe&&this.features_.getArray().includes(h)){a=g;const _=h.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:h,geometry:a,segment:[_,_]}]}return!0},{layerFilter:l})}if(!o){const l=Yt(us(n,xc)),h=t.getView().getResolution()*this.pixelTolerance_,u=Oo(hs(l,h,xc));o=this.rBush_.getInExtent(u)}if(o&&o.length>0){const l=o.sort(r)[0],h=l.segment;let u=Tc(n,l);const f=t.getPixelFromCoordinate(u);let g=or(e,f);if(a||g<=this.pixelTolerance_){const _={};if(_[se(h)]=!0,this.snapToPointer_||(this.delta_[0]=u[0]-n[0],this.delta_[1]=u[1]-n[1]),l.geometry.getType()==="Circle"&&l.index===Ys)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(u,[l.feature],[l.geometry]);else{const p=t.getPixelFromCoordinate(h[0]),y=t.getPixelFromCoordinate(h[1]),E=In(f,p),x=In(f,y);g=Math.sqrt(Math.min(E,x)),this.snappedToVertex_=g<=this.pixelTolerance_,this.snappedToVertex_&&(u=E>x?h[1]:h[0]),this.createOrUpdateVertexFeature_(u,[l.feature],[l.geometry]);const C={};C[se(l.geometry)]=!0;for(let T=1,S=o.length;T<S;++T){const R=o[T].segment;if(Ot(h[0],R[0])&&Ot(h[1],R[1])||Ot(h[0],R[1])&&Ot(h[1],R[0])){const b=se(o[T].geometry);b in C||(C[b]=!0,_[se(R)]=!0)}else break}}this.vertexSegments_=_;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,n=e.feature,r=e.geometry,o=e.depth,a=e.index;let l;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"Polygon":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"MultiPolygon":l=r.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":l=r.getCoordinates(),l.splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(r,l);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(r,a,o,1);const u={segment:[i[0],t],feature:n,geometry:r,depth:o,index:a};h.insert(at(u.segment),u),this.dragSegments_.push([u,1]);const f={segment:[t,i[1]],feature:n,geometry:r,depth:o,index:a+1};h.insert(at(f.segment),f),this.dragSegments_.push([f,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=le.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new ka(Da.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,n,r,o,a,l,h,u,f,g,_,p;for(l=e.length-1;l>=0;--l)o=e[l],_=o[0],p=se(_.feature),_.depth&&(p+="-"+_.depth.join("-")),p in t||(t[p]={}),o[1]===0?(t[p].right=_,t[p].index=_.index):o[1]==1&&(t[p].left=_,t[p].index=_.index+1);for(p in t){switch(g=t[p].right,u=t[p].left,h=t[p].index,f=h-1,u!==void 0?_=u:_=g,f<0&&(f=0),a=_.geometry,r=a.getCoordinates(),n=r,i=!1,a.getType()){case"MultiLineString":r[_.depth[0]].length>2&&(r[_.depth[0]].splice(h,1),i=!0);break;case"LineString":r.length>2&&(r.splice(h,1),i=!0);break;case"MultiPolygon":n=n[_.depth[1]];case"Polygon":n=n[_.depth[0]],n.length>4&&(h==n.length-1&&(h=0),n.splice(h,1),i=!0,h===0&&(n.pop(),n.push(n[0]),f=n.length-1));break}if(i){this.setGeometryCoordinates_(a,r);const y=[];if(u!==void 0&&(this.rBush_.remove(u),y.push(u.segment[0])),g!==void 0&&(this.rBush_.remove(g),y.push(g.segment[1])),u!==void 0&&g!==void 0){const E={depth:_.depth,feature:_.feature,geometry:_.geometry,index:f,segment:y};this.rBush_.insert(at(E.segment),E)}this.updateSegmentIndices_(a,h,_.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,n){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(i===void 0||r.depth===void 0||ti(r.depth,i))&&r.index>t&&(r.index+=n)})}}function D_(s,e){return s.index-e.index}function wc(s,e,t){const i=e.geometry;if(i.getType()==="Circle"){let r=i;if(e.index===Ys){const o=In(r.getCenter(),we(s)),a=Math.sqrt(o)-r.getRadius();return a*a}}const n=we(s);return jn[0]=we(e.segment[0]),jn[1]=we(e.segment[1]),Rd(n,jn)}function Tc(s,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===Ys)return Ln(i.getClosestPoint(we(s)));const n=we(s);return jn[0]=we(e.segment[0]),jn[1]=we(e.segment[1]),Ln(Dl(n,jn))}function k_(){const s=Ta();return function(e,t){return s.Point}}class Sc extends vn{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:ps;this.condition_=e.onFocusOnly?qo(hh,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==q.WHEEL)return!0;const i=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let r;if(e.type==q.WHEEL&&(r=n.deltaY,of&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=oh),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-Re(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Eo(t,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class G_ extends ri{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=_n),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=r;const o=e.map,a=o.getView();a.getConstraints().rotation!==ia&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(No(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class z_ extends ri{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=_n),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,o=i.clientY-n.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(No(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const V_={SELECT:"select"};class W_ extends ot{constructor(e,t,i,n){super(e),this.selected=t,this.deselected=i,this.mapBrowserEvent=n}}const Br={};class Ga extends vn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:uh,this.addCondition_=e.addCondition?e.addCondition:$o,this.removeCondition_=e.removeCondition?e.removeCondition:$o,this.toggleCondition_=e.toggleCondition?e.toggleCondition:ys,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:jt,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:B_(),this.features_=e.features||new Te;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const i=e.layers;t=function(n){return i.includes(n)}}else t=jt;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[se(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[se(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(Ae.ADD,this.boundAddFeature_),this.features_.addEventListener(Ae.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Ae.ADD,this.boundAddFeature_),this.features_.removeEventListener(Ae.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const i=this.getMap().getAllLayers().find(function(n){if(n instanceof Xs&&n.getSource()&&n.getSource().hasFeature(t))return n});i&&this.addFeatureLayerAssociation_(t,i)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=se(e);t in Br||(Br[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let n=t.length-1;n>=0;--n){const r=t[n];if(r!==this&&r instanceof Ga&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(r.getStyle());return}}const i=se(e);e.setStyle(Br[i]),delete Br[i]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[se(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),i=this.removeCondition_(e),n=this.toggleCondition_(e),r=!t&&!i&&!n,o=e.map,a=this.getFeatures(),l=[],h=[];if(r){pn(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,(u,f)=>{if(!(!(u instanceof Pe)||!this.filter_(u,f)))return this.addFeatureLayerAssociation_(u,f),h.push(u),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=a.getLength()-1;u>=0;--u){const f=a.item(u),g=h.indexOf(f);g>-1?h.splice(g,1):(a.remove(f),l.push(f))}h.length!==0&&a.extend(h)}else{o.forEachFeatureAtPixel(e.pixel,(u,f)=>{if(!(!(u instanceof Pe)||!this.filter_(u,f)))return(t||n)&&!a.getArray().includes(u)?(this.addFeatureLayerAssociation_(u,f),h.push(u)):(i||n)&&a.getArray().includes(u)&&(l.push(u),this.removeFeatureLayerAssociation_(u)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=l.length-1;u>=0;--u)a.remove(l[u]);a.extend(h)}return(h.length>0||l.length>0)&&this.dispatchEvent(new W_(V_.SELECT,h,l,e)),!0}}function B_(){const s=Ta();return Ct(s.Polygon,s.LineString),Ct(s.GeometryCollection,s.LineString),function(e){return e.getGeometry()?s[e.getGeometry().getType()]:null}}const za={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class Va extends ot{constructor(e,t,i,n,r){super(e),this.features=t,this.coordinate=i,this.startCoordinate=n,this.mapBrowserEvent=r}}class j_ extends ri{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=e.features!==void 0?e.features:null;let t;if(e.layers&&!this.features_)if(typeof e.layers=="function")t=e.layers;else{const i=e.layers;t=function(n){return i.includes(n)}}else t=jt;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:jt,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:ps,this.lastFeature_=null,this.addChangeListener(er.ACTIVE,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new Te([this.lastFeature_]);return this.dispatchEvent(new Va(za.TRANSLATESTART,t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new Te([this.lastFeature_]);return this.dispatchEvent(new Va(za.TRANSLATEEND,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate;e.map.getView().getProjection();const i=we(t),n=we(this.lastCoordinate_),r=i[0]-n[0],o=i[1]-n[1],a=this.features_||new Te([this.lastFeature_]);a.forEach(function(l){const h=l.getGeometry();h.translate(r,o),l.setGeometry(h)}),this.lastCoordinate_=t,this.dispatchEvent(new Va(za.TRANSLATING,a,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(i,n)=>{if(!(!(i instanceof Pe)||!this.filter_(i,n))&&!(this.features_&&!this.features_.getArray().includes(i)))return i},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const i=this.getActive();(!t||!i)&&(t=t||e,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}}class X_{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const n=this.points_[t+2]-this.points_[i+2];if(n<1e3/60)return!1;const r=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}function Rc(s){s=s||{};const e=new Te,t=new X_(-.005,.05,100);return(s.altShiftDragRotate!==void 0?s.altShiftDragRotate:!0)&&e.push(new mf),(s.doubleClickZoom!==void 0?s.doubleClickZoom:!0)&&e.push(new od({delta:s.zoomDelta,duration:s.zoomDuration})),(s.dragPan!==void 0?s.dragPan:!0)&&e.push(new ta({onFocusOnly:s.onFocusOnly,kinetic:t})),(s.pinchRotate!==void 0?s.pinchRotate:!0)&&e.push(new G_),(s.pinchZoom!==void 0?s.pinchZoom:!0)&&e.push(new z_({duration:s.zoomDuration})),(s.keyboard!==void 0?s.keyboard:!0)&&(e.push(new F_),e.push(new O_({delta:s.zoomDelta,duration:s.zoomDuration}))),(s.mouseWheelZoom!==void 0?s.mouseWheelZoom:!0)&&e.push(new Sc({onFocusOnly:s.onFocusOnly,duration:s.zoomDuration})),(s.shiftDragZoom!==void 0?s.shiftDragZoom:!0)&&e.push(new pf({duration:s.zoomDuration})),e}const J={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Ic extends ss{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(q.CHANGE)}release(){this.state===J.ERROR&&this.setState(J.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==J.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==J.LOADED){e.interimTile=null;break}e.getState()==J.LOADING?t=e:e.getState()==J.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==J.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){ue()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const n=t-i+1e3/60;return n>=this.transition_?1:bl(n/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}class Wa extends Ic{constructor(e,t,i,n,r,o){super(e,t,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=J.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=J.ERROR,this.unlistenImage_(),this.image_=Y_(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=J.LOADED:this.state=J.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==J.ERROR&&(this.state=J.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==J.IDLE&&(this.state=J.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Hf(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Y_(){const s=Be(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}class U_ extends vo{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){ue()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;Dt(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),lr(n,i)}forEachFeatureAtCoordinate(e,t,i,n,r,o,a,l){let h;const u=t.viewState;function f(S,R,b,P){return r.call(o,R,S?b:null,P)}const g=u.projection,_=kl(e.slice(),g),p=[[0,0]];if(g.canWrapX()&&n){const S=g.getExtent(),R=fe(S);p.push([-R,0],[R,0])}const y=t.layerStatesArray,E=y.length,x=[],C=[];for(let S=0;S<p.length;S++)for(let R=E-1;R>=0;--R){const b=y[R],P=b.layer;if(P.hasRenderer()&&ha(b,u)&&a.call(l,P)){const F=P.getRenderer(),I=P.getSource();if(F&&I){const O=I.getWrapX()?_:e,X=f.bind(null,b.managed);C[0]=O[0]+p[S][0],C[1]=O[1]+p[S][1],h=F.forEachFeatureAtCoordinate(C,t,i,X,x)}if(h)return h}}if(x.length===0)return;const T=1/x.length;return x.forEach((S,R)=>S.distanceSq+=R*T),x.sort((S,R)=>S.distanceSq-R.distanceSq),x.some(S=>h=S.callback(S.feature,S.layer,S.geometry)),h}hasFeatureAtCoordinate(e,t,i,n,r,o){return this.forEachFeatureAtCoordinate(e,t,i,n,jt,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(e){ue()}scheduleExpireIconCache(e){Ut.canExpireCache()&&e.postRenderFunctions.push(H_)}}function H_(s,e){Ut.expire()}class Z_ extends U_{constructor(e){super(e),this.fontChangeListenerKey_=re(hi,Wi.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Si+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const n=new sc(e,void 0,t);i.dispatchEvent(n)}}disposeInternal(){me(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(xt.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(a,l){return a.zIndex-l.zIndex});t.some(a=>a.layer instanceof ec&&a.layer.getDeclutter())&&(e.declutter={});const n=e.viewState;this.children_.length=0;const r=[];let o=null;for(let a=0,l=t.length;a<l;++a){const h=t[a];e.layerIndex=a;const u=h.layer,f=u.getSourceState();if(!ha(h,n)||f!="ready"&&f!="undefined"){u.unrender();continue}const g=u.render(e,o);g&&(g!==o&&(this.children_.push(g),o=g),r.push(h))}this.declutter(e,r),Uf(this.element_,this.children_),this.dispatchRenderEvent(xt.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){for(let i=t.length-1;i>=0;--i){const n=t[i],r=n.layer;r.getDeclutter()&&r.renderDeclutter(e,n)}t.forEach(i=>i.layer.renderDeferred(e))}}class Ai extends ot{constructor(e,t){super(e),this.layer=t}}const Ba={LAYERS:"layers"};class Xn extends mh{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Ba.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new Te(i.slice(),{unique:!0}):he(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new Te(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(me),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(re(e,Ae.ADD,this.handleLayersAdd_,this),re(e,Ae.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(me);pn(this.listenerKeys_);const t=e.getArray();for(let i=0,n=t.length;i<n;i++){const r=t[i];this.registerLayerListeners_(r),this.dispatchEvent(new Ai("addlayer",r))}this.changed()}registerLayerListeners_(e){const t=[re(e,Wi.PROPERTYCHANGE,this.handleLayerChange_,this),re(e,q.CHANGE,this.handleLayerChange_,this)];e instanceof Xn&&t.push(re(e,"addlayer",this.handleLayerGroupAdd_,this),re(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[se(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Ai("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Ai("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Ai("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=se(t);this.listenerKeys_[i].forEach(me),delete this.listenerKeys_[i],this.dispatchEvent(new Ai("removelayer",t)),this.changed()}getLayers(){return this.get(Ba.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let n=0,r=i.length;n<r;++n)this.dispatchEvent(new Ai("removelayer",i[n]))}this.set(Ba.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const n=this.getLayerState();let r=n.zIndex;!e&&n.zIndex===void 0&&(r=0);for(let o=i,a=t.length;o<a;o++){const l=t[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),n.extent!==void 0&&(l.extent!==void 0?l.extent=Hi(l.extent,n.extent):l.extent=n.extent),l.zIndex===void 0&&(l.zIndex=r)}return t}getSourceState(){return"ready"}}const Fi={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class K_ extends ss{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=re(i,Fi.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=re(i,Fi.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(q.TOUCHMOVE,this.boundHandleTouchMove_,lh?{passive:!1}:!1)}emulateClick_(e){let t=new oi(le.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new oi(le.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new oi(le.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==le.POINTERUP||t.type==le.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==t.target){delete this.trackedTouches_[n];break}}else(t.type==le.POINTERDOWN||t.type==le.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new oi(le.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(me),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new oi(le.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(re(i,le.POINTERMOVE,this.handlePointerMove_,this),re(i,le.POINTERUP,this.handlePointerUp_,this),re(this.element_,le.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(re(this.element_.getRootNode(),le.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new oi(le.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new oi(le.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(me(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(q.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(me(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(me),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Me={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},jr=1/0;class q_{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,pn(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(e){he(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=jr?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,n=t.length,r=t[e],o=i[e],a=e;for(;e<n>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),u=h<n&&i[h]<i[l]?h:l;t[e]=t[u],i[e]=i[u],e=u}t[e]=r,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,n=this.priorities_,r=i[t],o=n[t];for(;t>e;){const a=this.getParentIndex_(t);if(n[a]>o)i[t]=i[a],n[t]=n[a],t=a;else break}i[t]=r,n[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let n=0;const r=t.length;let o,a,l;for(a=0;a<r;++a)o=t[a],l=e(o),l==jr?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=l,t[n++]=o);t.length=n,i.length=n,this.heapify_()}}class $_ extends q_{constructor(e,t){super(function(i){return e.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(q.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===J.LOADED||i===J.ERROR||i===J.EMPTY){i!==J.ERROR&&t.removeEventListener(q.CHANGE,this.boundHandleTileChange_);const n=t.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0,n,r,o;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;)r=this.dequeue()[0],o=r.getKey(),n=r.getState(),n===J.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,r.load())}}function J_(s,e,t,i,n){if(!s||!(t in s.wantedTiles)||!s.wantedTiles[t][e.getKey()])return jr;const r=s.viewState.center,o=i[0]-r[0],a=i[1]-r[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}class yt extends At{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){xr(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&xr(this.element);for(let t=0,i=this.listenerKeys.length;t<i;++t)me(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==mn&&this.listenerKeys.push(re(e,$t.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class Q_ extends yt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",n=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"âº",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(q.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+Si+" "+Fn+(this.collapsed_&&this.collapsible_?" "+Tr:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=h,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(n=>n.getAttributions(e)))),i=!this.getMap().getAllLayers().some(n=>n.getSource()&&n.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!ti(t,this.renderedAttributions_)){bh(this.ulElement_);for(let n=0,r=t.length;n<r;++n){const o=document.createElement("li");o.innerHTML=t[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Tr),this.collapsed_?An(this.collapseLabel_,this.label_):An(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class em extends yt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"â§",n=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(q.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+Si+" "+Fn,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(wr)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:ji}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(wr);!r&&i===0?this.element.classList.add(wr):r&&i!==0&&this.element.classList.remove(wr)}this.label_.style.transform=n}this.rotation_=i}}class Lc extends yt{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,n=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"â",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=n,u.setAttribute("type","button"),u.title=l,u.appendChild(typeof o=="string"?document.createTextNode(o):o),u.addEventListener(q.CLICK,this.handleClick_.bind(this,i),!1);const f=document.createElement("button");f.className=r,f.setAttribute("type","button"),f.title=h,f.appendChild(typeof a=="string"?document.createTextNode(a):a),f.addEventListener(q.CLICK,this.handleClick_.bind(this,-i),!1);const g=t+" "+Si+" "+Fn,_=this.element;_.className=g,_.appendChild(u),_.appendChild(f),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(n!==void 0){const r=i.getConstrainedZoom(n+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:ji})):i.setZoom(r)}}}function tm(s){s=s||{};const e=new Te;return(s.zoom!==void 0?s.zoom:!0)&&e.push(new Lc(s.zoomOptions)),(s.rotate!==void 0?s.rotate:!0)&&e.push(new em(s.rotateOptions)),(s.attribution!==void 0?s.attribution:!0)&&e.push(new Q_(s.attributionOptions)),e}function bc(s){if(s instanceof ws){s.setMapInternal(null);return}s instanceof Xn&&s.getLayers().forEach(bc)}function Mc(s,e){if(s instanceof ws){s.setMapInternal(e);return}if(s instanceof Xn){const t=s.getLayers().getArray();for(let i=0,n=t.length;i<n;++i)Mc(t[i],e)}}let Pc=class extends At{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=im(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:oh,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Nt(),this.pixelToCoordinateTransform_=Nt(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||tm(),this.interactions=t.interactions||Rc({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new $_(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Me.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Me.VIEW,this.handleViewChanged_),this.addChangeListener(Me.SIZE,this.handleSizeChanged_),this.addChangeListener(Me.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof wt)&&e.view.then(function(n){i.setView(new wt(n))}),this.controls.addEventListener(Ae.ADD,n=>{n.element.setMap(this)}),this.controls.addEventListener(Ae.REMOVE,n=>{n.element.setMap(null)}),this.interactions.addEventListener(Ae.ADD,n=>{n.element.setMap(this)}),this.interactions.addEventListener(Ae.REMOVE,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(Ae.ADD,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(Ae.REMOVE,n=>{const r=n.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){Mc(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:jt,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,r,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(n){i.push(n)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(n){n instanceof Xn?t(n.getLayers()):e.push(n)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const n=t.layerFilter!==void 0?t.layerFilter:jt,r=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,o,n,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),n=this.getSize(),r=i.width/n[0],o=i.height/n[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-i.left)/r,(a.clientY-i.top)/o]}getTarget(){return this.get(Me.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Ln(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?Oe(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Me.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof Te){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=we(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?Oe(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Me.SIZE)}getView(){return this.get(Me.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,n){return J_(this.frameState_,e,t,i,n)}handleBrowserEvent(e,t){t=t||e.type;const i=new oi(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===Fi.POINTERDOWN||i===q.WHEEL||i===q.KEYDOWN){const n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(r===n?n.documentElement:r).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const n=this.getInteractions().getArray().slice();for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,r=n;if(e){const o=e.viewHints;if(o[We.ANIMATING]||o[We.INTERACTING]){const a=Date.now()-e.time>8;n=a?0:8,r=a?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(xt.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(xt.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new bn($t.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new bn($t.LOADSTART,this,e))));const i=this.postRenderFunctions_;for(let n=0,r=i.length;n<r;++n)i[n](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,n=this.targetChangeHandlerKeys_.length;i<n;++i)me(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(q.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(q.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,xr(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Z_(this)),this.mapBrowserEventHandler_=new K_(this,this.moveTolerance_);for(const r in le)this.mapBrowserEventHandler_.addEventListener(le[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(q.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(q.WHEEL,this.boundHandleBrowserEvent_,lh?{passive:!1}:!1);const i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[re(i,q.KEYDOWN,this.handleBrowserEvent,this),re(i,q.KEYPRESS,this.handleBrowserEvent,this)];const n=t.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(me(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(me(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=re(e,Wi.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=re(e,q.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(me),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Ai("addlayer",e)),this.layerGroupPropertyListenerKeys_=[re(e,Wi.PROPERTYCHANGE,this.render,this),re(e,q.CHANGE,this.render,this),re(e,"addlayer",this.handleLayerAdd_,this),re(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){bc(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),n=this.frameState_;let r=null;if(t!==void 0&&xh(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:ir(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:se(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=ir(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!Rn(this.previousExtent_)&&!Ui(r.extent,this.previousExtent_))&&(this.dispatchEvent(new bn($t.MOVESTART,this,n)),this.previousExtent_=cs(this.previousExtent_)),this.previousExtent_&&!r.viewHints[We.ANIMATING]&&!r.viewHints[We.INTERACTING]&&!Ui(r.extent,this.previousExtent_)&&(this.dispatchEvent(new bn($t.MOVEEND,this,r)),Fl(r.extent,this.previousExtent_))),this.dispatchEvent(new bn($t.POSTRENDER,this,r)),this.renderComplete_=this.hasListener($t.LOADSTART)||this.hasListener($t.LOADEND)||this.hasListener(xt.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Ai("removelayer",t)),this.set(Me.LAYERGROUP,e)}setSize(e){this.set(Me.SIZE,e)}setTarget(e){this.set(Me.TARGET,e)}setView(e){if(!e||e instanceof wt){this.set(Me.VIEW,e);return}this.set(Me.VIEW,new wt);const t=this;e.then(function(i){t.setView(new wt(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const n=getComputedStyle(e),r=e.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),o=e.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(t=[r,o],!xh(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&zl("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!ti(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function im(s){let e=null;s.keyboardEventTarget!==void 0&&(e=typeof s.keyboardEventTarget=="string"?document.getElementById(s.keyboardEventTarget):s.keyboardEventTarget);const t={},i=s.layers&&typeof s.layers.getLayers=="function"?s.layers:new Xn({layers:s.layers});t[Me.LAYERGROUP]=i,t[Me.TARGET]=s.target,t[Me.VIEW]=s.view instanceof wt?s.view:new wt;let n;s.controls!==void 0&&(Array.isArray(s.controls)?n=new Te(s.controls.slice()):(he(typeof s.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),n=s.controls));let r;s.interactions!==void 0&&(Array.isArray(s.interactions)?r=new Te(s.interactions.slice()):(he(typeof s.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=s.interactions));let o;return s.overlays!==void 0?Array.isArray(s.overlays)?o=new Te(s.overlays.slice()):(he(typeof s.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=s.overlays):o=new Te,{controls:n,interactions:r,keyboardEventTarget:e,overlays:o,values:t}}const qe={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class nm extends At{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Jf,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(qe.ELEMENT,this.handleElementChanged),this.addChangeListener(qe.MAP,this.handleMapChanged),this.addChangeListener(qe.OFFSET,this.handleOffsetChanged),this.addChangeListener(qe.POSITION,this.handlePositionChanged),this.addChangeListener(qe.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(qe.ELEMENT)}getId(){return this.id}getMap(){return this.get(qe.MAP)||null}getOffset(){return this.get(qe.OFFSET)}getPosition(){return this.get(qe.POSITION)}getPositioning(){return this.get(qe.POSITIONING)}handleElementChanged(){bh(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(xr(this.element),me(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=re(e,$t.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(qe.ELEMENT,e)}setMap(e){this.set(qe.MAP,e)}setOffset(e){this.set(qe.OFFSET,e)}setPosition(e){this.set(qe.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(qe.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),r=this.getRect(n,[Xf(n),Yf(n)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!Ft(i,r)){const a=r[0]-i[0],l=i[2]-r[2],h=r[1]-i[1],u=i[3]-r[3],f=[0,0];if(a<0?f[0]=a-o:l<0&&(f[0]=Math.abs(l)+o),h<0?f[1]=h-o:u<0&&(f[1]=Math.abs(u)+o),f[0]!==0||f[1]!==0){const g=t.getView().getCenterInternal(),_=t.getPixelFromCoordinateInternal(g);if(!_)return;const p=[_[0]+f[0],_[1]+f[1]],y=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(p),duration:y.duration,easing:y.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),n=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[n,r,n+t[0],r+t[1]]}setPositioning(e){this.set(qe.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(e,t){const i=this.element.style,n=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+n[0])+"px",a=Math.round(e[1]+n[1])+"px";let l="0%",h="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?h="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(h="-50%");const u=`translate(${l}, ${h}) translate(${o}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,i.transform=u)}getOptions(){return this.options}}class sm{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return he(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return he(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){he(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function Ac(s,e,t,i){return i!==void 0?(i[0]=s,i[1]=e,i[2]=t,i):[s,e,t]}function Xr(s,e,t){return s+"/"+e+"/"+t}function Fc(s){return Xr(s[0],s[1],s[2])}function rm(s){return s.split("/").map(Number)}function om(s){return(s[1]<<s[0])+s[2]}function am(s,e){const t=s[0],i=s[1],n=s[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const r=e.getFullTileRange(t);return r?r.containsXY(i,n):!0}class Oc extends sm{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=rm(e)[0];this.forEach(n=>{n.tileCoord[0]!==i&&(this.remove(Fc(n.tileCoord)),n.release())})}}class ja{constructor(e,t,i,n){this.minX=e,this.maxX=t,this.minY=i,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Yn(s,e,t,i,n){return n!==void 0?(n.minX=s,n.maxX=e,n.minY=t,n.maxY=i,n):new ja(s,e,t,i)}const Nc=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],Dc={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class lm extends yt{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"â¤¢";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"Ã";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const n=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=n,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(q.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Si} ${Fn}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(kc(t))if(Gc(t))cm(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?hm(i):zc(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=Gc(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(An(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(Dc.ENTERFULLSCREEN)):(An(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(Dc.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(Me.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(Me.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,n=e.length;i<n;++i)me(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();kc(i)?this.element.classList.remove(Ah):this.element.classList.add(Ah);for(let n=0,r=Nc.length;n<r;++n)e.push(re(i,Nc[n],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function kc(s){const e=s.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&s.fullscreenEnabled)}function Gc(s){return!!(s.webkitIsFullScreen||s.fullscreenElement)}function zc(s){s.requestFullscreen?s.requestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()}function hm(s){s.webkitRequestFullscreen?s.webkitRequestFullscreen():zc(s)}function cm(s){s.exitFullscreen?s.exitFullscreen():s.webkitExitFullscreen&&s.webkitExitFullscreen()}const Xa=.75,Yr=.1;class Vc extends yt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",i=e.tipLabel!==void 0?e.tipLabel:"Overview map",n=e.collapseLabel!==void 0?e.collapseLabel:"â¹";typeof n=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n):this.collapseLabel_=n;const r=e.label!==void 0?e.label:"âº";typeof r=="string"?(this.label_=document.createElement("span"),this.label_.textContent=r):this.label_=r;const o=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=i,a.appendChild(o),a.addEventListener(q.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new Pc({view:e.view,controls:new Te,interactions:new Te});this.ovmap_=l,e.layers&&e.layers.forEach(function(C){l.addLayer(C)});const h=document.createElement("div");h.className="ol-overviewmap-box",h.style.boxSizing="border-box",this.boxOverlay_=new nm({position:[0,0],positioning:"center-center",element:h}),this.ovmap_.addOverlay(this.boxOverlay_);const u=t+" "+Si+" "+Fn+(this.collapsed_&&this.collapsible_?" "+Tr:"")+(this.collapsible_?"":" ol-uncollapsible"),f=this.element;f.className=u,f.appendChild(this.ovmapDiv_),f.appendChild(a);const g=this,_=this.boxOverlay_,p=this.boxOverlay_.getElement(),y=function(C){return{clientX:C.clientX,clientY:C.clientY}},E=function(C){const T=y(C),S=l.getEventCoordinateInternal(T);_.setPosition(S)},x=function(C){const T=l.getEventCoordinateInternal(C);g.getMap().getView().setCenterInternal(T),window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",x)};p.addEventListener("mousedown",function(){window.addEventListener("mousemove",E),window.addEventListener("mouseup",x)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const i=t.getView();i&&this.unbindView_(i),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(re(e,Wi.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const i=e.getView();i&&(this.bindView_(i),i.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===Me.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const i=this.getMap().getView();this.bindView_(i)}else!this.ovmap_.isRendered()&&(e.key===Me.TARGET||e.key===Me.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new wt({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(mt.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(mt.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),r=e.getView().calculateExtentInternal(i);if(this.viewExtent_&&Ui(r,this.viewExtent_))return;this.viewExtent_=r;const o=t.getSize(),l=t.getView().calculateExtentInternal(o),h=t.getPixelFromCoordinateInternal(Xt(r)),u=t.getPixelFromCoordinateInternal(Sn(r)),f=Math.abs(h[0]-u[0]),g=Math.abs(h[1]-u[1]),_=o[0],p=o[1];f<_*Yr||g<p*Yr||f>_*Xa||g>p*Xa?this.resetExtent_():Ft(l,r)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,i=e.getSize(),r=e.getView().calculateExtentInternal(i),o=t.getView(),a=Math.log(Xa/Yr)/Math.LN2,l=1/(Math.pow(2,a/2)*Yr);vd(r,l),o.fitInternal($i(r))}recenter_(){const e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),n=e.getView(),r=t.getView(),o=this.rotateWithView_?0:-n.getRotation(),a=this.boxOverlay_,l=this.boxOverlay_.getElement(),h=n.getCenterInternal(),u=n.getResolution(),f=r.getResolution(),g=i[0]*u/f,_=i[1]*u/f;if(a.setPosition(h),l){l.style.width=g+"px",l.style.height=_+"px";const p="rotate("+o+"rad)";l.style.transform=p}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=rs(this.ovmap_,$t.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Tr),this.collapsed_?An(this.collapseLabel_,this.label_):An(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}}const Us={VERTICAL:0,HORIZONTAL:1};class um extends yt{constructor(e){e=e||{},super({target:e.target,element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=Us.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=e.duration!==void 0?e.duration:200;const t=e.className!==void 0?e.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=t+"-thumb "+Si;const n=this.element;n.className=t+" "+Si+" "+Fn,n.appendChild(i),n.addEventListener(Fi.POINTERDOWN,this.handleDraggerStart_.bind(this),!1),n.addEventListener(Fi.POINTERMOVE,this.handleDraggerDrag_.bind(this),!1),n.addEventListener(Fi.POINTERUP,this.handleDraggerEnd_.bind(this),!1),n.addEventListener(q.CLICK,this.handleContainerClick_.bind(this),!1),i.addEventListener(q.CLICK,$u,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,i=e.offsetHeight;if(t===0&&i===0)return this.sliderInitialized_=!1;const n=getComputedStyle(e);t-=parseFloat(n.paddingRight)+parseFloat(n.paddingLeft),i-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom);const r=e.firstElementChild,o=getComputedStyle(r),a=r.offsetWidth+parseFloat(o.marginRight)+parseFloat(o.marginLeft),l=r.offsetHeight+parseFloat(o.marginTop)+parseFloat(o.marginBottom);return this.thumbSize_=[a,l],t>i?(this.direction_=Us.HORIZONTAL,this.widthLimit_=t-a):(this.direction_=Us.VERTICAL,this.heightLimit_=i-l),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),i=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),n=this.getResolutionForPosition_(i),r=t.getConstrainedZoom(t.getZoomForResolution(n));t.animateInternal({zoom:r,duration:this.duration_,easing:ji})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){const i=this.handleDraggerDrag_,n=this.handleDraggerEnd_,r=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(re(r,Fi.POINTERMOVE,i,this),re(r,Fi.POINTERUP,n,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,i=e.clientY-this.startY_,n=this.getRelativePosition_(t,i);this.currentResolution_=this.getResolutionForPosition_(n),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(me),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),i=this.element.firstElementChild;this.direction_==Us.HORIZONTAL?i.style.left=this.widthLimit_*t+"px":i.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let i;return this.direction_===Us.HORIZONTAL?i=e/this.widthLimit_:i=t/this.heightLimit_,Re(i,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){const t=this.getMap().getView().getValueForResolutionFunction();return Re(1-t(e),0,1)}render(e){if(!e.frameState||!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}}class dm extends ws{constructor(e){e=e||{},super(e)}}class fm extends ba{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,n=e.viewState,r=n.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=Hi(l,Yt(t.extent,n.projection))),!a[We.ANIMATING]&&!a[We.INTERACTING]&&!Rn(l))if(o){const h=n.projection,u=o.getImage(l,r,i,h);u&&(this.loadImage(u)?this.image_=u:u.getState()===H.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=Oe(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!ii(r,n))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=fe(o),h=Math.floor(a.width*((n[0]-o[0])/l));if(h<0||h>=a.width)return null;const u=Ge(o),f=Math.floor(a.height*((o[3]-n[1])/u));return f<0||f>=a.height?null:this.getImageData(a,h,f)}renderFrame(e,t){const i=this.image_,n=i.getExtent(),r=i.getResolution(),[o,a]=Array.isArray(r)?r:[r,r],l=i.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],u=e.pixelRatio,f=e.viewState,g=f.center,_=f.resolution,p=u*o/(_*l),y=u*a/(_*l),E=e.extent,x=f.resolution,C=f.rotation,T=Math.round(fe(E)/x*u),S=Math.round(Ge(E)/x*u);Dt(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/u,1/u,C,-T/2,-S/2),lr(this.inversePixelTransform,this.pixelTransform);const R=Do(this.pixelTransform);this.useContainer(t,R,this.getBackground(e));const b=this.getRenderContext(e),P=this.context.canvas;P.width!=T||P.height!=S?(P.width=T,P.height=S):this.containerReused||b.clearRect(0,0,T,S);let F=!1,I=!0;if(h.extent){const Y=Yt(h.extent,f.projection);I=ze(Y,e.extent),F=I&&!Ft(Y,e.extent),F&&this.clipUnrotated(b,e,Y)}const O=i.getImage(),X=Dt(this.tempTransform,T/2,S/2,p,y,0,l*(n[0]-g[0])/o,l*(g[1]-n[3])/a);this.renderedResolution=a*u/l;const Z=O.width*X[0],G=O.height*X[3];if(this.getLayer().getSource().getInterpolate()||(b.imageSmoothingEnabled=!1),this.preRender(b,e),I&&Z>=.5&&G>=.5){const Y=X[4],z=X[5],k=h.opacity;k!==1&&(b.save(),b.globalAlpha=k),b.drawImage(O,0,0,+O.width,+O.height,Y,z,Z,G),k!==1&&b.restore()}return this.postRender(this.context,e),F&&b.restore(),b.imageSmoothingEnabled=!0,R!==P.style.transform&&(P.style.transform=R),this.container}}class Wc extends dm{constructor(e){super(e)}createRenderer(){return new fm(this)}getData(e){return super.getData(e)}}const Bc=.5,gm=10,jc=.25;class Xc{constructor(e,t,i,n,r,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=ar(this.targetProj_,this.sourceProj_);this.transformInv_=function(C){const T=C[0]+"/"+C[1];return a[T]||(a[T]=l(C)),a[T]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&fe(n)>=fe(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?fe(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?fe(this.targetProj_.getExtent()):null;const h=Xt(i),u=gs(i),f=Sn(i),g=Tn(i),_=this.transformInv_(h),p=this.transformInv_(u),y=this.transformInv_(f),E=this.transformInv_(g),x=gm+(o?Math.max(0,Math.ceil(Math.log2(Io(i)/(o*o*256*256)))):0);if(this.addQuad_(h,u,f,g,_,p,y,E,x),this.wrapsXInSource_){let C=1/0;this.triangles_.forEach(function(T,S,R){C=Math.min(C,T.source[0][0],T.source[1][0],T.source[2][0])}),this.triangles_.forEach(T=>{if(Math.max(T.source[0][0],T.source[1][0],T.source[2][0])-C>this.sourceWorldWidth_/2){const S=[[T.source[0][0],T.source[0][1]],[T.source[1][0],T.source[1][1]],[T.source[2][0],T.source[2][1]]];S[0][0]-C>this.sourceWorldWidth_/2&&(S[0][0]-=this.sourceWorldWidth_),S[1][0]-C>this.sourceWorldWidth_/2&&(S[1][0]-=this.sourceWorldWidth_),S[2][0]-C>this.sourceWorldWidth_/2&&(S[2][0]-=this.sourceWorldWidth_);const R=Math.min(S[0][0],S[1][0],S[2][0]);Math.max(S[0][0],S[1][0],S[2][0])-R<this.sourceWorldWidth_/2&&(T.source=S)}})}a={}}addTriangle_(e,t,i,n,r,o){this.triangles_.push({source:[n,r,o],target:[e,t,i]})}addQuad_(e,t,i,n,r,o,a,l,h){const u=at([r,o,a,l]),f=this.sourceWorldWidth_?fe(u)/this.sourceWorldWidth_:null,g=this.sourceWorldWidth_,_=this.sourceProj_.canWrapX()&&f>.5&&f<1;let p=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const E=at([e,t,i,n]);p=fe(E)/this.targetWorldWidth_>jc||p}!_&&this.sourceProj_.isGlobal()&&f&&(p=f>jc||p)}if(!p&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!ze(u,this.maxSourceExtent_))return;let y=0;if(!p&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)p=!0;else if(y=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),y!=1&&y!=2&&y!=4&&y!=8)return}if(h>0){if(!p){const E=[(e[0]+i[0])/2,(e[1]+i[1])/2],x=this.transformInv_(E);let C;_?C=(Zi(r[0],g)+Zi(a[0],g))/2-Zi(x[0],g):C=(r[0]+a[0])/2-x[0];const T=(r[1]+a[1])/2-x[1];p=C*C+T*T>this.errorThresholdSquared_}if(p){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const E=[(t[0]+i[0])/2,(t[1]+i[1])/2],x=this.transformInv_(E),C=[(n[0]+e[0])/2,(n[1]+e[1])/2],T=this.transformInv_(C);this.addQuad_(e,t,E,C,r,o,x,T,h-1),this.addQuad_(C,E,i,n,T,x,a,l,h-1)}else{const E=[(e[0]+t[0])/2,(e[1]+t[1])/2],x=this.transformInv_(E),C=[(i[0]+n[0])/2,(i[1]+n[1])/2],T=this.transformInv_(C);this.addQuad_(e,E,C,n,r,x,T,l,h-1),this.addQuad_(E,t,i,C,x,o,a,T,h-1)}return}}if(_){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}y&11||this.addTriangle_(e,i,n,r,a,l),y&14||this.addTriangle_(e,i,t,r,a,o),y&&(y&13||this.addTriangle_(t,n,e,o,l,r),y&7||this.addTriangle_(t,n,i,o,l,a))}calculateSourceExtent(){const e=lt();return this.triangles_.forEach(function(t,i,n){const r=t.source;fs(e,r[0]),fs(e,r[1]),fs(e,r[2])}),e}getTriangles(){return this.triangles_}}let Ya;const Un=[];function Yc(s,e,t,i,n){s.beginPath(),s.moveTo(0,0),s.lineTo(e,t),s.lineTo(i,n),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(e,i)+1,Math.max(t,n)),s.restore()}function Ua(s,e){return Math.abs(s[e*4]-210)>2||Math.abs(s[e*4+3]-.75*255)>2}function _m(){if(Ya===void 0){const s=Be(6,6,Un);s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",Yc(s,4,5,4,0),Yc(s,4,5,0,5);const e=s.getImageData(0,0,3,3).data;Ya=Ua(e,0)||Ua(e,4)||Ua(e,8),Cr(s),Un.push(s.canvas)}return Ya}function Ha(s,e,t,i){const n=Od(t,e,s);let r=Wl(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const a=s.getMetersPerUnit();a!==void 0&&(r/=a);const l=s.getExtent();if(!l||ii(l,n)){const h=Wl(s,r,n)/r;isFinite(h)&&h>0&&(r/=h)}return r}function mm(s,e,t,i){const n=Ue(t);let r=Ha(s,e,n,i);return(!isFinite(r)||r<=0)&&Ro(t,function(o){return r=Ha(s,e,o,i),isFinite(r)&&r>0}),r}function Uc(s,e,t,i,n,r,o,a,l,h,u,f,g,_){const p=Be(Math.round(t*s),Math.round(t*e),Un);if(f||(p.imageSmoothingEnabled=!1),l.length===0)return p.canvas;p.scale(t,t);function y(R){return Math.round(R*t)/t}p.globalCompositeOperation="lighter";const E=lt();l.forEach(function(R,b,P){ds(E,R.extent)});let x;const C=t/i,T=(f?1:1+Math.pow(2,-24))/C;(!g||l.length!==1||h!==0)&&(x=Be(Math.round(fe(E)*C),Math.round(Ge(E)*C),Un),f||(x.imageSmoothingEnabled=!1),l.forEach(function(R,b,P){const F=(R.extent[0]-E[0])*C,I=-(R.extent[3]-E[3])*C,O=fe(R.extent)*C,X=Ge(R.extent)*C;R.image.width>0&&R.image.height>0&&x.drawImage(R.image,h,h,R.image.width-2*h,R.image.height-2*h,f?F:Math.round(F),f?I:Math.round(I),f?O:Math.round(F+O)-Math.round(F),f?X:Math.round(I+X)-Math.round(I))}));const S=Xt(o);return a.getTriangles().forEach(function(R,b,P){const F=R.source,I=R.target;let O=F[0][0],X=F[0][1],Z=F[1][0],G=F[1][1],Y=F[2][0],z=F[2][1];const k=y((I[0][0]-S[0])/r),B=y(-(I[0][1]-S[1])/r),U=y((I[1][0]-S[0])/r),ie=y(-(I[1][1]-S[1])/r),ee=y((I[2][0]-S[0])/r),ne=y(-(I[2][1]-S[1])/r),Q=O,ae=X;O=0,X=0,Z-=Q,G-=ae,Y-=Q,z-=ae;const D=[[Z,G,0,0,U-k],[Y,z,0,0,ee-k],[0,0,Z,G,ie-B],[0,0,Y,z,ne-B]],ye=wd(D);if(!ye)return;if(p.save(),p.beginPath(),_m()||!f){p.moveTo(U,ie);const Ie=4,$e=k-U,vt=B-ie;for(let Je=0;Je<Ie;Je++)p.lineTo(U+y((Je+1)*$e/Ie),ie+y(Je*vt/(Ie-1))),Je!=Ie-1&&p.lineTo(U+y((Je+1)*$e/Ie),ie+y((Je+1)*vt/(Ie-1)));p.lineTo(ee,ne)}else p.moveTo(U,ie),p.lineTo(k,B),p.lineTo(ee,ne);p.clip(),p.transform(ye[0],ye[2],ye[1],ye[3],k,B),p.translate(E[0]-Q,E[3]-ae);let Ye;if(x)Ye=x.canvas,p.scale(T,-T);else{const Ie=l[0],$e=Ie.extent;Ye=Ie.image,p.scale(fe($e)/Ye.width,-Ge($e)/Ye.height)}p.drawImage(Ye,0,0),p.restore()}),x&&(Cr(x),Un.push(x.canvas)),u&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,a.getTriangles().forEach(function(R,b,P){const F=R.target,I=(F[0][0]-S[0])/r,O=-(F[0][1]-S[1])/r,X=(F[1][0]-S[0])/r,Z=-(F[1][1]-S[1])/r,G=(F[2][0]-S[0])/r,Y=-(F[2][1]-S[1])/r;p.beginPath(),p.moveTo(X,Z),p.lineTo(I,O),p.lineTo(G,Y),p.closePath(),p.stroke()}),p.restore()),p.canvas}function Za(s){return Array.isArray(s)?Math.min(...s):s}class pm extends ya{constructor(e,t,i,n,r,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=t.getExtent();h&&t.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const u=h?Hi(i,h):i,f=Ue(u),g=Ha(e,t,f,n),_=Bc,p=new Xc(e,t,u,l,g*_,n),y=p.calculateSourceExtent(),E=Rn(y)?null:o(y,g,r),x=E?H.IDLE:H.EMPTY,C=E?E.getPixelRatio():1;super(i,n,C,x),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=p,this.targetResolution_=n,this.targetExtent_=i,this.sourceImage_=E,this.sourcePixelRatio_=C,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==H.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==H.LOADED){const t=fe(this.targetExtent_)/this.targetResolution_,i=Ge(this.targetExtent_)/this.targetResolution_;this.canvas_=Uc(t,i,this.sourcePixelRatio_,Za(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==H.IDLE){this.state=H.LOADING,this.changed();const e=this.sourceImage_.getState();e==H.LOADED||e==H.ERROR?this.reproject_():(this.sourceListenerKey_=re(this.sourceImage_,q.CHANGE,function(t){const i=this.sourceImage_.getState();(i==H.LOADED||i==H.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){me(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Ur=4,Ka={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class ym extends ot{constructor(e,t){super(e),this.image=t}}class vm extends Fa{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const i=Qs(t,e,0);e=t[i]}return e}getImage(e,t,i,n){const r=this.getProjection();if(!r||!n||Ei(r,n))return r&&(n=r),this.getImageInternal(e,t,i,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Ei(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&Ui(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new pm(r,n,e,t,i,(o,a,l)=>this.getImageInternal(o,a,l,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,n){if(this.loader){const r=Cm(e,t,i,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&Ft(this.wantedExtent_,r)||Ft(this.image.getExtent(),r))&&(this.wantedResolution_&&Za(this.wantedResolution_)===o||Za(this.image.getResolution())===o)))return this.image;this.wantedProjection_=n,this.wantedExtent_=r,this.wantedResolution_=o,this.image=new ya(r,o,i,this.loader),this.image.addEventListener(q.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case H.LOADING:this.loading=!0,i=Ka.IMAGELOADSTART;break;case H.LOADED:this.loading=!1,i=Ka.IMAGELOADEND;break;case H.ERROR:this.loading=!1,i=Ka.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new ym(i,t))}}function Em(s,e){s.getImage().src=e}function Cm(s,e,t,i){const n=e/t,r=Ue(s),o=vi(fe(s)/n,Ur),a=vi(Ge(s)/n,Ur),l=vi((i-1)*o/2,Ur),h=o+2*l,u=vi((i-1)*a/2,Ur),f=a+2*u;return ir(r,n,0,[h,f])}function xm(s){const e=s.load||Ph,t=s.imageExtent,i=new Image;return s.crossOrigin!==null&&(i.crossOrigin=s.crossOrigin),()=>e(i,s.url).then(n=>{const r=fe(t)/n.width,o=Ge(t)/n.height;return{image:n,extent:t,resolution:r!==o?[r,o]:o,pixelRatio:1}})}class wm extends vm{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:Em;super({attributions:e.attributions,interpolate:e.interpolate,projection:ht(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new ya(this.imageExtent_,void 0,1,xm({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(n,r)=>(this.image.setImage(n),i(this.image,r),Ph(n))})),this.image.addEventListener(q.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,i,n){return ze(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const Fe={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},sn={};sn[Fe.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}},sn[Fe.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}},sn[Fe.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}},sn.none={none:{supports:[],formats:[],qualities:[]}};const Tm=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,Hc=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Sm=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function Rm(s){let e=s.getComplianceLevelSupportedFeatures();return e===void 0&&(e=sn[Fe.VERSION1].level0),{url:s.imageInfo["@id"]===void 0?void 0:s.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,s.imageInfo.formats===void 0?[]:s.imageInfo.formats],qualities:[...e.qualities,s.imageInfo.qualities===void 0?[]:s.imageInfo.qualities],resolutions:s.imageInfo.scale_factors,tileSize:s.imageInfo.tile_width!==void 0?s.imageInfo.tile_height!==void 0?[s.imageInfo.tile_width,s.imageInfo.tile_height]:[s.imageInfo.tile_width,s.imageInfo.tile_width]:s.imageInfo.tile_height!=null?[s.imageInfo.tile_height,s.imageInfo.tile_height]:void 0}}function Im(s){const e=s.getComplianceLevelSupportedFeatures(),t=Array.isArray(s.imageInfo.profile)&&s.imageInfo.profile.length>1,i=t&&s.imageInfo.profile[1].supports?s.imageInfo.profile[1].supports:[],n=t&&s.imageInfo.profile[1].formats?s.imageInfo.profile[1].formats:[],r=t&&s.imageInfo.profile[1].qualities?s.imageInfo.profile[1].qualities:[];return{url:s.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:s.imageInfo.sizes===void 0?void 0:s.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:s.imageInfo.tiles===void 0?void 0:[s.imageInfo.tiles.map(function(o){return o.width})[0],s.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:s.imageInfo.tiles===void 0?void 0:s.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...e.supports,...i],formats:[...e.formats,...n],qualities:[...e.qualities,...r]}}function Lm(s){const e=s.getComplianceLevelSupportedFeatures(),t=s.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...s.imageInfo.extraFormats],i=s.imageInfo.preferredFormats!==void 0&&Array.isArray(s.imageInfo.preferredFormats)&&s.imageInfo.preferredFormats.length>0?s.imageInfo.preferredFormats.filter(function(n){return["jpg","png","gif"].includes(n)}).reduce(function(n,r){return n===void 0&&t.includes(r)?r:n},void 0):void 0;return{url:s.imageInfo.id,sizes:s.imageInfo.sizes===void 0?void 0:s.imageInfo.sizes.map(function(n){return[n.width,n.height]}),tileSize:s.imageInfo.tiles===void 0?void 0:[s.imageInfo.tiles.map(function(n){return n.width})[0],s.imageInfo.tiles.map(function(n){return n.height})[0]],resolutions:s.imageInfo.tiles===void 0?void 0:s.imageInfo.tiles.map(function(n){return n.scaleFactors})[0],supports:s.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...s.imageInfo.extraFeatures],formats:t,qualities:s.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...s.imageInfo.extraQualities],preferredFormat:i}}const Hr={};Hr[Fe.VERSION1]=Rm,Hr[Fe.VERSION2]=Im,Hr[Fe.VERSION3]=Lm;class bm{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return Fe.VERSION1;case"http://iiif.io/api/image/2/context.json":return Fe.VERSION2;case"http://iiif.io/api/image/3/context.json":return Fe.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(Fe.VERSION1)&&this.imageInfo.identifier)return Fe.VERSION1;break}he(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case Fe.VERSION1:if(Tm.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Fe.VERSION3:if(Sm.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Fe.VERSION2:if(typeof this.imageInfo.profile=="string"&&Hc.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&Hc.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const i=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(i)?i[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?sn.none.none:sn[e][t]}getTileSourceOptions(e){const t=e||{},i=this.getImageApiVersion();if(i===void 0)return;const n=i===void 0?void 0:Hr[i](this);if(n!==void 0)return{url:n.url,version:i,size:[this.imageInfo.width,this.imageInfo.height],sizes:n.sizes,format:t.format!==void 0&&n.formats.includes(t.format)?t.format:n.preferredFormat!==void 0?n.preferredFormat:"jpg",supports:n.supports,quality:t.quality&&n.qualities.includes(t.quality)?t.quality:n.qualities.includes("native")?"native":"default",resolutions:Array.isArray(n.resolutions)?n.resolutions.sort(function(r,o){return o-r}):void 0,tileSize:n.tileSize}}}class qa extends Ic{constructor(e,t,i,n,r,o,a,l,h,u,f,g){super(r,J.IDLE,g),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const _=n.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent();let y=this.sourceTileGrid_.getExtent();const E=p?Hi(_,p):_;if(Io(E)===0){this.state=J.EMPTY;return}const x=e.getExtent();x&&(y?y=Hi(y,x):y=x);const C=n.getResolution(this.wrappedTileCoord_[0]),T=mm(e,i,E,C);if(!isFinite(T)||T<=0){this.state=J.EMPTY;return}const S=u!==void 0?u:Bc;if(this.triangulation_=new Xc(e,i,E,y,T*S,C),this.triangulation_.getTriangles().length===0){this.state=J.EMPTY;return}this.sourceZ_=t.getZForResolution(T);let R=this.triangulation_.calculateSourceExtent();if(y&&(e.canWrapX()?(R[1]=Re(R[1],y[1],y[3]),R[3]=Re(R[3],y[1],y[3])):R=Hi(R,y)),!Io(R))this.state=J.EMPTY;else{const b=t.getTileRangeForExtentAndZ(R,this.sourceZ_);for(let P=b.minX;P<=b.maxX;P++)for(let F=b.minY;F<=b.maxY;F++){const I=h(this.sourceZ_,P,F,a);I&&this.sourceTiles_.push(I)}this.sourceTiles_.length===0&&(this.state=J.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==J.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=J.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Uc(n,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=J.LOADED}this.changed()}load(){if(this.state==J.IDLE){this.state=J.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==J.IDLE||i==J.LOADING){e++;const n=re(t,q.CHANGE,function(r){const o=t.getState();(o==J.LOADED||o==J.ERROR||o==J.EMPTY)&&(me(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,n){t.getState()==J.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(me),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Cr(this.canvas_.getContext("2d")),Un.push(this.canvas_),this.canvas_=null),super.release()}}const $a={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Hn=[0,0,0],Oi=5;class Zc{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,he(ed(this.resolutions_,(n,r)=>r-n),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let n=0,r=this.resolutions_.length-1;n<r;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,he(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Xt(i)),he(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,he(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:xs,he(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((n,r)=>{const o=new ja(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let r=n.minX,o=n.maxX;r<=o;++r)for(let a=n.minY,l=n.maxY;a<=l;++a)i([t,r,a])}forEachTileCoordParentTileRange(e,t,i,n){let r,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,n);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=Yn(o,o,a,a,i)):r=this.getTileRangeForExtentAndZ(l,h,i),t(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return Yn(r,r+1,o,o+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],r=e[1],o=e[2];if(t===n)return Yn(r,o,r,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-n),h=Math.floor(r*l),u=Math.floor(o*l);if(t<n)return Yn(h,h,u,u,i);const f=Math.floor(l*(r+1))-1,g=Math.floor(l*(o+1))-1;return Yn(h,f,u,g,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,Hn);const n=Hn[1],r=Hn[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,Hn);const o=Hn[1],a=Hn[2];return Yn(n,o,r,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=ct(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=ct(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*r[0]*n,a=i[1]-(e[2]+1)*r[1]*n,l=o+r[0]*n,h=a+r[1]*n;return ni(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,r){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=ct(this.getTileSize(o),this.tmpSize_);let u=a*(e-l[0])/i/h[0],f=a*(l[1]-t)/i/h[1];return n?(u=vi(u,Oi)-1,f=vi(f,Oi)-1):(u=rr(u,Oi),f=rr(f,Oi)),Ac(o,u,f,r)}getTileCoordForXYAndZ_(e,t,i,n,r){const o=this.getOrigin(i),a=this.getResolution(i),l=ct(this.getTileSize(i),this.tmpSize_);let h=(e-o[0])/a/l[0],u=(o[1]-t)/a/l[1];return n?(h=vi(h,Oi)-1,u=vi(u,Oi)-1):(h=rr(h,Oi),u=rr(u,Oi)),Ac(i,h,u,r)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=Qs(this.resolutions_,e,t||0);return Re(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return eh(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}function Kc(s){let e=s.getDefaultTileGrid();return e||(e=Fm(s),s.setDefaultTileGrid(e)),e}function Mm(s,e,t){const i=e[0],n=s.getTileCoordCenter(e),r=qc(t);if(!ii(r,n)){const o=fe(r),a=Math.ceil((r[0]-n[0])/o);return n[0]+=o*a,s.getTileCoordForCoordAndZ(n,i)}return e}function Pm(s,e,t,i){i=i!==void 0?i:"top-left";const n=Am(s,e,t);return new Zc({extent:s,origin:pd(s,i),resolutions:n,tileSize:t})}function Am(s,e,t,i){e=e!==void 0?e:Ef,t=ct(t!==void 0?t:xs);const n=Ge(s),r=fe(s);i=i>0?i:Math.max(r/t[0],n/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function Fm(s,e,t,i){const n=qc(s);return Pm(n,e,t,i)}function qc(s){s=ht(s);let e=s.getExtent();if(!e){const t=180*Co.degrees/s.getMetersPerUnit();e=ni(-t,-t,t,t)}return e}class Om extends Fa{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&ct(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new Oc(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,n){const r=this.getTileCacheForProjection(e);if(!r)return!1;let o=!0,a,l,h;for(let u=i.minX;u<=i.maxX;++u)for(let f=i.minY;f<=i.maxY;++f)l=Xr(t,u,f),h=!1,r.containsKey(l)&&(a=r.get(l),h=a.getState()===J.LOADED,h&&(h=n(a)!==!1)),h||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,r){return ue()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Kc(e)}getTileCacheForProjection(e){const t=this.getProjection();return he(t===null||Ei(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),r=this.getTilePixelRatio(t),o=ct(n.getTileSize(e),this.tmpSize);return r==1?o:Nf(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=Mm(i,e,t)),am(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,n){}}class Nm extends ot{constructor(e,t){super(e),this.tile=t}}function Dm(s,e){const t=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,r=/\{-y\}/g;return function(o,a,l){if(o)return s.replace(t,o[0].toString()).replace(i,o[1].toString()).replace(n,o[2].toString()).replace(r,function(){const h=o[0],u=e.getFullTileRange(h);if(!u)throw new Error("The {-y} placeholder requires a tile grid with extent");return(u.getHeight()-o[2]-1).toString()})}}function km(s,e){const t=s.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=Dm(s[n],e);return Gm(i)}function Gm(s){return s.length===1?s[0]:function(e,t,i){if(!e)return;const n=om(e),r=Zi(n,s.length);return s[r](e,t,i)}}function zm(s){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(s);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let r;for(r=i;r<=n;++r)e.push(s.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(s),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(s.replace(t[0],n.toString()));return e}return e.push(s),e}class Ja extends Om{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Ja.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=se(t),n=t.getState();let r;n==J.LOADING?(this.tileLoadingKeys_[i]=!0,r=$a.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=n==J.ERROR?$a.TILELOADERROR:n==J.LOADED?$a.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new Nm(r,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=zm(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(km(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const n=Xr(e,t,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}class Vm extends Ja{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Wm,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:Wa,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const n in this.tileCacheForProjection){const r=this.tileCacheForProjection[n];r.expireCache(r==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!Ei(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!Ei(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Ei(t,e)))return this.tileGrid;const i=se(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Kc(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||Ei(t,e))return this.tileCache;const i=se(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Oc(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,n,r,o){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,n,r):void 0,u=new this.tileClass(a,h!==void 0?J.IDLE:J.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(q.CHANGE,this.handleTileChange.bind(this)),u}getTile(e,t,i,n,r){const o=this.getProjection();if(!o||!r||Ei(o,r))return this.getTileInternal(e,t,i,n,o||r);const a=this.getTileCacheForProjection(r),l=[e,t,i];let h;const u=Fc(l);a.containsKey(u)&&(h=a.get(u));const f=this.getKey();if(h&&h.key==f)return h;const g=this.getTileGridForProjection(o),_=this.getTileGridForProjection(r),p=this.getTileCoordForTileUrlFunction(l,r),y=new qa(o,g,r,_,l,p,this.getTilePixelRatio(n),this.getGutter(),(E,x,C,T)=>this.getTileInternal(E,x,C,T,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return y.key=f,h?(y.interimTile=h,y.refreshInterimChain(),a.replace(u,y)):a.set(u,y),y}getTileInternal(e,t,i,n,r){let o=null;const a=Xr(e,t,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,i,n,r,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(e,t,i,n,r,l),h.getState()==J.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=ht(e);if(i){const n=se(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function Wm(s,e){s.getImage().src=e}class Bm extends Wa{constructor(e,t,i,n,r,o,a){super(t,i,n,r,o,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==J.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const i=Be(t[0],t[1]);return i.drawImage(e,0,0),this.zoomifyImage_=i.canvas,i.canvas}return e}}function Hs(s){return s.toLocaleString("en",{maximumFractionDigits:10})}class jm extends Vm{constructor(e){const t=e||{};let i=t.url||"";i=i+(i.lastIndexOf("/")===i.length-1||i===""?"":"/");const n=t.version||Fe.VERSION2,r=t.sizes||[],o=t.size;he(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],h=t.tileSize,u=t.tilePixelRatio||1,f=t.format||"jpg",g=t.quality||(t.version==Fe.VERSION1?"native":"default");let _=t.resolutions||[];const p=t.supports||[],y=t.extent||[0,-l,a,0],E=r!=null&&Array.isArray(r)&&r.length>0,x=h!==void 0&&(typeof h=="number"&&Number.isInteger(h)&&h>0||Array.isArray(h)&&h.length>0),C=p!=null&&Array.isArray(p)&&(p.includes("regionByPx")||p.includes("regionByPct"))&&(p.includes("sizeByWh")||p.includes("sizeByH")||p.includes("sizeByW")||p.includes("sizeByPct"));let T,S,R;if(_.sort(function(I,O){return O-I}),x||C)if(h!=null&&(typeof h=="number"&&Number.isInteger(h)&&h>0?(T=h,S=h):Array.isArray(h)&&h.length>0&&((h.length==1||h[1]==null&&Number.isInteger(h[0]))&&(T=h[0],S=h[0]),h.length==2&&(Number.isInteger(h[0])&&Number.isInteger(h[1])?(T=h[0],S=h[1]):h[0]==null&&Number.isInteger(h[1])&&(T=h[1],S=h[1])))),(T===void 0||S===void 0)&&(T=xs,S=xs),_.length==0){R=Math.max(Math.ceil(Math.log(a/T)/Math.LN2),Math.ceil(Math.log(l/S)/Math.LN2));for(let I=R;I>=0;I--)_.push(Math.pow(2,I))}else{const I=Math.max(..._);R=Math.round(Math.log(I)/Math.LN2)}else if(T=a,S=l,_=[],E){r.sort(function(O,X){return O[0]-X[0]}),R=-1;const I=[];for(let O=0;O<r.length;O++){const X=a/r[O][0];if(_.length>0&&_[_.length-1]==X){I.push(O);continue}_.push(X),R++}if(I.length>0)for(let O=0;O<I.length;O++)r.splice(I[O]-O,1)}else _.push(1),r.push([a,l]),R=0;const b=new Zc({tileSize:[T,S],extent:y,origin:Xt(y),resolutions:_}),P=function(I,O,X){let Z,G;const Y=I[0];if(Y>R)return;const z=I[1],k=I[2],B=_[Y];if(!(z===void 0||k===void 0||B===void 0||z<0||Math.ceil(a/B/T)<=z||k<0||Math.ceil(l/B/S)<=k)){if(C||x){const U=z*T*B,ie=k*S*B;let ee=T*B,ne=S*B,Q=T,ae=S;if(U+ee>a&&(ee=a-U),ie+ne>l&&(ne=l-ie),U+T*B>a&&(Q=Math.floor((a-U+B-1)/B)),ie+S*B>l&&(ae=Math.floor((l-ie+B-1)/B)),U==0&&ee==a&&ie==0&&ne==l)Z="full";else if(!C||p.includes("regionByPx"))Z=U+","+ie+","+ee+","+ne;else if(p.includes("regionByPct")){const D=Hs(U/a*100),ye=Hs(ie/l*100),Ye=Hs(ee/a*100),Ie=Hs(ne/l*100);Z="pct:"+D+","+ye+","+Ye+","+Ie}n==Fe.VERSION3&&(!C||p.includes("sizeByWh"))?G=Q+","+ae:!C||p.includes("sizeByW")?G=Q+",":p.includes("sizeByH")?G=","+ae:p.includes("sizeByWh")?G=Q+","+ae:p.includes("sizeByPct")&&(G="pct:"+Hs(100/B))}else if(Z="full",E){const U=r[Y][0],ie=r[Y][1];n==Fe.VERSION3?U==a&&ie==l?G="max":G=U+","+ie:U==a?G="full":G=U+","}else G=n==Fe.VERSION3?"max":"full";return i+Z+"/"+G+"/0/"+g+"."+f}},F=Bm.bind(null,ct(h||256).map(function(I){return I*u}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:F,tileGrid:b,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:P,transition:t.transition}),this.zDirection=t.zDirection}}const Zr={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Xm extends ws{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(Zr.PRELOAD)}setPreload(e){this.set(Zr.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Zr.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Zr.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class Ym extends ba{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=lt(),this.tmpTileRange_=new ja(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==J.LOADED||i==J.EMPTY||i==J.ERROR&&!n}getTile(e,t,i,n){const r=n.pixelRatio,o=n.viewState.projection,a=this.getLayer();let h=a.getSource().getTile(e,t,i,r,o);return h.getState()==J.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=Oe(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!ii(r,n))return null;const o=t.pixelRatio,a=t.viewState.projection,l=t.viewState,h=i.getRenderSource(),u=h.getTileGridForProjection(l.projection),f=h.getTilePixelRatio(t.pixelRatio);for(let g=u.getZForResolution(l.resolution);g>=u.getMinZoom();--g){const _=u.getTileCoordForCoordAndZ(n,g),p=h.getTile(g,_[1],_[2],o,a);if(!(p instanceof Wa||p instanceof qa)||p instanceof qa&&p.getState()===J.EMPTY)return null;if(p.getState()!==J.LOADED)continue;const y=u.getOrigin(g),E=ct(u.getTileSize(g)),x=u.getResolution(g),C=Math.floor(f*((n[0]-y[0])/x-_[1]*E[0])),T=Math.floor(f*((y[1]-n[1])/x-_[2]*E[1])),S=Math.round(f*h.getGutterForProjection(l.projection));return this.getImageData(p.getImage(),C+S,T+S)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],n=e.viewState,r=n.projection,o=n.resolution,a=n.center,l=n.rotation,h=e.pixelRatio,u=this.getLayer(),f=u.getSource(),g=f.getRevision(),_=f.getTileGridForProjection(r),p=_.getZForResolution(o,f.zDirection),y=_.getResolution(p);let E=e.extent;const x=e.viewState.resolution,C=f.getTilePixelRatio(h),T=Math.round(fe(E)/x*h),S=Math.round(Ge(E)/x*h),R=i.extent&&Yt(i.extent);R&&(E=Hi(E,Yt(i.extent)));const b=y*T/2/C,P=y*S/2/C,F=[a[0]-b,a[1]-P,a[0]+b,a[1]+P],I=_.getTileRangeForExtentAndZ(E,p),O={};O[p]={};const X=this.createLoadedTileFinder(f,r,O),Z=this.tmpExtent,G=this.tmpTileRange_;this.newTiles_=!1;const Y=l?Lo(n.center,x,l,e.size):void 0;for(let ae=I.minX;ae<=I.maxX;++ae)for(let D=I.minY;D<=I.maxY;++D){if(l&&!_.tileCoordIntersectsViewport([p,ae,D],Y))continue;const ye=this.getTile(p,ae,D,e);if(this.isDrawableTile(ye)){const $e=se(this);if(ye.getState()==J.LOADED){O[p][ye.tileCoord.toString()]=ye;let vt=ye.inTransition($e);vt&&i.opacity!==1&&(ye.endTransition($e),vt=!1),!this.newTiles_&&(vt||!this.renderedTiles.includes(ye))&&(this.newTiles_=!0)}if(ye.getAlpha($e,e.time)===1)continue}const Ye=_.getTileCoordChildTileRange(ye.tileCoord,G,Z);let Ie=!1;Ye&&(Ie=X(p+1,Ye)),Ie||_.forEachTileCoordParentTileRange(ye.tileCoord,X,G,Z)}const z=y/o*h/C;Dt(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/h,1/h,l,-T/2,-S/2);const k=Do(this.pixelTransform);this.useContainer(t,k,this.getBackground(e));const B=this.getRenderContext(e),U=this.context.canvas;lr(this.inversePixelTransform,this.pixelTransform),Dt(this.tempTransform,T/2,S/2,z,z,0,-T/2,-S/2),U.width!=T||U.height!=S?(U.width=T,U.height=S):this.containerReused||B.clearRect(0,0,T,S),R&&this.clipUnrotated(B,e,R),f.getInterpolate()||(B.imageSmoothingEnabled=!1),this.preRender(B,e),this.renderedTiles.length=0;let ie=Object.keys(O).map(Number);ie.sort(Bi);let ee,ne,Q;i.opacity===1&&(!this.containerReused||f.getOpaque(e.viewState.projection))?ie=ie.reverse():(ee=[],ne=[]);for(let ae=ie.length-1;ae>=0;--ae){const D=ie[ae],ye=f.getTilePixelSize(D,h,r),Ie=_.getResolution(D)/y,$e=ye[0]*Ie*z,vt=ye[1]*Ie*z,Je=_.getTileCoordForCoordAndZ(Xt(F),D),on=_.getTileCoordExtent(Je),Jt=Oe(this.tempTransform,[C*(on[0]-F[0])/y,C*(F[3]-on[3])/y]),Zn=C*f.getGutterForProjection(r),Kn=O[D];for(const qn in Kn){const Qe=Kn[qn],zt=Qe.tileCoord,Ni=Je[1]-zt[1],$n=Math.round(Jt[0]-(Ni-1)*$e),an=Je[2]-zt[2],Qt=Math.round(Jt[1]-(an-1)*vt),ce=Math.round(Jt[0]-Ni*$e),Ee=Math.round(Jt[1]-an*vt),Se=$n-ce,nt=Qt-Ee,_i=p===D,ei=_i&&Qe.getAlpha(se(this),e.time)!==1;let Lt=!1;if(!ei)if(ee){Q=[ce,Ee,ce+Se,Ee,ce+Se,Ee+nt,ce,Ee+nt];for(let Vt=0,ln=ee.length;Vt<ln;++Vt)if(p!==D&&D<ne[Vt]){const De=ee[Vt];ze([ce,Ee,ce+Se,Ee+nt],[De[0],De[3],De[4],De[7]])&&(Lt||(B.save(),Lt=!0),B.beginPath(),B.moveTo(Q[0],Q[1]),B.lineTo(Q[2],Q[3]),B.lineTo(Q[4],Q[5]),B.lineTo(Q[6],Q[7]),B.moveTo(De[6],De[7]),B.lineTo(De[4],De[5]),B.lineTo(De[2],De[3]),B.lineTo(De[0],De[1]),B.clip())}ee.push(Q),ne.push(D)}else B.clearRect(ce,Ee,Se,nt);this.drawTileImage(Qe,e,ce,Ee,Se,nt,Zn,_i),ee&&!ei?(Lt&&B.restore(),this.renderedTiles.unshift(Qe)):this.renderedTiles.push(Qe),this.updateUsedTiles(e.usedTiles,f,Qe)}}return this.renderedRevision=g,this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!Ui(this.renderedExtent_,F),this.renderedExtent_=F,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(e,f,_,h,r,E,p,u.getPreload()),this.scheduleExpireCache(e,f),this.postRender(this.context,e),i.extent&&B.restore(),B.imageSmoothingEnabled=!0,k!==U.style.transform&&(U.style.transform=k),this.container}drawTileImage(e,t,i,n,r,o,a,l){const h=this.getTileImage(e);if(!h)return;const u=this.getRenderContext(t),f=se(this),g=t.layerStatesArray[t.layerIndex],_=g.opacity*(l?e.getAlpha(f,t.time):1),p=_!==u.globalAlpha;p&&(u.save(),u.globalAlpha=_),u.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,n,r,o),p&&u.restore(),_!==g.opacity?t.animate=!0:l&&e.endTransition(f)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=(function(n,r,o){const a=se(n);a in o.usedTiles&&n.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const n=se(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}manageTilePyramid(e,t,i,n,r,o,a,l,h){const u=se(t);u in e.wantedTiles||(e.wantedTiles[u]={});const f=e.wantedTiles[u],g=e.tileQueue,_=i.getMinZoom(),p=e.viewState.rotation,y=p?Lo(e.viewState.center,e.viewState.resolution,p,e.size):void 0;let E=0,x,C,T,S,R,b;for(b=_;b<=a;++b)for(C=i.getTileRangeForExtentAndZ(o,b,C),T=i.getResolution(b),S=C.minX;S<=C.maxX;++S)for(R=C.minY;R<=C.maxY;++R)p&&!i.tileCoordIntersectsViewport([b,S,R],y)||(a-b<=l?(++E,x=t.getTile(b,S,R,n,r),x.getState()==J.IDLE&&(f[x.getKey()]=!0,g.isKeyQueued(x.getKey())||g.enqueue([x,u,i.getTileCoordCenter(x.tileCoord),T])),h!==void 0&&h(x)):t.useTile(b,S,R,r));t.updateCacheSize(E,r)}}class $c extends Xm{constructor(e){super(e)}createRenderer(){return new Ym(this)}}const _e={COLOR_DEFAULT:[160,0,0],FEATURE_TYPE_ANNO:"annotation",FEATURE_TYPE_CUSTOM:"custom",FEATURE_TYPE_LINE:"line",FEATURE_TYPE_SEARCH:"search",FEATURE_TYPE_ZONE:"zone",POSITION_DEFAULT:"center",POSITION_TOP:"top",POSITION_TOP_LEFT:"top-left",PROPERTY_WHEEL:"wheelMode",PROPERTY_ZONES:"showZones",MW_VERTICAL:"vertical",MW_ZOOM:"zoom",ZONES_SHOW_ALL:"always",ZONES_SHOW_DEFAULT:"default",ZONES_SHOW_NONE:"never",ZOOM_COVER:"cover",ZOOM_MIN:"min"};function Um(s){let e=s.slice(1,2),t=s.slice(2,3),i=s.slice(3,4);return e=parseInt(e+e,16),t=parseInt(t+t,16),i=parseInt(i+i,16),[e,t,i]}function Hm(s){if(s.length===4)return Um(s);const e=parseInt(s.slice(1,3),16),t=parseInt(s.slice(3,5),16),i=parseInt(s.slice(5,7),16);return[e,t,i]}class Jc{constructor(e){this.name=e.name,this.type=e.type,this.color=e.color?e.color:_e.COLOR_DEFAULT,this.features=e.features?e.features:[],this.display=e.display?e.display:"default",this.baseOpacity=e.baseOpacity?e.baseOpacity:0,this.hoverOpacity=e.hoverOpacity?e.hoverOpacity:.1}setMapLayer(e){this.mapLayer=e}getMapLayer(){return this.mapLayer}getName(){return this.name}getType(){return this.type}getColor(){return this.color}getFeatures(){return this.features}setColor(e){this.color=e,this.mapLayer.getSource().forEachFeature(i=>{i.setStyle(rn(this.display,e)),i.get("properties").color=e})}setDisplay(e){this.display=e,this.mapLayer.getSource().forEachFeature(i=>{i.setStyle(rn(e,i.get("properties").color))})}}const Kr=new it({stroke:new St({color:"rgba(0,0,0,0)",width:10}),fill:new Tt({color:"rgba(0,0,0,0)"})});function rn(s,e,t=0,i=1.25){return s==_e.ZONES_SHOW_ALL?qr(e,t):(s==_e.ZONES_SHOW_NONE||s==_e.ZONES_SHOW_DEFAULT||console.warn("Invalid display value: ",s),Kr)}function Qa(s,e,t=.1,i=1.75){return s==_e.ZONES_SHOW_ALL||s==_e.ZONES_SHOW_DEFAULT?qr(e,t,i):(s==_e.ZONES_SHOW_NONE||console.warn("Invalid display value: ",s),Kr)}function qr(s,e,t=1){return typeof s=="string"&&(s=Hm(s)),new it({stroke:new St({color:"rgb("+s[0]+", "+s[1]+", "+s[2]+")",width:t}),fill:new Tt({color:"rgb("+s[0]+", "+s[1]+", "+s[2]+", "+e+")"})})}function Zm(s,e,t,i,n){for(e=e.split?e.split("."):e,i=0;i<e.length;i++)s=s?s[e[i]]:n;return s===n?t:s}const Km=/{{(.*?)}}/g;function qm(s,e){return s.replace(Km,(t,i,n)=>{for(t=0,n=e,i=i.trim().split(".");n&&t<i.length;)n=n[i[t++]];return n??""})}function $m(s){var e="",t={};return{set(i,n){t[i]=Object.assign(t[i]||{},n)},locale(i){return e=i||e},table(i){return t[i]},t(i,n,r){var o=Zm(t[r||e],i,"");return typeof o=="function"?o(n):typeof o=="string"?qm(o,n):o}}}const el=$m(),Ne=el.t;Ne.learn=el.set,Ne.useLang=el.locale;const Jm="heiImageViewer:";function $r(s){return console[s].bind(console,Jm)}const tl={cdbg:$r("debug"),cerr:$r("error"),clog:$r("log"),cwarn:$r("warn")};tl.say=tl.log;const Qm=(s,e)=>{const t=s.features,i=s.type,n=s.name,r=e.extent_[2],o=s.color,a=new as({});Fd(e,a,function(h){return[h[0],-h[1]]},function(h){return[h[0],-h[1]]});let l=[];for(let h=0;h<t.length;h++){let u=ep(t[h],i,r,o,n);for(const f of u)f.getGeometry().transform(e,a),l.push(f)}return new Te(l)};function ep(s,e,t,i="#f00",n){let r={};const o=s.multiFeature?s.multiFeature:!1;r.featName=s.name,r.layerName=n,r.layerType=e,r.color=s.color?s.color:i;const a=s.shapes;let l=[],h=[];for(let g=0;g<a.length;g++){const _=a[g],p=_.format;let y=_.source,E;switch(p){case"svg":typeof y=="string"&&(y=cp(y)),[E,h]=ip(y,t);break;case"tei":E=tp(y);break;default:console.warn(`You are using an invalid format for your features to be drawn on canvas: "${p}"`);break}l.push(E)}let u=l.flat(),f=[];if(u.length>1)if(o){r.featureGeometry=new vs(u),r.featureType="collection";const g=il(r);f.push(g)}else for(let g=0;g<u.length;g++){r.featureGeometry=u[g],r.featureType=h[g],r.featName+="_"+g;const _=il(r);f.push(_)}else{r.featureGeometry=u[0],r.featureType=h[0];const g=il(r);f.push(g)}return f}function il(s){const e=new Pe({geometry:s.featureGeometry,properties:{kind:s.layerType,color:s.color,layerName:s.layerName,type:s.featureType,subfeatures:s.allTypesInThisFeature?s.allTypesInThisFeature:""}});return e.setId(s.featName),e}function tp(s,e=1){let t=Number(e),i=[nl(s,t)];return[new tt(i)]}function ip(s,e,t=1){let i=Number(t),n=s.children[0].children,r=[];const o=s.children[0].getAttribute("width"),a=e/o;let l=[];for(let h of n){let u=h.nodeName;r.push(u);let f;switch(u){case"rect":f=np(h,i);break;case"polygon":f=sp(h,i);break;case"line":f=rp(h,i);break;case"polyline":f=op(h,i);break;case"circle":f=ap(h,i);break;case"ellipse":f=lp(h,i);break;default:console.warn("Unknown svg primitive.");break}f.scale(a,a,[0,0]),l.push(f)}return[l,r]}function np(s,e){let t=Number(s.getAttribute("y"))/e,i=Number(s.getAttribute("x"))/e,n=Number(s.getAttribute("width"))/e,r=Number(s.getAttribute("height"))/e;return new tt([[[i,t],[i,t+r],[i+n,t+r],[i+n,t],[i,t]]])}function sp(s,e){let t=nl(s.getAttribute("points"),e);return new tt([t])}function rp(s,e){let t=Number(s.getAttribute("x1"))/e,i=Number(s.getAttribute("y1"))/e,n=Number(s.getAttribute("x2"))/e,r=Number(s.getAttribute("y2"))/e;return new kt([[t,i],[n,r]])}function op(s,e){let t=nl(s.getAttribute("points"),e);return new kt(t)}function ap(s,e){const t=Number(s.getAttribute("cx"))/e,i=Number(s.getAttribute("cy"))/e,n=Number(s.getAttribute("r"))/e,r=[t,i];return new Ji(r,n)}function lp(s,e=1){const t=Number(s.getAttribute("cx"))/e,i=Number(s.getAttribute("cy"))/e,n=[t,i],r=Number(s.getAttribute("rx"))/e,o=Number(s.getAttribute("ry"))/e,a=Math.sqrt(r*r+o*o),l=new Ji(n,a);let h=sh(l,64);return h.scale(r/a,o/a),h}function hp(s,e){const t=s[0],i=s[1],n=t[0]-i[0],r=t[1]-i[1],o=Math.sqrt(n*n+r*r),a=new Ji(t,o),l=sh(a,64);return l.scale(n/o,r/o),e?e.setCoordinates(l.getCoordinates()):e=l,e}function nl(s,e){let t=s.split(" ");const i=[];for(let n of t){let r=n.split(","),o=Number(r[0])/e,a=Number(r[1])/e;i.push([o,a])}return i}function cp(s){return new DOMParser().parseFromString(s,"text/xml")}const sl={Rectangle:{shortName:"rect",drawType:"Circle",geometryFunction:P_()},Polygon:{shortName:"polygon",drawType:"Polygon",geometryFunction:""},Circle:{shortName:"circle",drawType:"Circle",geometryFunction:""},Ellipse:{shortName:"ellipse",drawType:"Circle",geometryFunction:hp},Line:{shortName:"line",drawType:"LineString",geometryFunction:""}},{clog:up,cwarn:dp}=tl,Qc=Math.PI/2,eu=Math.PI*2;function tu(s,e){const t=document.createElement("button");s.element.appendChild(t);const i=e?"Right":"Left";t.className="ol-rotate-"+i.toLowerCase();const n="rotate"+i;t.innerHTML=gt[n],t.title=Ne(e?"rotateRight":"rotateLeft")+`
`+Ne("rotateFreely");const r=s.handleRotate.bind(s,e);t.addEventListener("click",r,!1)}class fp extends yt{constructor(e){const t=e||{},i=document.createElement("div");super({element:i,target:t.target}),i.className="ol-rotate-90 ol-unselectable ol-control",tu(this,!1),tu(this,!0)}handleRotate(e){const t=this.getMap().getView(),i=t.getRotation();var n=i;e?n=i+Qc:n=i-Qc;const r=Math.abs(n);r>eu&&(n=Math.sign(n)*(r-eu)),t.setRotation(n),Math.abs(n)>6.15&&document.getElementsByClassName("ol-rotate-reset")[0].click()}}class gp extends yt{constructor(e){const t=e||{},i=document.createElement("div");super({element:i,target:t.target});const n=this.button=document.createElement("button");n.title=Ne("centerInViewport"),n.innerHTML=gt.centerInViewport,i.className="ol-centermap ol-unselectable ol-control",i.appendChild(n),n.addEventListener("click",this.centerMap.bind(this,e),!1)}centerMap(e){const t=this.getMap();setTimeout(t.updateSize(),200);const i=t.getSize(),n=t.getView();n.centerOn(Ue(e.extent),i,[i[0]/2,i[1]/2]),n.setResolution(t.get("fullResolution"))}}class iu extends yt{constructor(e){const t=e||{},i=t.wheelMode||_e.MW_ZOOM,n=document.createElement("div");super({element:n,target:t.target});const r=t.viewer;n.className="ol-wheel ol-unselectable ol-control",n.style.backgroundColor="inherit";const o=document.createElement("button");o.style.marginLeft="auto",o.className="mousewheel-button";const a=document.createElement("span");o.appendChild(a),n.appendChild(o);function l(u,f){if(f===_e.MW_ZOOM){u.title=Ne("mouseWheelZooms"),u.innerHTML=gt.mouseWheelZooms;return}if(f===_e.MW_VERTICAL){u.title=Ne("mouseWheelScrolls"),u.innerHTML=gt.mouseWheelScrolls;return}throw new Error("setWheelModeButtonIcon: Unknown wheel mode: "+f)}l(a,i);function h(){const u=r.wheelMode===_e.MW_ZOOM?_e.MW_VERTICAL:_e.MW_ZOOM;r.toggleWheel(u),l(a,u)}o.addEventListener("click",h,!1)}}class _p extends Lc{constructor(e){super(e),this.extent=e.imageExtent,this.element.getElementsByClassName("ol-zoom-in").item(0).title=Ne("zoomIn"),this.element.getElementsByClassName("ol-zoom-out").item(0).title=Ne("zoomOut")}approachArrays(e,t,i){if(e.length!==t.length)throw new Error("Arrays must have the same length");let n=e.map((o,a)=>t[a]-o);return e.map((o,a)=>o+n[a]*i)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();let r=i.getCenter();if(!ii(this.extent*.8,r)){const o=Ue(this.extent);r=this.approachArrays(r,o,.05*i.getResolution())}if(n!==void 0){const o=i.getConstrainedZoom(n+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({center:r,zoom:o,duration:this.duration_})):i.setZoom(o)}}}class mp extends lm{constructor(){super();const e=this.element.querySelector(".ol-full-screen button");e.title=Ne("toggleFullScreen"),e.innerHTML=gt.toggleFullScreen}}class pp extends yt{constructor(e){const t=e||{},i=t.shape;if(!i){dp("No shape defined for Draw Button");return}const n=document.createElement("button"),r=document.createElement("div");r.className="heiv-draw-ind heiv-draw-inactive ol-control heiv-draw-ind-"+i.toLowerCase(),super({element:r,target:t.target}),this.shape=i,this.button=n,this.active=!1,this.drawFeatNum=1;const o=sl[i].shortName,a=Ne(o);n.title=Ne("drawShape",{shapeNameTranslated:a,shapeNameTranslatedLower:a.toLowerCase()}),n.innerHTML=gt[o],r.appendChild(n),n.addEventListener("click",l=>{l.currentTarget;const h=this.getMap(),u=h.get("draw");if(u&&h.removeInteraction(u),this.active?this.deactivate():this.activate(i),!this.active){h.set("draw",null);const f=h.get("selectControls");for(const g of f)g.activate()}})}activate(e){const t=this.getMap();for(const i of t.get("drawControls"))i.deactivate();this.active=!0,this.element.classList.add("heiv-draw-ind-active"),this.drawFeatNum=this.activateDraw(e,t,this.drawFeatNum);for(const i of t.get("selectControls"))i.deactivate()}deactivate(){this.active=!1,this.element.classList.remove("heiv-draw-ind-active")}activateDraw(e,t,i){const n=sl[e],r=t.get("drawSource"),o=t.get("drawLayer"),a=t.get("heiv"),l=n.drawType,h=n.shortName;a.deselectAll();const u=new b_({source:r,type:l,geometryFunction:n.geometryFunction,stopClick:!0,condition:f=>fr(f)&&Qo(f)});return u.on("drawend",f=>{i+=1,this.drawFeatNum=i;const g=f.feature,_=o.get("color"),p=qr(_,.1);g.get("modifyGeometry")&&p.setGeometry(function(y){const E=y.get("modifyGeometry");return E?E.geometry:y.getGeometry()}),g.setStyle(p),g.id_="draw_"+e+"_"+i.toString(),g.set("properties",{color:_,layerName:o.get("name"),type:h}),a.pointerMoveRefresh()}),t.addInteraction(u),t.set("draw",u),i}}class yp extends yt{constructor(e){const t=document.createElement("button");t.title=Ne("selectShape"),t.innerHTML=gt.selectShape;const i=document.createElement("div");i.className="heiv-select ol-control",t.classList="heiv-select-active",i.appendChild(t),super({element:i,target:options.target}),this.button=t,this.active=!1,t.addEventListener("click",()=>{const n=this.getMap(),r=!this.active;this.active=r;let o=n.get("draw");o&&n.removeInteraction(o),n.set("draw",null);for(const a of n.get("drawControls"))a.deactivate();r?this.activate():this.deactivate()})}activate(){this.active=!0,this.button.classList.remove("heiv-select-inactive"),this.button.classList.add("heiv-select-active"),this.getMap().get("heiv").activateShapedit()}deactivate(){this.active=!1,this.button.classList.add("heiv-select-inactive"),this.button.classList.remove("heiv-select-active");const t=this.getMap().get("heiv");t.deselectAll(),t.shapeTransformControl.deactivate()}}class vp extends yt{constructor(e){const t=e||{},i=document.createElement("button");i.title=Ne("deleteShape"),i.innerHTML=gt.deleteShape;const n=document.createElement("div");n.className="heiv-draw-ind heiv-trash heiv-trash-inactive ol-control",n.appendChild(i),super({element:n,target:t.target}),i.addEventListener("click",r=>{this.getMap().get("heiv").deleteSelectedFeatures()})}activate(){this.element.classList.remove("heiv-trash-inactive"),this.element.classList.add("heiv-trash-active"),this.element.style.pointerEvents="auto"}deactivate(){this.element.classList.remove("heiv-trash-active"),this.element.classList.add("heiv-trash-inactive")}}class Ep extends yt{constructor(e){const t=e||{},i=document.createElement("button");i.classList.add("haiv-shapedit-transform"),i.title=Ne("moveScaleRotate"),i.innerHTML=gt.moveScaleRotate,self.buttonTransform=i;const n=document.createElement("button");n.title=Ne("editVertices"),n.innerHTML=gt.editVertices,n.classList.add("haiv-shapedit-modify"),self.buttonModify=n;const r=document.createElement("div");r.className="heiv-draw-ind ol-control heiv-shapedit-transform",r.appendChild(i),r.appendChild(n),super({element:r,target:t.target}),this.active=!1,i.addEventListener("click",o=>{this.activate("transform")}),n.addEventListener("click",o=>{this.activate("modify")})}activate(e){this.element.classList.remove("hide");const t=this.getMap(),i=t.get("heiv");e=="transform"?(t.removeInteraction(i.selectShape),t.removeInteraction(i.modifyShape),t.removeInteraction(i.translateShape),t.addInteraction(i.transformShape),i.transformShape.setSelection(i.selectedFeature),self.buttonTransform.classList.add("active"),self.buttonModify.classList.remove("active"),i.modifyType="transform"):e=="modify"?(i.selectedFeature.extend(i.transformShape.getFeatures().getArray()),t.removeInteraction(i.transformShape),t.addInteraction(i.modifyShape),t.addInteraction(i.selectShape),t.removeInteraction(i.translateShape),self.buttonModify.classList.add("active"),self.buttonTransform.classList.remove("active"),i.modifyType="modify"):up(`Invalid value for modifyType: ${i.modifyType}`)}deactivate(){const e=this.getMap(),t=e.get("heiv");e.removeInteraction(t.transformShape),e.removeInteraction(t.selectShape),e.removeInteraction(t.modifyShape),e.removeInteraction(t.translate),t.transformShape.setSelection(new Te),t.selectedFeature.clear(),this.element.classList.add("hide")}}function Jr(s){var e=1,t=setInterval(function(){if(e<=.1){clearInterval(t),s.parentElement.style.border="none",s.style.visibility="hidden",s.style.opacity="0";return}s.style.opacity=e,s.parentElement.style.borderBottom="1px solid rgba(0,0,0, "+e+" )",s.parentElement.style.borderRight="1px solid rgba(0,0,0, "+e+" )",e-=e*.12},50)}class nu{constructor(e){xl(this,It);Js(this,"heiViewerLayers",[]);Js(this,"imageLayers",[]);Js(this,"maxZoom",8);Object.assign(this,e),this.properties=this.properties??{},this.name=this.name??"viewer_"+Math.floor(Math.random()*1e3).toString(),this.position=this.position??_e.POSITION_DEFAULT,this.zoom=this.zoom??_e.ZOOM_MIN,this.overviewMapSize=this.overviewMapSize??150,this.wheelMode=this.properties.wheelMode??_e.MW_ZOOM,this.rotation=this.properties.rotation??0,this.resolution=this.properties.resolution??null,this.overviewMapCollapsed=this.properties.overviewMapCollapsed??!1,this.maxCoordinateDecimals=this.maxCoordinateDecimals??0,this.maxCoordinateDecimals<0&&(console.warn(`The parameter 'maxCoordinateDecimals' of the heiImageViewer must be a positive integer. Using the default '0' instead of the given '${this.maxCoordinateDecimals}'`),this.maxCoordinateDecimals=0);try{if(this.container==null)throw"container";if(this.images==null)throw"images"}catch(t){console.error("The ImageViewer can not be displayed as parameter is missing: "+t);return}this.map=new Pc({interactions:Rc({mouseWheelZoom:!1,dragPan:!1}),controls:[]}),this.map.set("heiv",this)}async initialize(){let e=this.images;if(e.length==1&&e[0].endsWith("info.json")){const t=e[0];return Vi(this,It,Yu).call(this,t).then(i=>{this.imageLayers.push(i),this.createViewer()})}else{this.sizes==null&&(this.sizes=await Vi(this,It,Uu).call(this));try{if(this.sizes.length!=e.length)throw 1}catch{console.error("The sizes and images arrays must be the same length");return}const t=e.map((l,h)=>({url:l,size:this.sizes[h]}));t.sort((l,h)=>l.size[0]-h.size[0]),this.images=t.map(l=>l.url),this.sizes=t.map(l=>l.size);const i=this.sizes.slice(-1),n=i[0][0],r=i[0][1],o=this.extent=[0,-r,n,0],a=this.projection=new as({code:"inverted",units:"pixels",extent:o});for(let l=0;l<this.images.length;l++){const h=new wm({url:this.images[l],projection:a,imageExtent:o});l==0&&(this.overviewLayer=new Wc({source:h}));const u=new Wc({source:h,minZoom:l-.1,zIndex:l});this.imageLayers.push(u)}return this.createViewer()}}fail(e){e.message||this.fail({message:e});const t=this;throw Object.assign(new Error(e.message),e,{getAffectedInstance(){return t}})}createViewer(){document.documentElement.style.setProperty("--overview-map-size",this.overviewMapSize+"px"),document.documentElement.style.setProperty("--slider-left",this.overviewMapSize+5+"px");const e=this.map;e.setLayers([...this.imageLayers]);const t=document.createElement("div");t.style.backgroundColor="#666666",t.style.width="100%",t.style.height="100%",this.container.appendChild(t),e.setTarget(t),this.container=t;const i=this.createInitialView(this.resolution);e.setView(i);const n=this,r=new Sc({condition:function(C){if(C.type!="wheel")return;if(n.wheelMode==_e.MW_VERTICAL){C.originalEvent.preventDefault();const S=e.getView(),R=S.getCenter(),b=50;return C.originalEvent.deltaY<0&&S.setCenter([R[0],R[1]+b]),C.originalEvent.deltaY>0&&S.setCenter([R[0],R[1]-b]),y=null,!1}const T=e.getCoordinateFromPixel(C.pixel);return!!ii(n.extent,T)}});e.getInteractions().extend([r]),this.controls=[new mp,new um,new fp,new gp({extent:this.extent}),new _p({delta:.5,imageExtent:this.extent})];for(const C of this.controls)this.map.addControl(C);this.updateControls(this.lang);const a=Math.max(Math.abs(this.extent[1]),Math.abs(this.extent[2]))/this.overviewMapSize,l=this.overviewMapControl=new Vc({className:"ol-overviewmap ol-custom-overviewmap",layers:[this.overviewLayer],label:gt.toggleOverviewMap,collapseLabel:gt.toggleOverviewMap,tipLabel:Ne("toggleOverviewMap"),collapsed:this.overviewMapCollapsed,view:new wt({projection:this.projection,resolutions:[a],extent:this.extent,constrainResolution:!0})});e.addControl(l);const h=this.container.getElementsByClassName("ol-custom-overviewmap")[0],u=h.querySelector(".ol-overviewmap-map"),f=h.querySelector("button"),g=this.container.getElementsByClassName("ol-zoomslider")[0];g.addEventListener("mouseover",C=>{E()}),g.addEventListener("mouseleave",C=>{E(),_=setTimeout(Jr,2500,u),p=setTimeout(Jr,2500,g)});let _,p,y;e.on("movestart",()=>{y=e.getView().getCenter(),!l.getCollapsed()&&E()}),e.on("moveend",C=>{const T=e.getView(),S=T.calculateExtent(e.getSize());ze(S,this.extent)||T.setCenter(y),!l.getCollapsed()&&(_=setTimeout(Jr,2500,u),p=setTimeout(Jr,2500,g))}),f.onclick=function(){u.style.visibility="hidden",g.style.visibility="hidden"},l.getOverviewMap().on("pointerdrag",E),l.getOverviewMap().on("click",E);function E(){clearTimeout(_),clearTimeout(p),u.style.visibility="visible",u.style.opacity=1,u.parentElement.style.borderBottom="1px solid black",u.parentElement.style.borderRight="1px solid black",g.style.opacity=1,g.style.display="block",g.style.visibility="visible"}this.hoveredFeatures=[],this.selectedFeature=new Te,this.pointerMoveRefresh(),this.map.getViewport().addEventListener("mouseout",C=>{for(const T of this.hoveredFeatures)this.unhighlightFeature(T.id_),this.hoveredFeatures=[]}),this.listeners={},Vi(this,It,wl).call(this),this.updateInteractions(),e.set("heiv",this)}pointerMoveRefresh(){let e=this.selectedFeature,t=this;this.map.on("pointermove",i=>{var n;for(let r=0;r<this.hoveredFeatures.length;r++){const o=this.hoveredFeatures[r];if(o!==null){let a=!1;if(e.forEach(g=>{o.id_==g.id_&&(a=!0)}),a==!0)continue;const l=o.get("properties").color;let h=o.get("properties").layerName;const f=Vi(n=t,It,Tl).call(n,h)[0].display;o.setStyle(rn(f,l))}}this.hoveredFeatures=[],this.map.forEachFeatureAtPixel(i.pixel,function(r){var f;if(r.id_==null)return;let o=!1;if(e.forEach(g=>{r.id_==g.id_&&(o=!0)}),o==!0)return;const a=r.get("properties").color;let l=r.get("properties").layerName;const u=Vi(f=t,It,Tl).call(f,l)[0].display;r.setStyle(Qa(u,a)),t.hoveredFeatures.push(r)},{hitTolerance:5})})}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}triggerEvent(e,t=null){this.listeners[e]&&this.listeners[e].forEach(i=>{i(t)})}addHoverListener(e,t){let i=[],n=[];const r=this.map;r.on("pointermove",function(o){const a=r.getFeaturesAtPixel(o.pixel),l=a.length;for(let h=0;h<l;h++){const u=a[h];i.includes(u)||(i.push(u),e(u))}n=i.filter(h=>!a.includes(h));for(let h=0;h<n.length;h++){const u=n[h];t(u),i=i.filter(f=>f.id_!=u.id_)}n=[]})}addClickListener(e){const t=this.map;t.on("click",function(i){const n=t.getFeaturesAtPixel(i.pixel);for(let r=0;r<n.length;r++){const o=n[r];e(o)}})}createInitialView(e=null){let t=this.map.getSize();const i=t[0],n=t[1],r=this.projection,o=r.extent_,a=o[2],l=Math.abs(o[1]),h=this;let u=a/i;const f=l/n;let g=Math.max(u,f);return this.map.set("fullResolution",g),e==null&&(e=(()=>{switch(h.zoom){case _e.ZOOM_COVER:return Math.min(u,f);case _e.ZOOM_MIN:return g;default:return g}})()),this.initialView(o,e,g,r,a,l,i,n)}initialView(e,t,i,n,r,o,a,l){let h;switch(this.position){case _e.POSITION_DEFAULT:h=Ue(e);break;case _e.POSITION_TOP:h=[r/2,-l*t/2];break;case _e.POSITION_TOP_LEFT:h=[r/2+(a*t/2-r/2),-(l*t/2)];break;default:console.warn("The setting for the center of the image is invalid: '"+this.position+"'. Using the default behaviour."),h=Ue(e)}const u=[-(a+r)*i,-(l+o)*i,(a+r)*i,(l+o)*i];return new wt({projection:n,center:h,maxResolution:i*1.2,resolution:t,maxZoom:this.maxZoom,extent:u,zoomFactor:1.5,rotation:this.rotation})}resetView(){const e=this.map,t=e.getView(),i=e.getSize();if(i=="0,0"){e.updateSize();const n=this.createInitialView(this.resolution);e.setView(n)}else{const n=t.getRotation(),r=t.calculateExtent(i);e.updateSize();const o=t.calculateExtent(e.getSize()),a=t.getCenter(),l=[r[0]-o[0],r[3]-o[3]],h=this.createInitialView(t.getResolution());e.setView(h);const u=e.getView();u.setRotation(n),u.setCenter([a[0]+l[0],a[1]+l[1]])}Vi(this,It,wl).call(this)}updateControls(){}getFeatureAndLayer(e){const t=this.heiViewerLayers;for(let i of t){const n=i.getMapLayer().getSource().getFeatureById(e);if(n!=null)return[n,i]}return!1}mustGetFeatureAndLayer(e){return this.getFeatureAndLayer(e)||this.fail({message:"Could not find a feature with id "+e,name:"ERR_HEIIMAGEVIEWER_FEATURE_ID_NOT_FOUND",featureId:e})}addFeature(e,t){t.features.push(e),this.deleteLayer(t.name),this.addLayer(t)}deleteFeature(e){const[t,i]=this.getFeatureAndLayer(e);i.mapLayer.getSource().removeFeature(t);let n=i.features;n=n.filter(r=>r.name!==e),i.features=n}changeFeatureColor(e,t){const[i,n]=this.getFeatureAndLayer(e);i.get("properties").color=t;const r=n.display;i.setStyle(rn(r,t))}focusFeature(e){const t=this.map,[i,n]=this.getFeatureAndLayer(e),r=i.get("properties").color,o=n.display,a=i.getGeometry();t.getView().fit(a,{padding:[20,20,20,20],duration:800,callback:function(){setTimeout(function(){i.setStyle(Qa(o,r,.3))},100)}})}highlightFeature(e,t=.3){const i=this.mustGetFeatureAndLayer(e),[n,r]=i,o=n.get("properties").color,a=r.display;n.setStyle(Qa(a,o,t))}unhighlightFeature(e){const t=this.mustGetFeatureAndLayer(e),[i,n]=t,r=i.get("properties").color,o=n.display;i.setStyle(rn(o,r))}deleteLayer(e){const t=this.map,i=this.heiViewerLayers;let n=[];for(let r=0;r<i.length;r++){const o=i[r];if(o.name==e||e==null){t.removeLayer(o.mapLayer);continue}n.push(o)}this.heiViewerLayers=n}getLayer(e){if(e==null)return console.warn("No name provided in call to getLayer()."),null;const t=this.heiViewerLayers;for(let i=0;i<t.length;i++){const n=t[i];if(n.name==e)return n}return console.warn("Could not find layer with name "+e),null}addLayer(e,t=0){const i=e.type,n=e.name,r=e.color;let o=[];e.features!=null&&(o=Qm(e,this.projection));const a=new Dr({features:o,useSpatialIndex:!1});a.forEachFeature(h=>{this.triggerEvent("viewer:addedFeature",h);const u=e.display,f=h.get("properties").color;h.setStyle(rn(u,f))});const l=new Xs({className:"ol-layer ol-annotation-layer",properties:{layerType:i||"undefined",name:n||`layer_${t}`,color:r,heivLayer:e},source:a});switch(i){case _e.FEATURE_TYPE_ANNO:l.setZIndex(104);break;case _e.FEATURE_TYPE_CUSTOM:l.setZIndex(105);break;case _e.FEATURE_TYPE_LINE:l.setZIndex(102);break;case _e.FEATURE_TYPE_SEARCH:l.setZIndex(103);break;case _e.FEATURE_TYPE_ZONE:l.setZIndex(101);break;default:l.setZIndex(100);break}return e.setMapLayer(l),this.heiViewerLayers.push(e),this.map.addLayer(l),l}addLayers(e){for(let t=0;t<e.length;t++)this.addLayer(e[t],t+1)}getMap(){return this.map}getProperties(){const t=this.getMap().getView();return{wheelMode:this.wheelMode,resolution:t.getResolution(),rotation:t.getRotation(),overviewMapCollapsed:this.overviewMapControl.getCollapsed()}}toggleWheel(e){this.wheelMode=e}setContainerSize(e,t,i){e.style.height=(t/i).toString()+"px"}updateInteractions(){}}It=new WeakSet,Yu=async function(e){try{const i=await(await fetch(e)).json();let n=new bm(i).getTileSourceOptions();if(n===void 0||n.version===void 0){console.warn("Data seems to be no valid IIIF image information.");return}const r=new jm(n);this.maxZoom=r.getTileGrid().getMaxZoom()+1,this.overviewLayer=new $c({source:r}),this.extent=r.getTileGrid().getExtent(),this.projection=new as({code:"inverted",units:"pixels",extent:this.extent});const o=new $c;return o.setSource(r),o}catch(t){console.warn("Could not read data from URL: "+t)}},Uu=async function(){const e=this.images.map(t=>new Promise((i,n)=>{const r=new Image;r.onload=()=>{const o=[r.naturalWidth,r.naturalHeight];i(o)},r.onerror=o=>n(o),r.src=t}));return Promise.all(e)},wl=function(){this.map.getView().on("change",()=>{this.triggerEvent("change:view")}),this.map.getView().on("change:rotation",()=>{this.triggerEvent("change:view")});const e=this;this.map.getControls().forEach(t=>{(t instanceof iu||t instanceof Vc)&&t.element.addEventListener("click",()=>{e.triggerEvent("change:view")})})},Tl=function(e){return this.map.getLayers(),this.heiViewerLayers.filter(i=>i.getName()==e)};var su=class extends ri{constructor(e){e=e||{},super({handleDownEvent:function(i){return t.handleDownEvent_(i)},handleDragEvent:function(i){return this.handleDragEvent_(i)},handleMoveEvent:function(i){return this.handleMoveEvent_(i)},handleUpEvent:function(i){return this.handleUpEvent_(i)}});var t=this;this.selection_=new Te,this.handles_=new Te,this.overlayLayer_=new Xs({source:new Dr({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(i){return t.style[(i.get("handle")||"default")+(i.get("constraint")||"")+(i.get("option")||"")]},updateWhileAnimating:!0,updateWhileInteracting:!0}),this.features_=e.features,typeof e.filter=="function"&&(this._filter=e.filter),this.layers_=e.layers?e.layers instanceof Array?e.layers:[e.layers]:null,this._handleEvent=e.condition||function(){return!0},this.addFn_=e.addCondition||function(){return!1},this.setPointRadius(e.pointRadius),this.set("translateFeature",e.translateFeature!==!1),this.set("translate",e.translate!==!1),this.set("translateBBox",e.translateBBox===!0),this.set("stretch",e.stretch!==!1),this.set("scale",e.scale!==!1),this.set("rotate",e.rotate!==!1),this.set("keepAspectRatio",e.keepAspectRatio||function(i){return i.originalEvent.shiftKey}),this.set("modifyCenter",e.modifyCenter||function(i){return i.originalEvent.metaKey||i.originalEvent.ctrlKey}),this.set("noFlip",e.noFlip||!1),this.set("selection",e.selection!==!1),this.set("hitTolerance",e.hitTolerance||0),this.set("enableRotatedTransform",e.enableRotatedTransform||!1),this.set("keepRectangle",e.keepRectangle||!1),this.set("buffer",e.buffer||0),this.on("propertychange",function(){this.drawSketch_()}),this.setDefaultStyle()}setMap(e){var t=this.getMap();if(t){var i=t.getTargetElement();t.removeLayer(this.overlayLayer_),this.previousCursor_&&i&&(i.style.cursor=this.previousCursor_),this.previousCursor_=void 0}super.setMap(e),this.overlayLayer_.setMap(e),e===null&&this.select(null),e!==null&&(this.isTouch=/touch/.test(e.getViewport().className),this.setDefaultStyle())}setActive(e){this.select(null),this.overlayLayer_&&this.overlayLayer_.setVisible(e),super.setActive(e)}setDefaultStyle(e){e=e||{};var t=e.pointStroke||new St({color:[255,0,0,1],width:1}),i=e.stroke||new St({color:[255,0,0,1],width:1,lineDash:[4,4]}),n=e.fill||new Tt({color:[255,0,0,.01]}),r=e.pointFill||new Tt({color:[255,255,255,.8]}),o=new en({fill:r,stroke:t,radius:this.isTouch?12:6,displacement:this.isTouch?[24,-24]:[12,-12],points:15});o.setDisplacement||(o.getAnchor()[0]=this.isTouch?-10:-5);var a=new en({fill:r,stroke:t,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),l=new en({fill:r,stroke:t,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function h(u,f,g){return[new it({image:u,stroke:f,fill:g})]}this.style={default:h(a,i,n),translate:h(a,t,r),rotate:h(o,t,r),rotate0:h(a,t,r),scale:h(a,t,r),scale1:h(a,t,r),scale2:h(a,t,r),scale3:h(a,t,r),scalev:h(l,t,r),scaleh1:h(l,t,r),scalev2:h(l,t,r),scaleh3:h(l,t,r)},this.drawSketch_()}setStyle(e,t){if(t){t instanceof Array?this.style[e]=t:this.style[e]=[t];for(var i=0;i<this.style[e].length;i++){var n=this.style[e][i].getImage();n&&(e=="rotate"&&(n.getAnchor()[0]=-5),this.isTouch&&n.setScale(1.8));var r=this.style[e][i].getText();r&&(e=="rotate"&&r.setOffsetX(this.isTouch?14:7),this.isTouch&&r.setScale(1.8))}this.drawSketch_()}}getFeatureAtPixel_(e){var t=this;return this.getMap().forEachFeatureAtPixel(e,function(i,n){var r=!1;if(!n){if(i===t.bbox_)return t.get("translateBBox")?{feature:i,handle:"translate",constraint:"",option:""}:!1;if(t.handles_.forEach(function(a){a===i&&(r=!0)}),r)return{feature:i,handle:i.get("handle"),constraint:i.get("constraint"),option:i.get("option")}}if(!t.get("selection"))return t.selection_.getArray().some(function(a){return i===a})?{feature:i}:null;if(t._filter)return t._filter(i,n)?{feature:i}:null;if(t.layers_){for(var o=0;o<t.layers_.length;o++)if(t.layers_[o]===n)return{feature:i};return null}else return t.features_?(t.features_.forEach(function(a){a===i&&(r=!0)}),r?{feature:i}:null):{feature:i}},{hitTolerance:this.get("hitTolerance")})||{}}getGeometryRotateToZero_(e,t){var i=e.getGeometry(),n=this.getMap().getView().getRotation();if(n===0||!this.get("enableRotatedTransform"))return t?i.clone():i;var r=i.clone();return r.rotate(n*-1,this.getMap().getView().getCenter()),r}_isRectangle(e){if(this.get("keepRectangle")&&e.getType()==="Polygon"){var t=e.getCoordinates()[0];return t.length===5}return!1}drawSketch_(e){var t,i,n,r=this.selection_.item(0)&&this._isRectangle(this.selection_.item(0).getGeometry());if(this.overlayLayer_.getSource().clear(),!!this.selection_.getLength()){var o=this.getMap().getView().getRotation(),a=this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent(),l;r&&(l=this.getGeometryRotateToZero_(this.selection_.item(0)).getCoordinates()[0].slice(0,4),l.unshift(l[3])),a=hs(a,this.get("buffer")),this.selection_.forEach((function(y){var E=this.getGeometryRotateToZero_(y).getExtent();ds(a,E)}).bind(this));var h=this.selection_.getLength()===1?this._pointRadius(this.selection_.item(0)):0;if(h&&!(h instanceof Array)&&(h=[h,h]),e===!0)this.ispt_||(this.overlayLayer_.getSource().addFeature(new Pe({geometry:new Ve(this.center_),handle:"rotate0"})),n=$i(a),this.get("enableRotatedTransform")&&o!==0&&n.rotate(o,this.getMap().getView().getCenter()),i=this.bbox_=new Pe(n),this.overlayLayer_.getSource().addFeature(i));else{if(this.ispt_){var u=this.getMap().getPixelFromCoordinate([a[0],a[1]]);if(u){var f=h&&h[0]||10,g=h&&h[1]||10;a=at([this.getMap().getCoordinateFromPixel([u[0]-f,u[1]-g]),this.getMap().getCoordinateFromPixel([u[0]+f,u[1]+g])])}}n=r?new tt([l]):$i(a),this.get("enableRotatedTransform")&&o!==0&&n.rotate(o,this.getMap().getView().getCenter()),i=this.bbox_=new Pe(n);var _=[],p=n.getCoordinates()[0];if(!this.ispt_||h){if(_.push(i),!this.iscircle_&&!this.ispt_&&this.get("stretch")&&this.get("scale"))for(t=0;t<p.length-1;t++)i=new Pe({geometry:new Ve([(p[t][0]+p[t+1][0])/2,(p[t][1]+p[t+1][1])/2]),handle:"scale",constraint:t%2?"h":"v",option:t}),_.push(i);if(this.get("scale"))for(t=0;t<p.length-1;t++)i=new Pe({geometry:new Ve(p[t]),handle:"scale",option:t}),_.push(i);this.get("translate")&&!this.get("translateFeature")&&(i=new Pe({geometry:new Ve([(p[0][0]+p[2][0])/2,(p[0][1]+p[2][1])/2]),handle:"translate"}),_.push(i))}!this.iscircle_&&this.get("rotate")&&(i=new Pe({geometry:new Ve(p[3]),handle:"rotate"}),_.push(i)),this.overlayLayer_.getSource().addFeatures(_)}}}select(e,t){if(!e){this.selection_&&(this.selection_.clear(),this.drawSketch_());return}if(!(!e.getGeometry||!e.getGeometry())){if(t)this.selection_.push(e);else{var i=this.selection_.getArray().indexOf(e);this.selection_.removeAt(i)}this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:e,features:this.selection_})}}setSelection(e){this.selection_.clear(),e.forEach((function(t){this.selection_.push(t)}).bind(this)),this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",features:this.selection_})}watchFeatures_(){this._featureListeners&&this._featureListeners.forEach(function(e){Il(e)}),this._featureListeners=[],this.selection_.forEach((function(e){this._featureListeners.push(e.on("change",(function(){this.isUpdating_||this.drawSketch_()}).bind(this)))}).bind(this))}handleDownEvent_(e){if(this._handleEvent(e,this.selection_)){var t=this.getFeatureAtPixel_(e.pixel),i=t.feature;if(this.selection_.getLength()&&this.selection_.getArray().indexOf(i)>=0&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(t.handle="translate"),t.handle){this.mode_=t.handle,this.opt_=t.option,this.constraint_=t.constraint;var n=this.getMap().getView().getRotation();this.coordinate_=i.get("handle")?i.getGeometry().getCoordinates():e.coordinate,this.pixel_=this.getMap().getCoordinateFromPixel(this.coordinate_),this.geoms_=[],this.rotatedGeoms_=[];for(var r=lt(),o=lt(),a=0,l;l=this.selection_.item(a);a++)if(this.geoms_.push(l.getGeometry().clone()),r=ds(r,l.getGeometry().getExtent()),this.get("enableRotatedTransform")&&n!==0){var h=this.getGeometryRotateToZero_(l,!0);this.rotatedGeoms_.push(h),o=ds(o,h.getExtent())}if(this.extent_=$i(r).getCoordinates()[0],this.get("enableRotatedTransform")&&n!==0&&(this.rotatedExtent_=$i(o).getCoordinates()[0]),this.mode_==="rotate"){this.center_=this.getCenter()||Ue(r);var u=e.map.getTargetElement();u.style.cursor=this.Cursors.rotate0,this.previousCursor_=u.style.cursor}else this.center_=Ue(r);return this.angle_=Math.atan2(this.center_[1]-e.coordinate[1],this.center_[0]-e.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.selection_.item(0),features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!0}else if(this.get("selection")){if(i){this.addFn_(e)||this.selection_.clear();var f=this.selection_.getArray().indexOf(i);f<0?this.selection_.push(i):this.selection_.removeAt(f)}else this.selection_.clear();return this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:i,features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!1}}}getCenter(){return this.get("center")}setCenter(e){return this.set("center",e)}handleDragEvent_(e){if(this._handleEvent(e,this.features_)){var t=this.getMap().getView().getRotation(),i,n,r,o,a=[this.coordinate_[0],this.coordinate_[1]],l=[e.coordinate[0],e.coordinate[1]];switch(this.isUpdating_=!0,this.mode_){case"rotate":{var h=Math.atan2(this.center_[1]-l[1],this.center_[0]-l[0]);if(!this.ispt)for(i=0,r;r=this.selection_.item(i);i++)o=this.geoms_[i].clone(),o.rotate(h-this.angle_,this.center_),o.getType()=="Circle"&&o.setCenterAndRadius(o.getCenter(),o.getRadius()),r.setGeometry(o);this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.selection_.item(0),features:this.selection_,angle:h-this.angle_,pixel:e.pixel,coordinate:e.coordinate});break}case"translate":{var u=l[0]-a[0],f=l[1]-a[1];for(i=0,r;r=this.selection_.item(i);i++)r.getGeometry().translate(u,f);this.handles_.forEach(function(I){I.getGeometry().translate(u,f)}),this.coordinate_=e.coordinate,this.dispatchEvent({type:"translating",feature:this.selection_.item(0),features:this.selection_,delta:[u,f],pixel:e.pixel,coordinate:e.coordinate});break}case"scale":{var g=this.center_;if(this.get("modifyCenter")(e)){var _=this.extent_;this.get("enableRotatedTransform")&&t!==0&&(_=this.rotatedExtent_),g=_[(Number(this.opt_)+2)%4]}var p=this.geoms_.length==1&&this._isRectangle(this.geoms_[0]),y=this.constraint_,E=this.opt_,x=this.coordinate_,C=e.coordinate;if(this.get("enableRotatedTransform")&&t!==0){var T=new Ve(this.coordinate_);T.rotate(t*-1,g),x=T.getCoordinates();var S=new Ve(e.coordinate);S.rotate(t*-1,g),C=S.getCoordinates()}var R=(C[0]-g[0])/(x[0]-g[0]),b=(C[1]-g[1])/(x[1]-g[1]),P=[C[0]-x[0],C[1]-x[1]];if(this.get("enableRotatedTransform")&&t!==0){var F=new Ve(g);F.rotate(t*-1,this.getMap().getView().getCenter()),g=F.getCoordinates()}for(this.get("noFlip")&&(R<0&&(R=-R),b<0&&(b=-b)),this.constraint_?this.constraint_=="h"?R=1:b=1:this.get("keepAspectRatio")(e)&&(R=b=Math.min(R,b)),i=0,r;r=this.selection_.item(i);i++)o=t===0||!this.get("enableRotatedTransform")?this.geoms_[i].clone():this.rotatedGeoms_[i].clone(),o.applyTransform((function(I,O,X){if(X<2)return O;if(p){var Z=[[6],[0,8],[2],[4]],G=[I[0],I[1]],Y=[I[2],I[3]],z=[I[4],I[5]],k=[I[6],I[7]],B=[I[8],I[9]];if(y){var U=E%2===0?this._countVector(G,Y):this._countVector(k,G),ie=this._projectVectorOnVector(P,U),ee=E+1<Z.length?E+1:0,ne=[...Z[E],...Z[ee]];for(n=0;n<I.length;n+=X)O[n]=ne.includes(n)?I[n]+ie[0]:I[n],O[n+1]=ne.includes(n)?I[n+1]+ie[1]:I[n+1]}else{var Q,ae;switch(E){case 0:P=this._countVector(k,C),Q=this._projectVectorOnVector(P,this._countVector(z,k)),ae=this._projectVectorOnVector(P,this._countVector(G,k)),[O[0],O[1]]=this._movePoint(G,Q),[O[4],O[5]]=this._movePoint(z,ae),[O[6],O[7]]=this._movePoint(k,P),[O[8],O[9]]=this._movePoint(B,Q);break;case 1:P=this._countVector(G,C),Q=this._projectVectorOnVector(P,this._countVector(k,G)),ae=this._projectVectorOnVector(P,this._countVector(Y,G)),[O[0],O[1]]=this._movePoint(G,P),[O[2],O[3]]=this._movePoint(Y,Q),[O[6],O[7]]=this._movePoint(k,ae),[O[8],O[9]]=this._movePoint(B,P);break;case 2:P=this._countVector(Y,C),Q=this._projectVectorOnVector(P,this._countVector(G,Y)),ae=this._projectVectorOnVector(P,this._countVector(z,Y)),[O[0],O[1]]=this._movePoint(G,ae),[O[2],O[3]]=this._movePoint(Y,P),[O[4],O[5]]=this._movePoint(z,Q),[O[8],O[9]]=this._movePoint(B,ae);break;case 3:P=this._countVector(z,C),Q=this._projectVectorOnVector(P,this._countVector(Y,z)),ae=this._projectVectorOnVector(P,this._countVector(k,z)),[O[2],O[3]]=this._movePoint(Y,ae),[O[4],O[5]]=this._movePoint(z,P),[O[6],O[7]]=this._movePoint(k,Q);break}}}else for(n=0;n<I.length;n+=X)R!=1&&(O[n]=g[0]+(I[n]-g[0])*R),b!=1&&(O[n+1]=g[1]+(I[n+1]-g[1])*b);return o.getType()=="Circle"&&o.setCenterAndRadius(o.getCenter(),o.getRadius()),O}).bind(this)),this.get("enableRotatedTransform")&&t!==0&&o.rotate(t,this.getMap().getView().getCenter()),r.setGeometry(o);this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.selection_.item(0),features:this.selection_,scale:[R,b],pixel:e.pixel,coordinate:e.coordinate});break}}this.isUpdating_=!1}}handleMoveEvent_(e){if(this._handleEvent(e,this.features_)&&!this.mode_){var t=this.getFeatureAtPixel_(e.pixel),i=e.map.getTargetElement();if(t.feature){var n=t.handle?this.Cursors[(t.handle||"default")+(t.constraint||"")+(t.option||"")]:this.Cursors.select;this.previousCursor_===void 0&&(this.previousCursor_=i.style.cursor),i.style.cursor=n}else this.previousCursor_!==void 0&&(i.style.cursor=this.previousCursor_),this.previousCursor_=void 0}}handleUpEvent_(e){if(this.mode_==="rotate"){var t=e.map.getTargetElement();t.style.cursor=this.Cursors.default,this.previousCursor_=void 0}return this.dispatchEvent({type:this.mode_+"end",feature:this.selection_.item(0),features:this.selection_,oldgeom:this.geoms_[0],oldgeoms:this.geoms_}),this.drawSketch_(),this.mode_=null,!1}setPointRadius(e){typeof e=="function"?this._pointRadius=e:this._pointRadius=function(){return e}}getFeatures(){return this.selection_}_projectVectorOnVector(e,t){var i=(e[0]*t[0]+e[1]*t[1])/(t[0]*t[0]+t[1]*t[1]);return[t[0]*i,t[1]*i]}_countVector(e,t){return[t[0]-e[0],t[1]-e[1]]}_movePoint(e,t){return[e[0]+t[0],e[1]+t[1]]}};su.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",rotate0:"move",scale:"nesw-resize",scale1:"nwse-resize",scale2:"nesw-resize",scale3:"nwse-resize",scalev:"ew-resize",scaleh1:"ns-resize",scalev2:"ew-resize",scaleh3:"ns-resize"};class Cp extends nu{constructor({...t}){super({...t});xl(this,Qr)}async initialize(){await super.initialize();const t=this,i=this.map;this.editFeature=!0,this.freeMove=!1;const n=new ta({condition:g=>!0});i.getTarget().addEventListener("contextmenu",function(g){const _=i.get("draw");return _&&_.abortDrawing(),g.preventDefault(),!1},!1),i.addInteraction(n),document.addEventListener("keydown",g=>{if(g.key=="Escape"){const _=i.get("draw");_&&_.abortDrawing()}});const o=new Jc({name:"draw_layer_default",display:_e.ZONES_SHOW_ALL,color:"#F00"});this.heiViewerLayers.push(o);const a=this.addLayer(o);i.set("drawLayer",a);const l=a.getSource();l.on("addfeature",g=>{this.triggerEvent("draw:end")}),i.set("drawSource",l),i.set("draw",null),t.modifyType="transform";const h=new it({stroke:new St({color:"blue",width:3}),fill:new Tt({color:"rgba(255,255,0, .5)"})});t.selectShape=new Ga({features:t.selectedFeature,style:h,hitTolerance:5}),t.modifyShape=new N_({features:t.selectShape.getFeatures(),wrapX:!1,pixelTolerance:5,insertVertexCondition:ys}),t.transformShape=new su({hitTolerance:2,rotate:!0,selection:!0,translate:!0,addCondition:ys}),t.translateShape=new j_({features:t.selectShape.getFeatures()}),Vi(this,Qr,Hu).call(this),this.activateShapedit();function u(g){(g.selected||g.features.array_).length>0?this.removeFeatureControl.activate():(this.removeFeatureControl.deactivate(),this.selectedFeature.clear())}t.selectShape.on("select",u.bind(this)),t.transformShape.on("select",u.bind(this)),["rotateend","translateend","scaleend"].forEach(g=>{t.transformShape.addEventListener(g,function(_){t.triggerEvent("draw:end")})}),t.modifyShape.addEventListener("modifyend",function(){t.triggerEvent("draw:end")})}activateShapedit(){this.shapeTransformControl.activate(this.modifyType)}addDrawLayer(t){const i=this.addLayer(t),n=this.map;n.set("drawLayer",i);const r=i.getSource();n.set("drawSource",r),r.on("addfeature",o=>{this.triggerEvent("draw:end")})}deselectAll(){this.selectedFeature.forEach(t=>{t.id_&&t.setStyle(rn(_e.ZONES_SHOW_ALL,t.get("properties").color))}),this.selectedFeature.clear(),this.selectCounter=0,this.pointerMoveRefresh()}deleteSelectedFeatures(){let t=[];if(this.selectedFeature.getLength()<1){const n=this.transformShape.getFeatures().getArray();this.selectedFeature.extend(n)}if(!(this.selectedFeature.getLength()<1||!confirm("Are you sure you want to delete this feature?")))return this.selectedFeature.forEach(n=>{const r={...n};t.push(r),this.deleteFeature(n.id_)}),this.selectedFeature.clear(),this.transformShape.setSelection(new Te),this.pointerMoveRefresh(),this.removeFeatureControl.deactivate(),this.triggerEvent("draw:end"),t}getLayerSvg(t){if(t==null){console.warn("No name provided in call to getLayerSvg().");return}for(let i=0;i<this.heiViewerLayers.length;i++){const n=this.heiViewerLayers[i];if(n.name!=t)continue;const o=n.getMapLayer();let a="";const l=this;return o.getSource().forEachFeature(function(h){const u=h.getGeometry(),f=h.get("properties").type,g=h.get("properties").subfeatures;a+=l.processFeature(u,f,g)}),a!=""&&(a='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+this.extent[2]+'">'+a+"</svg>"),a}console.warn(`No layer found with name: ${t}`)}processFeature(t,i,n){let r="";switch(i){case"rect":const o=t.getCoordinates(),a=this.createSvgRect(o);r+=a;break;case"polygon":const l=t.getCoordinates(),h=this.createSvgPolygon(l);r+=h;break;case"circle":const u=t.getCenter(),f=t.getRadius(),g=this.createSvgCircle(u,f);r+=g;break;case"ellipse":const _=t.getCoordinates(),p=this.createSvgEllipse(_);r+=p;break;case"line":const y=t.getCoordinates(),E=this.createSvgLine(y);r+=E;break;case"collection":const x=t.geometries_;if(x)for(let C=0;C<x.length;C++){let T=x[C],S=n[C];r+=this.processFeature(T,S)}}return r}createSvgPolygon(t){return`<polygon points='${t[0].map(r=>r.map((o,a)=>a===1?(o*-1).toFixed(this.maxCoordinateDecimals):o.toFixed(this.maxCoordinateDecimals)).join(",")).join(" ")}'/>`}createSvgPolyline(t){return`<polyline points='${t.map(r=>r.map((o,a)=>a===1?(o*-1).toFixed(this.maxCoordinateDecimals):o.toFixed(this.maxCoordinateDecimals)).join(",")).join(" ")}'/>`}createSvgLine(t){let i="",n="";return t.length==2?n+=`<line x1='${t[0][0].toFixed(this.maxCoordinateDecimals)}' y1='${-t[0][1].toFixed(this.maxCoordinateDecimals)}' x2='${t[1][0].toFixed(this.maxCoordinateDecimals)}' y2='${-t[1][1].toFixed(this.maxCoordinateDecimals)}'/>`:(i=t.map(r=>r.map((o,a)=>a===1?(o*-1).toFixed(this.maxCoordinateDecimals):o.toFixed(this.maxCoordinateDecimals)).join(",")).join(" "),n+=`<polyline points='${i}'/>`),n}createSvgRect(t){const i=t[0],n=i.map(_=>_[0]),r=i.map(_=>-_[1]),o=Math.min(...n),a=Math.max(...n),l=Math.min(...r),h=Math.max(...r),u=a-o,f=h-l;return`<rect x='${o.toFixed(this.maxCoordinateDecimals)}' y='${l.toFixed(this.maxCoordinateDecimals)}' width='${u.toFixed(this.maxCoordinateDecimals)}' height='${f.toFixed(this.maxCoordinateDecimals)}'/>`}createSvgCircle(t,i){return`<circle cx='${t[0].toFixed(this.maxCoordinateDecimals)}' cy='${(t[1]*-1).toFixed(this.maxCoordinateDecimals)}' r='${i.toFixed(this.maxCoordinateDecimals)}'/>`}createSvgEllipse(t){let i=0,n=0,r=0,o=0,a=t[0].length;t[0].forEach(_=>{i+=_[0],n+=_[1]});const l=i/a,h=n/a;t[0].forEach(_=>{let p=Math.abs(_[0]-l),y=Math.abs(_[1]-h);p>r&&(r=p),y>o&&(o=y)});let u=r,f=o;return`<ellipse cx="${l.toFixed(this.maxCoordinateDecimals)}" cy="${-h.toFixed(this.maxCoordinateDecimals)}" rx="${u.toFixed(this.maxCoordinateDecimals)}" ry="${f.toFixed(this.maxCoordinateDecimals)}" />`}}Qr=new WeakSet,Hu=function(){const t=this.map;this.selectControl=new yp,this.removeFeatureControl=new vp,this.shapeTransformControl=new Ep;const i=[this.selectControl,this.removeFeatureControl,this.shapeTransformControl];t.set("selectControls",i);for(const r of i)t.controls.push(r);let n=[];for(const r in sl){const o=new pp({shape:r});n.push(o),t.controls.push(o)}t.set("drawControls",n)};class xp extends nu{constructor({...e}){super({...e})}updateInteractions(){this.map.addInteraction(new ta),this.toggleWheel(this.wheelMode)}createViewer(){super.createViewer();const e=new iu({viewer:this,wheelMode:this.wheelMode});this.map.addControl(e),this.updateControls(this.lang)}}ve.ImageDraw=Cp,ve.Layer=Jc,ve.buttonIconsHtml=gt,ve.i18n=Ne,ve.imageViewer=xp,ve.variables=_e,Object.defineProperty(ve,Symbol.toStringTag,{value:"Module"})});
